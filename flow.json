[{"id":"60528a1b.f32364","type":"tab","label":"Startup","disabled":false,"info":"Used to setup system variables. \r\n\r\nThe main bulk of the flow is activated on boot\r\n\r\n* Set IP Address- Gets the system IP address, adds it to global.ip and also sets /ip in the json DB\r\n* Set system ID  - Gets system ID from json DB and sets global.sysID - This is used to filter messages\r\n* Set Email Address - Gets last email from json DB and sets global.to\r\n* Add Power on Message to DB - Writes to DB when system Powers on\r\n* Set Serial Number - Gets Serial from json DB and sets global.serial\r\n* Set Software Version - Gets S/W Version from json DB and sets global.sw\r\n* Set Hardware Version - Gets H/W Version from json DB and sets global.hw\r\n* Set Firmware Version - Gets F/W Version from json DB and sets global.fw\r\n* Set Password - Gets system Password from json DB and sets global.password\r\n* Set Left Header Links - Gets json List of modules for main pages from json DB and sets global.left. Used to set contents list on main pages\r\n* Set Settings Links - Gets json List of settings pages for settings pages from json DB and sets global.setings_list. Used to set contents list on settings pages\r\n* Set sort by - Sets default sort coloum to \"index\" on boot\r\n* Set sort direction - Sets default sort direction to \"ASC\" on boot\r\n\r\nAlso on this Flow is the webpage that is served if a user tries to access a page they are not licenced for. this can be triggered from any page by a link node.\r\n\r\nFinally there is a collection of default data nodes. These add the injected data into the json DB. They only need to be ran once to populate the json DB\r\n\r\n* /sw,/hw,/fw - Used to set the versions shown on the settings pages\r\n* sysID - Used to set the system ID Filter\r\n* Modules - contains a JSON string used to set the Links to main pages and their displayed Names\r\n* Serial - Used to set the system serial number\r\n* Password - Used to set the default system password - 1234 at this time\r\n* Settings - contains a JSON string used to set the Links to settings pages and their displayed Names"},{"id":"e3cbac21.52804","type":"tab","label":"Receive Page & Add to DB","disabled":false,"info":"This Flow does the following\r\n1. Recvied the page either from \r\n       * LRS TX-7470-C232 (RS232 Node needed before. Switch node recommended to filter out startup messages and send confirmations)\r\n       * RTL-SDR\r\nthis is currently changed by changing the nodes\r\n2. Checks msg.sysID matched global.sysID\r\n3. Forms SQL query to add page to DB\r\n4. Checks if msg.Status = Attended\r\n    * If True changes status in DB from active to Handled Also updates late messages to handled\r\n    * If False Outputs to other Flows.\r\n\r\nAlso on this flow are some example pager messages that can be injected manually.** to be removed in final version!**"},{"id":"23c43518.b3ff0a","type":"tab","label":"Pager Dynamic Display","disabled":false,"info":"When /display or / is accessed this flow builds a webpage by setting the page title, injecting the JS and HTML.\r\nEvery Second the inject node fires which queries the DB for all data with a status of Active or Late. This Data is phrased to work out the Display style and t oconvert the TS to local time. THis is then built into HTML code using Mustache to loop through the Data. Once completethis HTML Data is pushed to the webpage via a Websocket.\r\n\r\nWhen the user clicks on one of the lines of data, its Index is sent via websocket, This is tested to see if its not 'Open' (Sent by the webpage onload to refresh data) The status of the record matching the index is updated to manaully handled in the DB.\r\n\r\nWhen a new page is added to the DB the Link node is triggered to play a noise using the websocket"},{"id":"b8bd1cc3.4827","type":"tab","label":"First Aid Display","disabled":false,"info":""},{"id":"d0e2bfbf.dfe3f","type":"tab","label":"Table Display","disabled":false,"info":""},{"id":"b209c94d.26d798","type":"tab","label":"Log Display Daily","disabled":false,"info":""},{"id":"1c96dbb1.1bc354","type":"tab","label":"Log Display Full","disabled":false,"info":""},{"id":"53e35596.381c0c","type":"tab","label":"Quick Page","disabled":false,"info":""},{"id":"da0e8c29.a0583","type":"tab","label":"Free Page","disabled":false,"info":""},{"id":"9939c833.99b318","type":"tab","label":"Split Screen","disabled":false,"info":"When /display or / is accessed this flow builds a webpage by setting the page title, injecting the JS and HTML.\r\nEvery Second the inject node fires which queries the DB for all data with a status of Active or Late. This Data is phrased to work out the Display style and t oconvert the TS to local time. THis is then built into HTML code using Mustache to loop through the Data. Once completethis HTML Data is pushed to the webpage via a Websocket.\r\n\r\nWhen the user clicks on one of the lines of data, its Index is sent via websocket, This is tested to see if its not 'Open' (Sent by the webpage onload to refresh data) The status of the record matching the index is updated to manaully handled in the DB.\r\n\r\nWhen a new page is added to the DB the Link node is triggered to play a noise using the websocket"},{"id":"b00e2d77.a9931","type":"tab","label":"Export","disabled":false,"info":""},{"id":"38ad3d43.e07282","type":"tab","label":"Login","disabled":false,"info":""},{"id":"ce69645.1231098","type":"tab","label":"Settings Menu","disabled":false,"info":""},{"id":"aefd70ef.7eada","type":"tab","label":"Set Alias","disabled":false,"info":""},{"id":"53762a60.6160b4","type":"tab","label":"Set Quick Page","disabled":false,"info":""},{"id":"d0562e73.de681","type":"tab","label":"Set Flash Pattern Effects","disabled":false,"info":""},{"id":"69336e92.97cdb","type":"tab","label":"System Settings","disabled":false,"info":""},{"id":"3c78672c.9cb1f8","type":"tab","label":"Engineer Settings","disabled":false,"info":""},{"id":"ba76d305.cf8ad","type":"tab","label":"DB Utilities","disabled":false,"info":""},{"id":"dad6f0f1.28177","type":"tab","label":"TX-7470-232 Controls","disabled":false,"info":""},{"id":"934a5982.d432b8","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"85d51a2d.db2228","type":"subflow","name":"Receive Page SDR","info":"","category":"input","in":[],"out":[{"x":1720,"y":60,"wires":[{"id":"4437d3de.ca8fdc","port":0}]}]},{"id":"76a9f5f0.1cf2dc","type":"subflow","name":"Receive Page LRS","info":"","category":"input","in":[{"x":60,"y":40,"wires":[{"id":"b5533914.8b1f58"},{"id":"c225fa15.f34b38"}]}],"out":[{"x":1160,"y":120,"wires":[{"id":"6862b344.2783ac","port":0}]}]},{"id":"3b51b3fa.8136dc","type":"subflow","name":"Receive Page TRX1","info":"","category":"input","in":[],"out":[{"x":880,"y":100,"wires":[{"id":"7e312125.1eb7b","port":0}]}]},{"id":"ca9def01.26ba2","type":"subflow","name":"Send Page","info":"","in":[{"x":220,"y":160,"wires":[{"id":"d19364d9.208968"},{"id":"d51608e.09159f8"},{"id":"33ff1e8e.291482"},{"id":"fb44d9db.726018"}]}],"out":[]},{"id":"8ad92631.0da208","type":"websocket-listener","z":"","path":"/log-full/send","wholemsg":"true"},{"id":"c0402614.f01608","type":"websocket-listener","z":"","path":"/log-daily/receive","wholemsg":"true"},{"id":"aae6ab09.c69b28","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"50","bin":"false","out":"interbyte","addchar":false,"responsetimeout":""},{"id":"32989c5a.d6ee14","type":"websocket-listener","z":"","path":"/log-full/receive","wholemsg":"true"},{"id":"fd38eee5.8bd8a","type":"sqlitedb","z":"","db":"./CaptureCall.db","mode":"RWC"},{"id":"e1c85b2c.abed18","type":"json-db-collection","z":"","name":"","collection":"settings","save":true},{"id":"d9d1357a.d4f118","type":"websocket-listener","z":"","path":"/display/receive","wholemsg":"true"},{"id":"95962f80.19ef3","type":"websocket-listener","z":"","path":"/display/send","wholemsg":"false"},{"id":"c7526c07.3fd51","type":"websocket-listener","z":"","path":"/log-daily/send","wholemsg":"true"},{"id":"c78d8a51.8b8ed8","type":"websocket-listener","z":"","path":"/export/send","wholemsg":"true"},{"id":"b7dfd67b.7d7948","type":"websocket-listener","z":"","path":"/export/receive","wholemsg":"true"},{"id":"18f900b5.35f87f","type":"websocket-listener","z":"","path":"/export/alert","wholemsg":"true"},{"id":"2db6df1c.cd63b","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true,"responsetimeout":"10000"},{"id":"185c72ea.39ebed","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true,"responsetimeout":""},{"id":"4d6db4a9.f35a1c","type":"websocket-listener","z":"","path":"/table/receive","wholemsg":"true"},{"id":"c2e44b88.6a4e78","type":"websocket-listener","z":"","path":"/table/send","wholemsg":"false"},{"id":"5d6eb2f4.fc698c","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true,"responsetimeout":"10000"},{"id":"741a68b.a601698","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"50","bin":"false","out":"time","addchar":false,"responsetimeout":"10000"},{"id":"5e6c9ab1.74ef04","type":"websocket-listener","z":"","path":"/firstaid/receive","wholemsg":"true"},{"id":"addfeab3.3935e8","type":"websocket-listener","z":"","path":"/firstaid/send","wholemsg":"false"},{"id":"b03253f0.29251","type":"websocket-listener","z":"","path":"/quickpage/receive","wholemsg":"true"},{"id":"25343a6d.90cb36","type":"websocket-listener","z":"","path":"/quickpage/send","wholemsg":"false"},{"id":"d7115ac0.1e2888","type":"websocket-listener","z":"","path":"/login/send","wholemsg":"false"},{"id":"f92c2145.f46df","type":"websocket-listener","z":"","path":"/login/receive","wholemsg":"true"},{"id":"4f629706.3fbcb8","type":"websocket-listener","z":"","path":"/beep","wholemsg":"true"},{"id":"a0127eb8.b242b","type":"websocket-listener","z":"","path":"/setFP/send","wholemsg":"false"},{"id":"4f808f22.bd9c5","type":"websocket-listener","z":"","path":"/setFP/receive","wholemsg":"true"},{"id":"492c0e86.784f1","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"a08ab62d.cf01f8","type":"websocket-listener","z":"","path":"/split-screen/receive/one","wholemsg":"true"},{"id":"2dd9c4a8.1fbccc","type":"websocket-listener","z":"","path":"/split-screen/receive/two","wholemsg":"true"},{"id":"1bd09651.1c7e5a","type":"websocket-listener","z":"","path":"/split-screen/send","wholemsg":"false"},{"id":"942141f5.a8944","type":"websocket-listener","z":"","path":"/alias/send","wholemsg":"false"},{"id":"a446718.a7f529","type":"websocket-listener","z":"","path":"/alias/receive/one","wholemsg":"true"},{"id":"f2da83eb.80921","type":"websocket-listener","z":"","path":"/alias/receive/two","wholemsg":"true"},{"id":"7d649c17.1d11a4","type":"websocket-listener","z":"","path":"/setQP/receive","wholemsg":"true"},{"id":"c91ee09b.1a258","type":"websocket-listener","z":"","path":"/setQP/send","wholemsg":"false"},{"id":"5432addb.a8bf24","type":"websocket-listener","z":"","path":"/canned/send","wholemsg":"false"},{"id":"a0966341.283ff","type":"websocket-listener","z":"","path":"/system/send","wholemsg":"false"},{"id":"91b7d145.fc4e5","type":"websocket-listener","z":"","path":"/alert","wholemsg":"true"},{"id":"6c8b92a7.84a82c","type":"e-mail","z":"b00e2d77.a9931","server":"smtp.gmail.com","port":"465","secure":true,"name":"","dname":"CaptureCall System","x":1280,"y":1000,"wires":[]},{"id":"da56f422.c45fe8","type":"csv","z":"b00e2d77.a9931","name":"","sep":",","hdrin":"","hdrout":true,"multi":"one","ret":"\\n","temp":"Index, Call Point, Message, ReceivedTime, Status, StatusTime, ExportedTime, Recipient, System ID","skip":"0","x":890,"y":1020,"wires":[["e981d4fd.f427d8","8551674f.20b3f8"]]},{"id":"3f8aac1f.7c3ae4","type":"template","z":"b00e2d77.a9931","name":"Export All","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT \n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log`\nORDER BY  `rxTime` DESC;","output":"str","x":340,"y":1060,"wires":[["f8461b70.bd71c8"]]},{"id":"e981d4fd.f427d8","type":"change","z":"b00e2d77.a9931","name":"Setup mail content","rules":[{"t":"set","p":"attachments","pt":"msg","to":"[{\t    \"filename\": 'log.csv', \t    \"content\": $$.payload\t}]","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"CaptureCall System Log","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"Attached is the requested information from your CaptureCall system.","tot":"str"},{"t":"set","p":"to","pt":"msg","to":"to","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":1020,"wires":[["6c8b92a7.84a82c"]]},{"id":"a32b6729.85e8e8","type":"http in","z":"b00e2d77.a9931","name":"","url":"/export","method":"get","upload":false,"swaggerDoc":"","x":90,"y":220,"wires":[["b1874a1b.abe738"]]},{"id":"af06c87d.56a788","type":"comment","z":"b00e2d77.a9931","name":"Build Webpage","info":"","x":100,"y":40,"wires":[]},{"id":"cc70f131.afde4","type":"template","z":"b00e2d77.a9931","name":"Export New","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT\n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log` WHERE `exported` IS NULL","output":"str","x":350,"y":1020,"wires":[["f8461b70.bd71c8"]]},{"id":"f8a9f08f.97c9b","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET `exported`= '{{timestamp}}'","output":"str","x":680,"y":820,"wires":[["1526f69b.ff5f29"]]},{"id":"f8461b70.bd71c8","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":530,"y":1020,"wires":[["2e1d4886.bea1a8"]]},{"id":"1526f69b.ff5f29","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":830,"y":820,"wires":[[]]},{"id":"c3f8d5d0.283858","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Your eMail has been Sent","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":700,"wires":[["ea92ebe2.658898","75f1d35f.d07dac"]]},{"id":"ea92ebe2.658898","type":"websocket out","z":"b00e2d77.a9931","name":"Send Successful","server":"18f900b5.35f87f","client":"","x":570,"y":700,"wires":[]},{"id":"463f8c6f.4fd364","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Send Failed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":660,"wires":[["f2a91bf9.b1d3b8","68d64bf.54ca2b4"]]},{"id":"f2a91bf9.b1d3b8","type":"websocket out","z":"b00e2d77.a9931","name":"Send Failed","server":"18f900b5.35f87f","client":"","x":550,"y":660,"wires":[]},{"id":"9f4bb9c9.b550f8","type":"status","z":"b00e2d77.a9931","name":"","scope":["6c8b92a7.84a82c"],"x":80,"y":680,"wires":[["ba578bde.7214f8"]]},{"id":"ba578bde.7214f8","type":"switch","z":"b00e2d77.a9931","name":"","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"email.status.sendfail","vt":"str"},{"t":"eq","v":"email.status.sending","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":230,"y":680,"wires":[["463f8c6f.4fd364"],[],["c3f8d5d0.283858"]]},{"id":"3013dfe1.3ed01","type":"comment","z":"b00e2d77.a9931","name":"Catch Email Send Errors","info":"","x":130,"y":600,"wires":[]},{"id":"86082327.d62aa","type":"link in","z":"b00e2d77.a9931","name":"","links":["721569cb.074f58","8dc6af04.088a3"],"x":235,"y":1020,"wires":[["cc70f131.afde4"]]},{"id":"223b37e8.4b69d8","type":"link in","z":"b00e2d77.a9931","name":"","links":["2c82e51a.004a9a","9b0374d2.8917a8","34e0ce95.1b5ca2"],"x":235,"y":1060,"wires":[["3f8aac1f.7c3ae4"]]},{"id":"fed99ff9.b9bb1","type":"comment","z":"b00e2d77.a9931","name":"Send Email","info":"","x":90,"y":900,"wires":[]},{"id":"666f148c.df226c","type":"csv","z":"b00e2d77.a9931","name":"","sep":",","hdrin":"","hdrout":true,"multi":"one","ret":"\\n","temp":"Index, Call Point, Message, ReceivedTime, Status, StatusTime, ExportedTime, Recipient, System ID","skip":"0","x":890,"y":980,"wires":[["4ea4678b.48f808","8551674f.20b3f8"]]},{"id":"4ea4678b.48f808","type":"change","z":"b00e2d77.a9931","name":"Setup mail content","rules":[{"t":"set","p":"attachments","pt":"msg","to":"[{\t    \"filename\": 'log.csv', \t    \"content\": $$.payload\t}]","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"CaptureCall Daily Digest","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"Attached is the requested information from your CaptureCall system.","tot":"str"},{"t":"set","p":"to","pt":"msg","to":"to","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":980,"wires":[["6c8b92a7.84a82c"]]},{"id":"94f5535a.df3bc","type":"template","z":"b00e2d77.a9931","name":"Export New","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT\n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log` WHERE `exported` IS NULL","output":"str","x":350,"y":980,"wires":[["445e65fd.5881dc"]]},{"id":"445e65fd.5881dc","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":530,"y":980,"wires":[["4df235b.7c5c0cc"]]},{"id":"f3405690.0119c8","type":"inject","z":"b00e2d77.a9931","name":"Export New Every Day","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"x":150,"y":980,"wires":[["94f5535a.df3bc","ebaeeace.a4f718","430823b4.54fdcc"]]},{"id":"a61b2d01.623e8","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":120,"wires":[]},{"id":"c7008ce.9220c7","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":80,"wires":[["6f129008.96182"]]},{"id":"7e6e6b94.b4a724","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE \"log\" ( `index` INTEGER PRIMARY KEY AUTOINCREMENT, `capcode` INTEGER, `pagerNumber` INTEGER, `sysID` INTEGER, `group` TEXT, `content` TEXT, `msgPart1` TEXT, `msgPart2` TEXT, `sender` TEXT, `rxTime` INTEGER, `status` TEXT, `statusTime` INTEGER, `exported` INTEGER, `FP` TEXT, `payload` TEXT )","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":80,"wires":[["c7008ce.9220c7"]]},{"id":"6f129008.96182","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":80,"wires":[]},{"id":"ec443c0d.8626c","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":240,"wires":[["24bd4830.57f6e8"]]},{"id":"9d1e6dbe.d89e2","type":"inject","z":"ba76d305.cf8ad","name":"Clear Table","topic":"DELETE FROM 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":240,"wires":[["ec443c0d.8626c"]]},{"id":"aed60ae.6b45df8","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":120,"wires":[["a61b2d01.623e8"]]},{"id":"c8181b2e.7db228","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":120,"wires":[["aed60ae.6b45df8"]]},{"id":"b0a6ba65.a7d928","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":160,"wires":[]},{"id":"8b6bd144.83a25","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":160,"wires":[["b0a6ba65.a7d928"]]},{"id":"df2babd6.b81898","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":160,"wires":[["8b6bd144.83a25"]]},{"id":"4df235b.7c5c0cc","type":"function","z":"b00e2d77.a9931","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \nvar rxtime = new Date(msg.payload[i].rxTime);\nvar statusTime = new Date(msg.payload[i].statusTime);\nvar exportedTime = new Date(msg.payload[i].exported);\n\nif (msg.payload[i].exported === null) {\n    msg.payload[i].ExportedTime = \"n/a\"\n} else {\nmsg.payload[i].ExportedTime = exportedTime\n}\n\nmsg.payload[i].StatusTime = statusTime\nmsg.payload[i].ReceivedTime = rxtime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":980,"wires":[["666f148c.df226c"]]},{"id":"75f1d35f.d07dac","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":780,"wires":[["582b503f.5fb22","f8a9f08f.97c9b"]]},{"id":"2e1d4886.bea1a8","type":"function","z":"b00e2d77.a9931","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \nvar rxtime = new Date(msg.payload[i].rxTime);\nvar statusTime = new Date(msg.payload[i].statusTime);\nvar exportedTime = new Date(msg.payload[i].exported);\n\nif (msg.payload[i].exported === null) {\n    msg.payload[i].ExportedTime = \"n/a\"\n} else {\nmsg.payload[i].ExportedTime = exportedTime\n}\n\nmsg.payload[i].StatusTime = statusTime\nmsg.payload[i].ReceivedTime = rxtime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":1020,"wires":[["da56f422.c45fe8"]]},{"id":"24bd4830.57f6e8","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":240,"wires":[]},{"id":"2fd5e4ed.597f5c","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":200,"wires":[]},{"id":"37e42e66.009442","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":200,"wires":[["2fd5e4ed.597f5c"]]},{"id":"d201839b.347","type":"inject","z":"ba76d305.cf8ad","name":"Reset Auto Increment (Clear Table First)","topic":"DELETE FROM sqlite_sequence WHERE name = 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":200,"wires":[["37e42e66.009442"]]},{"id":"8551674f.20b3f8","type":"debug","z":"b00e2d77.a9931","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1030,"y":940,"wires":[]},{"id":"1d4b9b6.2e75565","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":280,"wires":[["8b82ced7.840b7"]]},{"id":"f3efd6bc.d319a8","type":"inject","z":"ba76d305.cf8ad","name":"Clear Old Records","topic":"DELETE FROM `log` WHERE `index` IN (SELECT `index` FROM `log` ORDER BY `index` DESC LIMIT -1 OFFSET 2000) AND `exported` IS NOT NULL;","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":280,"wires":[["1d4b9b6.2e75565"]]},{"id":"8b82ced7.840b7","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":280,"wires":[]},{"id":"a352da15.0d4288","type":"template","z":"b00e2d77.a9931","name":"Clear Old Records","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `log` WHERE `index` IN (SELECT `index` FROM `log` ORDER BY `index` DESC LIMIT -1 OFFSET 2000) AND `exported` IS NOT NULL;","output":"str","x":510,"y":940,"wires":[["b59b1f4c.0ec78"]]},{"id":"b59b1f4c.0ec78","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":690,"y":940,"wires":[[]]},{"id":"ebaeeace.a4f718","type":"delay","z":"b00e2d77.a9931","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":940,"wires":[["a352da15.0d4288"]]},{"id":"582b503f.5fb22","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export Successful','Export Successful', '{{timestamp}}', '{{timestamp}}');","output":"str","x":680,"y":780,"wires":[["5c50a3a4.23c89c"]]},{"id":"5c50a3a4.23c89c","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":830,"y":780,"wires":[[]]},{"id":"ecca07b5.9ea578","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export Failed','Export Failed', '{{timestamp}}', '{{timestamp}}');","output":"str","x":680,"y":620,"wires":[["b09e3e3f.0fe09"]]},{"id":"b09e3e3f.0fe09","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":830,"y":620,"wires":[[]]},{"id":"33c3ae31.e41c62","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Daily Export Triggered','Daily Export Triggered to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":490,"y":900,"wires":[["e7b2f01e.3fbbf"]]},{"id":"e7b2f01e.3fbbf","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":650,"y":900,"wires":[[]]},{"id":"68d64bf.54ca2b4","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":620,"wires":[["ecca07b5.9ea578"]]},{"id":"430823b4.54fdcc","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":900,"wires":[["33c3ae31.e41c62"]]},{"id":"9cb10731.0e0a38","type":"serial in","z":"3b51b3fa.8136dc","name":"","serial":"aae6ab09.c69b28","x":110,"y":100,"wires":[["b47a3123.3b208"]]},{"id":"b47a3123.3b208","type":"switch","z":"3b51b3fa.8136dc","name":"MSG Type","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"[","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":100,"wires":[["bfec026c.c4148"],["d6264d72.9b56e"]]},{"id":"bfec026c.c4148","type":"function","z":"3b51b3fa.8136dc","name":"TRX1 Process Group Message","func":"var payload = msg.payload;\nvar Totallength = payload.length;\n\nvar page = payload.substring(9, Totallength -2);\n\n\nvar str = \"\" + page;\nvar split = str.split(\",\");\nvar contentlength = split[1].length\n\n\n\nvar capcode = split[0];\nvar str = capcode.toString();\nvar strLength = str.length;\nvar pagerStr = str.substring(strLength - 5, strLength);\nvar pagercalc1 = parseInt(pagerStr);\nvar pager = pagercalc1/8;\n\nvar syscode = ((capcode - pagercalc1)-700000)/100000;\n\nif (page.endsWith(\" \")) {\n    var message= split[1].substring(4,contentlength-1)\nvar tidyMessage = message.trim();\n    msg.sender = \"0\"\n} else {\n    var message= split[1].substring(4,contentlength-2)\nvar tidyMessage = message.trim();\n    var sender = split[1].substring(contentlength-2,contentlength)\n    var tidySender = sender.trim();\n    msg.sender = tidySender;\n}\n\nvar group= split[1].substring(0,4)\n\nmsg.capcode = split[0];\nmsg.pagerNumber = group;\nmsg.sysID = syscode\nmsg.content = tidyMessage;\nmsg.payload = page\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":80,"wires":[["7e312125.1eb7b"]]},{"id":"d6264d72.9b56e","type":"function","z":"3b51b3fa.8136dc","name":"TRX1 Process Normal Message","func":"var payload = msg.payload;\nvar Totallength = payload.length;\n\nvar page = payload.substring(9, Totallength -2);\n\n\nvar str = \"\" + page;\nvar split = str.split(\",\");\nvar contentlength = split[1].length\n\n\n\nvar capcode = split[0];\nvar str = capcode.toString();\nvar strLength = str.length;\nvar pagerStr = str.substring(strLength - 5, strLength);\nvar pagercalc1 = parseInt(pagerStr);\nvar pager = pagercalc1/8;\n\nvar syscode = ((capcode - pagercalc1)-700000)/100000;\n\nif (page.endsWith(\" \")) {\n    var message= split[1].substring(0,contentlength-1)\nvar tidyMessage = message.trim();\n    msg.sender = \"0\"\n} else {\n    var message= split[1].substring(0,contentlength-2)\nvar tidyMessage = message.trim();\n    var sender = split[1].substring(contentlength-2,contentlength)\n    var tidySender = sender.trim();\n    msg.sender = tidySender;\n}\n\n\nmsg.capcode = split[0];\nmsg.pagerNumber = pager\nmsg.sysID = syscode\nmsg.content = tidyMessage;\nmsg.payload = page\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":120,"wires":[["7e312125.1eb7b"]]},{"id":"7e312125.1eb7b","type":"function","z":"3b51b3fa.8136dc","name":"Split Content into 2","func":"var payload = msg.content;\n\nvar str = \"\" + payload;\nvar split = str.split(\"-\");\n\nmsg.msgPart1 = split[0];\nmsg.msgPart2 = split[1];\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":100,"wires":[[]]},{"id":"61c3188a.69cf28","type":"template","z":"e3cbac21.52804","name":"Update Active to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Handled', statusTime = '{{timestamp}}' WHERE `sender` = {{sender}} AND `status` = 'Active';","output":"str","x":710,"y":240,"wires":[["51abf5f2.9454cc"]]},{"id":"51abf5f2.9454cc","type":"sqlite","z":"e3cbac21.52804","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":910,"y":240,"wires":[["fb714f6.286fcb"]]},{"id":"bc4b27b0.6d1478","type":"link out","z":"e3cbac21.52804","name":"to Log","links":["13c2aaaa.74d295","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":1415,"y":240,"wires":[]},{"id":"fb714f6.286fcb","type":"template","z":"e3cbac21.52804","name":"Update Late to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Handled', statusTime = '{{timestamp}}' WHERE `sender` = {{sender}} AND `status` = 'Late';","output":"str","x":1110,"y":240,"wires":[["9666bf85.ccc7b"]]},{"id":"9666bf85.ccc7b","type":"sqlite","z":"e3cbac21.52804","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1310,"y":240,"wires":[["bc4b27b0.6d1478"]]},{"id":"c94a9d48.9c2c","type":"link out","z":"e3cbac21.52804","name":"Add to DB","links":["a7862417.604e88","c7eb5365.d6ebd","562eef1b.5da85","8452a925.e651d8","ac279afc.5d13b8"],"x":795,"y":80,"wires":[]},{"id":"65be70e.baef89","type":"comment","z":"e3cbac21.52804","name":"Add to DB","info":"","x":140,"y":180,"wires":[]},{"id":"5652483b.e30f08","type":"link out","z":"e3cbac21.52804","name":"to Log","links":["13c2aaaa.74d295","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":615,"y":280,"wires":[]},{"id":"f00ef931.2b7e68","type":"hostip","z":"60528a1b.f32364","name":"Host IP","x":420,"y":160,"wires":[["7ece05b1.f644dc","88463608.a1be98"]]},{"id":"88463608.a1be98","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"ip","pt":"global","to":"payload[0].address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":120,"wires":[[]]},{"id":"66e288bb.f91b28","type":"inject","z":"60528a1b.f32364","name":"Initiate Global Variables","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0","x":190,"y":160,"wires":[["f00ef931.2b7e68","7a7e9dde.7b8004","577e3b25.879e44","b6c859b7.94b658","df83a534.775ff8","75e740cb.10229","d57eea24.248848","1ecf1066.91d79","64152e36.bad9a","702ec949.a6b798","b97ab582.64ca48","e9329103.798d6","2787e72e.d4af98","5ea3efa2.1fb7a"]]},{"id":"9a7d50bd.7cef2","type":"comment","z":"60528a1b.f32364","name":"Save IP Address","info":"","x":880,"y":160,"wires":[]},{"id":"7fda91ad.06b69","type":"template","z":"60528a1b.f32364","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'group', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime', 'FP', 'payload') VALUES ('0', '0', '{{global.sysID}}', '0', 'Power On ({{global.ip}})', 'n/a', 'n/a', 'System','{{payload}}', 'Power On', '{{payload}}', 'n/a', 'n/a');","output":"str","x":580,"y":200,"wires":[["64f95549.289fdc"]]},{"id":"64f95549.289fdc","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":730,"y":200,"wires":[[]]},{"id":"7a7e9dde.7b8004","type":"delay","z":"60528a1b.f32364","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":430,"y":200,"wires":[["7fda91ad.06b69"]]},{"id":"adbc8745.6a7b98","type":"comment","z":"60528a1b.f32364","name":"Write Power On Message to Log","info":"","x":950,"y":200,"wires":[]},{"id":"8ef3cc6f.9a91a","type":"template","z":"60528a1b.f32364","name":"Left Header","field":"left","fieldType":"global","format":"handlebars","syntax":"mustache","template":"    {{#payload}}\n        <a href=\"/{{Address}}\" class=\"settings\">{{Name}}</a>\n        <BR>\n    {{/payload}}","output":"str","x":910,"y":640,"wires":[[]]},{"id":"bdee1a5f.1f3dc8","type":"comment","z":"60528a1b.f32364","name":"Set Left Header Links","info":"","x":1260,"y":640,"wires":[]},{"id":"5d9f879a.ab2cf8","type":"http response","z":"b00e2d77.a9931","name":"","statusCode":"","headers":{},"x":750,"y":200,"wires":[]},{"id":"4e44e038.08395","type":"template","z":"b00e2d77.a9931","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n     <div class=\"left\">\n            {{{global.left}}}\n        </div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n</body>\n\n</html>","output":"str","x":630,"y":200,"wires":[["5d9f879a.ab2cf8"]]},{"id":"cf30e34b.c1eb2","type":"change","z":"b00e2d77.a9931","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Export Menu","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":200,"wires":[["72aa7d10.d1af44"]]},{"id":"29aa4748.4a38f8","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"to","pt":"global","to":"payload[0].email","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":360,"wires":[[]]},{"id":"43bab4a0.45f19c","type":"comment","z":"60528a1b.f32364","name":"Set S/W Version","info":"","x":780,"y":480,"wires":[]},{"id":"43ccf7d3.ddd008","type":"comment","z":"60528a1b.f32364","name":"Set Email","info":"","x":760,"y":360,"wires":[]},{"id":"89ede062.46b22","type":"comment","z":"b00e2d77.a9931","name":"Put Settings On the Webpage","info":"","x":140,"y":280,"wires":[]},{"id":"a29f518.92ac7b","type":"websocket out","z":"b00e2d77.a9931","name":"","server":"b7dfd67b.7d7948","client":"","x":570,"y":320,"wires":[]},{"id":"1228ef46.2a9871","type":"template","z":"b00e2d77.a9931","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<div class=\"\">\n<div class=\"\"><p class=\"notes\">Click on the buttons below to email the relevant report immediately.</p><button class=\"name\" onclick=\"send.send('ExportNew')\">Export New (Unexported) Log Records</button></div>\n<div class=\"\"><button class=\"name\" onclick=\"send.send('ExportAll')\">Export All Log Records</button></div>\n<div class=\"\"><button class=\"name\" onclick=\"send.send('ExportUSB')\">Export to USB</button></div>\n</div>","output":"str","x":390,"y":320,"wires":[["a29f518.92ac7b"]]},{"id":"f72ff61b.e8d618","type":"link in","z":"b00e2d77.a9931","name":"log","links":["363f5c70.e7e144","320906f1.fd1fba","ecbc4376.b117e","d2d8b8d2.67e9a8","8469e8af.2a6df8","2c38eaf2.df6f76","bc4b27b0.6d1478","5652483b.e30f08","e14222d1.c9cb7","f40e69c9.7d2798","18e72d9f.360682","80365a9f.6e5ef8","5ce459da.1e66f8","dde42ec0.d2e1f","50e59502.8aad2c","38eb5a75.961926"],"x":275,"y":360,"wires":[["1228ef46.2a9871"]]},{"id":"2e977b67.7b7c54","type":"websocket in","z":"b00e2d77.a9931","name":"","server":"c78d8a51.8b8ed8","client":"","x":100,"y":320,"wires":[["e979859b.b1bd58"]]},{"id":"e979859b.b1bd58","type":"switch","z":"b00e2d77.a9931","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":320,"wires":[["1228ef46.2a9871"]]},{"id":"72aa7d10.d1af44","type":"template","z":"b00e2d77.a9931","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/export/receive');\nvar send = new WebSocket('ws://' + location.host + '/export/send');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":510,"y":200,"wires":[["4e44e038.08395"]]},{"id":"3e94fc51.b74054","type":"switch","z":"b00e2d77.a9931","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"},{"t":"eq","v":"ExportNew","vt":"str"},{"t":"eq","v":"ExportAll","vt":"str"},{"t":"eq","v":"ExportUSB","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":250,"y":460,"wires":[[],["cf368fd3.b1f24"],["296e6582.99004a"],["9ebb47d8.f65978"]]},{"id":"64248c60.900b94","type":"websocket in","z":"b00e2d77.a9931","name":"","server":"c78d8a51.8b8ed8","client":"","x":100,"y":460,"wires":[["3e94fc51.b74054"]]},{"id":"8dc6af04.088a3","type":"link out","z":"b00e2d77.a9931","name":"","links":["86082327.d62aa"],"x":815,"y":440,"wires":[]},{"id":"9b0374d2.8917a8","type":"link out","z":"b00e2d77.a9931","name":"","links":["223b37e8.4b69d8"],"x":815,"y":480,"wires":[]},{"id":"d27040b1.bd22","type":"comment","z":"b00e2d77.a9931","name":"Handle Input from Webpage","info":"","x":140,"y":400,"wires":[]},{"id":"878807fc.17f708","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export All','Export All to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":550,"y":480,"wires":[["36c49da8.b2b1c2"]]},{"id":"36c49da8.b2b1c2","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":710,"y":480,"wires":[["9b0374d2.8917a8"]]},{"id":"3e07d8e1.991e78","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export New','Export New to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":550,"y":440,"wires":[["6886cec4.f705c"]]},{"id":"6886cec4.f705c","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":710,"y":440,"wires":[["8dc6af04.088a3"]]},{"id":"cf368fd3.b1f24","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":440,"wires":[["3e07d8e1.991e78"]]},{"id":"296e6582.99004a","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":480,"wires":[["878807fc.17f708"]]},{"id":"fd4ba03e.ba97d","type":"comment","z":"60528a1b.f32364","name":"Set Modules","info":"","x":1070,"y":640,"wires":[]},{"id":"7aa6b39d.f2722c","type":"http response","z":"60528a1b.f32364","name":"","statusCode":"","headers":{},"x":830,"y":800,"wires":[]},{"id":"95a0170a.fdab58","type":"template","z":"60528a1b.f32364","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n\n    <LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n\n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.left}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\nSorry your not able to access this page\n</div>\n\n</body>\n\n</html>","output":"str","x":710,"y":800,"wires":[["7aa6b39d.f2722c"]]},{"id":"102ab00f.0b28b","type":"change","z":"60528a1b.f32364","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Unavaliable Module","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":800,"wires":[["6ec81c61.061cd4"]]},{"id":"6ec81c61.061cd4","type":"template","z":"60528a1b.f32364","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n   alert(txt);\n};\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":590,"y":800,"wires":[["95a0170a.fdab58"]]},{"id":"f13a1f16.82872","type":"link in","z":"60528a1b.f32364","name":"Not Licenced","links":["34ba01df.30c98e","981f0079.8aed3","ae2f0aa6.b83788","c1934064.6743e","3ef1e38d.001f0c","f99490de.c1fcb","28a27e6d.5aef12","7c60ce85.df3bb","1f567951.b54357","985d53b9.d1886","35068c2f.a9b8b4","7eec4d28.128ec4","e9c91e07.38088","c6b24bdc.0d6158","d2ce817e.0c903","70722b52.c7b7d4","ce2ef575.3ca4f8","1bdee69f.d69879","826d284d.cae348","a9e43bb2.c39a08"],"x":375,"y":800,"wires":[["102ab00f.0b28b"]]},{"id":"6ca3eb83.432e44","type":"comment","z":"60528a1b.f32364","name":"Unlicenced Module Webpage","info":"this Flow is the webpage that is served if a user tries to access a page they are not licenced for. this can be triggered from any page by a link node.","x":480,"y":760,"wires":[]},{"id":"57140bc4.737114","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'ExportUSB','Export All to USB', '{{timestamp}}', '{{timestamp}}');","output":"str","x":550,"y":520,"wires":[["aa2c8114.eb4a8"]]},{"id":"aa2c8114.eb4a8","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":710,"y":520,"wires":[["2a3fe792.b505c8"]]},{"id":"9ebb47d8.f65978","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":520,"wires":[["57140bc4.737114"]]},{"id":"2a3fe792.b505c8","type":"template","z":"b00e2d77.a9931","name":"Export All","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT \n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log`\n\nORDER BY  `rxTime` DESC;","output":"str","x":920,"y":480,"wires":[["f18406a.f7faef8"]]},{"id":"f18406a.f7faef8","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1070,"y":480,"wires":[["390160a5.8ab92","81235432.a8b4d8"]]},{"id":"390160a5.8ab92","type":"function","z":"b00e2d77.a9931","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \nvar rxtime = new Date(msg.payload[i].rxTime);\nvar statusTime = new Date(msg.payload[i].statusTime);\nvar exportedTime = new Date(msg.payload[i].exported);\n\nif (msg.payload[i].exported === null) {\n    msg.payload[i].ExportedTime = \"n/a\"\n} else {\nmsg.payload[i].ExportedTime = exportedTime\n}\n\nmsg.payload[i].StatusTime = statusTime\nmsg.payload[i].ReceivedTime = rxtime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":480,"wires":[["ae68ab8d.892138"]]},{"id":"ae68ab8d.892138","type":"csv","z":"b00e2d77.a9931","name":"","sep":",","hdrin":"","hdrout":true,"multi":"one","ret":"\\n","temp":"Index, Call Point, Alias, Message, ReceivedTime, Status, StatusTime, ExportedTime, Recipient, System ID","skip":"0","x":1430,"y":480,"wires":[["37d0780.6d43088"]]},{"id":"6718e06d.1a7ba","type":"file","z":"b00e2d77.a9931","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1690,"y":480,"wires":[["8733b6b6.ceecc8","5976af7.cc2d25"]]},{"id":"37d0780.6d43088","type":"template","z":"b00e2d77.a9931","name":"","field":"filename","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"/media/usb0/log/{{timestamp}}.csv","output":"str","x":1560,"y":480,"wires":[["6718e06d.1a7ba"]]},{"id":"df0dd902.e39c78","type":"catch","z":"b00e2d77.a9931","name":"","scope":["6718e06d.1a7ba"],"x":1690,"y":440,"wires":[["5c219c0f.48fa14","b5112973.1619b8"]]},{"id":"bc5cc87f.5767a8","type":"websocket out","z":"b00e2d77.a9931","name":"Show Alert for File Error","server":"91b7d145.fc4e5","client":"","x":2090,"y":460,"wires":[]},{"id":"5c219c0f.48fa14","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Error exporting to USB, Please check USB Stick is inserted","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1860,"y":440,"wires":[["bc5cc87f.5767a8","88debd97.7e53e"]]},{"id":"8733b6b6.ceecc8","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Export Complete","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1860,"y":480,"wires":[["bc5cc87f.5767a8","88debd97.7e53e"]]},{"id":"5976af7.cc2d25","type":"debug","z":"b00e2d77.a9931","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1830,"y":520,"wires":[]},{"id":"b5112973.1619b8","type":"debug","z":"b00e2d77.a9931","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1830,"y":400,"wires":[]},{"id":"88debd97.7e53e","type":"debug","z":"b00e2d77.a9931","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":2070,"y":540,"wires":[]},{"id":"18ef9926.ad6897","type":"comment","z":"3b51b3fa.8136dc","name":"Receive Page WiTOPTech","info":"","x":150,"y":60,"wires":[]},{"id":"b87ce58f.a17ea8","type":"comment","z":"85d51a2d.db2228","name":"Receive Page SDR","info":"","x":130,"y":20,"wires":[]},{"id":"9fd61880.516a68","type":"comment","z":"23c43518.b3ff0a","name":"Put Unprocessed On the Webpage","info":"","x":180,"y":240,"wires":[]},{"id":"409c8cb4.786734","type":"http in","z":"23c43518.b3ff0a","name":"","url":"/display","method":"get","upload":false,"swaggerDoc":"","x":110,"y":180,"wires":[["815b7467.abb828"]]},{"id":"ebcd4c65.6046a","type":"template","z":"23c43518.b3ff0a","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT `index`, `pagerNumber`, `sysID`, `content`, `msgPart1`, `msgPart2`, `sender`, `rxTime`, `status`, `FP`\nFROM `log`\nWHERE  `status` = 'Active' OR `status` = 'Late'\nORDER BY  `rxTime` DESC ","output":"str","x":290,"y":280,"wires":[["66291f5f.af93b"]]},{"id":"6264593.4e61aa8","type":"websocket out","z":"23c43518.b3ff0a","name":"","server":"d9d1357a.d4f118","client":"","x":1340,"y":280,"wires":[]},{"id":"dca11650.a5a9e8","type":"comment","z":"23c43518.b3ff0a","name":"Build Webpage","info":"","x":120,"y":20,"wires":[]},{"id":"66291f5f.af93b","type":"sqlite","z":"23c43518.b3ff0a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":470,"y":280,"wires":[["16a49dc6.39c7b2"]]},{"id":"75cd0257.5b5c8c","type":"template","z":"23c43518.b3ff0a","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"  <div class=\"nested\">\n        <div class=\"bold\">Index</div>\n        <div class=\"bold\">Location</div>\n        <div class=\"bold\">Message</div>\n        <div class=\"bold\">Time</div>\n        <div class=\"bold\">Date</div>\n        <div class=\"bold\">Elapsed</div>\n      </div>\n      \n{{#payload}}\n  <div class=\"nested {{style}}\" style=\"color:black;\" onclick= send.send('{{index}}')>\n        <div>{{{index}}}</div>\n        <div>{{{msgPart2}}} {{sender}}</div>\n        <div>{{{msgPart1}}}</div>\n        <div>{{{displayTime}}}</div>\n        <div>{{{displayDate}}}</div>\n        <div>{{{elapsed}}}</div>\n      </div>\n{{/payload}}","output":"str","x":1150,"y":280,"wires":[["6264593.4e61aa8"]]},{"id":"5ea79923.89c6a8","type":"function","z":"23c43518.b3ff0a","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":280,"wires":[["ce83b6ba.b91948"]]},{"id":"ce83b6ba.b91948","type":"function","z":"23c43518.b3ff0a","name":"Time elapsed","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = msg.payload[i].rxTime;\n   var now = Date.now();\n   \nvar elapsedTS = now -rxtime;\nvar elapsedS = parseInt(elapsedTS / 1000);\n\nvar date = new Date(null);  \ndate.setSeconds(elapsedS); // specify value for SECONDS here\nvar elapsed = date.toISOString().substr(11, 8);        \n\nmsg.payload[i].elapsed = elapsed\n\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":280,"wires":[["75cd0257.5b5c8c"]]},{"id":"5c4d6c4d.b2cf34","type":"inject","z":"23c43518.b3ff0a","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":280,"wires":[["ebcd4c65.6046a"]]},{"id":"6cdc803d.e7a58","type":"http in","z":"23c43518.b3ff0a","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":100,"y":100,"wires":[["4b37da86.0f11f4"]]},{"id":"c0f55161.eb2e9","type":"websocket in","z":"23c43518.b3ff0a","name":"","server":"95962f80.19ef3","client":"","x":120,"y":380,"wires":[["d47e3460.18a298"]]},{"id":"e4b4571a.fa0ca8","type":"comment","z":"23c43518.b3ff0a","name":"Hide Message on Click","info":"","x":140,"y":340,"wires":[]},{"id":"3dc80a3a.37f5b6","type":"template","z":"23c43518.b3ff0a","name":"Update Active to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Manually Removed', statusTime = '{{timestamp}}' WHERE `index` = {{payload}};","output":"str","x":590,"y":380,"wires":[["81d2af9c.b2af1"]]},{"id":"81d2af9c.b2af1","type":"sqlite","z":"23c43518.b3ff0a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":790,"y":380,"wires":[["28ec47d.cd906b8"]]},{"id":"28ec47d.cd906b8","type":"link out","z":"23c43518.b3ff0a","name":"","links":["13c2aaaa.74d295","f8b2c7bc.b77368","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec"],"x":895,"y":380,"wires":[]},{"id":"bde9417c.ae3fa","type":"change","z":"23c43518.b3ff0a","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":380,"wires":[["3dc80a3a.37f5b6"]]},{"id":"47f470.6d282b9","type":"http response","z":"23c43518.b3ff0a","name":"","statusCode":"","headers":{},"x":790,"y":180,"wires":[]},{"id":"9b9c90b8.58988","type":"template","z":"23c43518.b3ff0a","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n<LINK href=\"FP.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    \n<audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n\n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.left}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n\n\n</body>\n\n</html>","output":"str","x":670,"y":180,"wires":[["47f470.6d282b9"]]},{"id":"5e777687.bf0378","type":"change","z":"23c43518.b3ff0a","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Dynamic Display","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":180,"wires":[["9b1e3c99.05267"]]},{"id":"d47e3460.18a298","type":"switch","z":"23c43518.b3ff0a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"9999","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":380,"wires":[["bde9417c.ae3fa"]]},{"id":"7135ce58.df4ed","type":"split","z":"85d51a2d.db2228","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["b18c7c2.49bbc8"]]},{"id":"b18c7c2.49bbc8","type":"switch","z":"85d51a2d.db2228","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"Alpha","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":590,"y":60,"wires":[["ea4e9b5b.1385a8","a824ad1c.7ee63"]]},{"id":"db876576.365048","type":"change","z":"85d51a2d.db2228","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":120,"wires":[["ec37a628.716678"]]},{"id":"ec37a628.716678","type":"file","z":"85d51a2d.db2228","name":"","filename":"/var/www/pager/received.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","x":720,"y":120,"wires":[[]]},{"id":"6d186ac0.e7f904","type":"inject","z":"85d51a2d.db2228","name":"","topic":"","payload":"","payloadType":"str","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":60,"wires":[[]]},{"id":"1c485e4b.a63e92","type":"subflow:76a9f5f0.1cf2dc","z":"e3cbac21.52804","name":"","x":490,"y":80,"wires":[["cd63b42b.c622b8"]]},{"id":"ea0ecadf.2504f8","type":"comment","z":"e3cbac21.52804","name":"Receive Page","info":"","x":150,"y":20,"wires":[]},{"id":"4c566771.e36038","type":"template","z":"e3cbac21.52804","name":"Add Msg to DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'group', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime', 'FP', 'payload') VALUES ('{{capcode}}', '{{pagerNumber}}', '{{sysID}}', '{{{group}}}', '{{content}}', '{{msgPart1}}', '{{msgPart2}}', '{{sender}}','{{timestamp}}', '{{Status}}', '{{timestamp}}', '{{{FP}}}', '{{payload}}');","output":"str","x":200,"y":240,"wires":[["76901721.920c58"]]},{"id":"c7eb5365.d6ebd","type":"link in","z":"e3cbac21.52804","name":"Received Page","links":["c94a9d48.9c2c"],"x":75,"y":240,"wires":[["4c566771.e36038"]]},{"id":"76901721.920c58","type":"sqlite","z":"e3cbac21.52804","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":390,"y":240,"wires":[["bd94c0cf.ee355"]]},{"id":"bd94c0cf.ee355","type":"switch","z":"e3cbac21.52804","name":"","property":"Status","propertyType":"msg","rules":[{"t":"eq","v":"Attended","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":240,"wires":[["61c3188a.69cf28"],["5652483b.e30f08"]]},{"id":"6862b344.2783ac","type":"function","z":"76a9f5f0.1cf2dc","name":"LRS Process Page","func":"//Input\nvar payload = msg.payload;\nvar shortened = payload.slice(6,payload.length -2) //Remove Serial Data from front of Message\nvar duplicate = msg.duplicate;\n//Get Capcode and Message\nvar capcode = shortened.substring(1,8);\nvar message = shortened.substring(9,payload.length);\n\n//Calculate Pager number and SysID\nvar cc = capcode.toString();\nvar pagerStr = cc.substring(cc.length - 5, cc.Length);\nvar pagercalc = parseInt(pagerStr);\nvar pagerNumber = pagercalc/8;\nvar sysID = ((capcode - pagercalc)-700000)/100000;\n\n//Check If Group Message\nif (message.includes(\"[\")) {\n    var group = message.substring(1,3);\n    var msgStart = message.indexOf(\"]\") + 1;\n} else { \n    var group = \"n/a\";\n    var msgStart = 0;\n}\n\n//Check If Contains Flash Pattern and Get Sender ID\nif (message.includes(\"%\")) {\n    var percentIndex = message.indexOf(\"%\"); //Find Index of %\n    var FP = message.substring(percentIndex + 3,message.length);\n    var senderMessy = message.substring(percentIndex - 2, percentIndex);\n    var sender = senderMessy.trim();\n    var msgEnd = percentIndex -3;\n} else { \n    var FP = \"n/a\";\n    var senderMessy = message.substring(message.length - 2, message.length);\n    var sender = senderMessy.trim();\n    var msgEnd = message.length - 2;\n}\n\n//Get Total Message\nvar content = message.substring(msgStart,msgEnd);\n\n//Split Message into Part 1 and Part 2\nvar Part = content.split(\"-\");\n\nvar msgPart1 = Part[0];\nvar msgPart2 = Part[1];\n\n//Set Status Message\n\nif (message.includes(\"Handled\")) {\n   var status = \"Attended\";\n} else if (message.includes(\"Late\")) {\n    var status = \"Late\";\n} else if (duplicate === true) {\n    var status = \"Duplicate\";\n}else {\n    var status = \"Active\";\n}\n\n//Outputs\nmsg.capcode = capcode;  //Capcode\nmsg.pagerNumber = pagerNumber; //Pager Number\nmsg.sysID = sysID; //System ID\nmsg.group = group; //Group Number\nmsg.content = content; //Whole Message\nmsg.msgPart1 = msgPart1 //Part One of Message\nmsg.msgPart2 = msgPart2 //Part Two of Message\nmsg.sender = sender; //Originating Button or Table\nmsg.timestamp = Date.now(); //Current Timestamp\nmsg.Status = status; //Status\nmsg.FP = FP; //Flash Pattern\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":100,"wires":[[]]},{"id":"362ce8e2.692a68","type":"comment","z":"76a9f5f0.1cf2dc","name":"Receive Page LRS","info":"","x":130,"y":80,"wires":[]},{"id":"c225fa15.f34b38","type":"switch","z":"76a9f5f0.1cf2dc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"prev"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":120,"wires":[["36078a36.43f4d6"],["27bb61c3.cc600e"]]},{"id":"27bb61c3.cc600e","type":"switch","z":"76a9f5f0.1cf2dc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Reset","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":140,"wires":[["6862b344.2783ac"],[]]},{"id":"590a7a2d.90e434","type":"delay","z":"76a9f5f0.1cf2dc","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":160,"wires":[["badbbd1e.54555"]]},{"id":"badbbd1e.54555","type":"change","z":"76a9f5f0.1cf2dc","name":"Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"Reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":160,"wires":[["c225fa15.f34b38"]]},{"id":"36078a36.43f4d6","type":"change","z":"76a9f5f0.1cf2dc","name":"","rules":[{"t":"set","p":"duplicate","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":100,"wires":[["6862b344.2783ac"]]},{"id":"b5533914.8b1f58","type":"delay","z":"76a9f5f0.1cf2dc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":280,"y":160,"wires":[["590a7a2d.90e434"]]},{"id":"4437d3de.ca8fdc","type":"function","z":"85d51a2d.db2228","name":"SDR Process Page","func":"//Input\nvar payload = msg.payload;\nvar processed = payload.slice(22,payload.length) //Remove Serial Data from front of Message\nvar duplicate = msg.duplicate;\nvar processed2 = processed.replace(/<NUL>/g , \"\");\nvar shortened = processed2.replace(/<FF>/g , \"%\");\n\n//Get Capcode and Message\nvar capcode = shortened.substring(0,6);\nvar message = shortened.substring(28,payload.length);\n\n//Calculate Pager number and SysID\nvar cc = capcode.toString();\nvar pagerStr = cc.substring(cc.length - 5, cc.Length);\nvar pagercalc = parseInt(pagerStr);\nvar pagerNumber = pagercalc/8;\nvar sysID = ((capcode - pagercalc)-700000)/100000;\n\n//Check If Group Message\nif (message.includes(\"[\")) {\n    var group = message.substring(1,3);\n    var msgStart = message.indexOf(\"]\") + 1;\n} else { \n    var group = \"n/a\";\n    var msgStart = 2;\n}\n\n//Check If Contains Flash Pattern and Get Sender ID\nif (message.includes(\"%\")) {\n    var percentIndex = message.indexOf(\"%\"); //Find Index of %\n    var FP = message.substring(percentIndex + 1,message.length);\n    var senderMessy = message.substring(percentIndex - 1, percentIndex);\n    var sender = senderMessy.trim();\n    var msgEnd = percentIndex -1;\n} else { \n    var FP = \"n/a\";\n    var senderMessy = message.substring(message.length - 2, message.length);\n    var sender = senderMessy.trim();\n    var msgEnd = message.length -2;\n}\n\n//Get Total Message\nvar content = message.substring(msgStart,msgEnd);\n\n//Split Message into Part 1 and Part 2\nvar Part = content.split(\"-\");\n\nvar msgPart1 = Part[0];\nvar msgPart2 = Part[1];\n\n//Set Status Message\n\nif (message.includes(\"Handled\")) {\n   var status = \"Attended\";\n} else if (message.includes(\"Late\")) {\n    var status = \"Late\";\n} else if (duplicate === true) {\n    var status = \"Duplicate\";\n}else {\n    var status = \"Active\";\n}\n\n//Outputs\nmsg.capcode = capcode;  //Capcode\nmsg.pagerNumber = pagerNumber; //Pager Number\nmsg.sysID = sysID; //System ID\nmsg.group = group; //Group Number\nmsg.content = content; //Whole Message\nmsg.msgPart1 = msgPart1 //Part One of Message\nmsg.msgPart2 = msgPart2 //Part Two of Message\nmsg.sender = sender; //Originating Button or Table\nmsg.timestamp = Date.now(); //Current Timestamp\nmsg.Status = status; //Status\nmsg.FP = FP; //Flash Pattern\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":1590,"y":60,"wires":[[]]},{"id":"a824ad1c.7ee63","type":"switch","z":"85d51a2d.db2228","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"prev"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":60,"wires":[["d3ace321.da0a2"],["86f322ba.5684b"]]},{"id":"86f322ba.5684b","type":"switch","z":"85d51a2d.db2228","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Reset","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1330,"y":80,"wires":[["4437d3de.ca8fdc"],[]]},{"id":"d4ae2e26.c386","type":"delay","z":"85d51a2d.db2228","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":920,"y":80,"wires":[["b87018e8.c974d8"]]},{"id":"b87018e8.c974d8","type":"change","z":"85d51a2d.db2228","name":"Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"Reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":80,"wires":[["a824ad1c.7ee63"]]},{"id":"d3ace321.da0a2","type":"change","z":"85d51a2d.db2228","name":"","rules":[{"t":"set","p":"duplicate","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":40,"wires":[["4437d3de.ca8fdc"]]},{"id":"ea4e9b5b.1385a8","type":"delay","z":"85d51a2d.db2228","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":760,"y":80,"wires":[["d4ae2e26.c386"]]},{"id":"16a49dc6.39c7b2","type":"function","z":"23c43518.b3ff0a","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"default\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":280,"wires":[["5ea79923.89c6a8"]]},{"id":"734abd62.6c0054","type":"serial out","z":"dad6f0f1.28177","name":"","serial":"185c72ea.39ebed","x":770,"y":260,"wires":[]},{"id":"66a1cd6e.22e4e4","type":"inject","z":"dad6f0f1.28177","name":"Enable Dry Contact 0","topic":"","payload":"SINP,1,911,Door   ","payloadType":"string","repeat":"","crontab":"","once":false,"x":520,"y":140,"wires":[["734abd62.6c0054"]]},{"id":"8e4d5133.e1bf3","type":"inject","z":"dad6f0f1.28177","name":"Repeat Off","topic":"","payload":"RPTRX,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":560,"y":100,"wires":[["734abd62.6c0054"]]},{"id":"39d79a16.339446","type":"inject","z":"dad6f0f1.28177","name":"Enable Receive","topic":"","payload":"INTFMODE,1","payloadType":"string","repeat":"","crontab":"","once":false,"x":540,"y":220,"wires":[["734abd62.6c0054"]]},{"id":"cbe825bf.1337a8","type":"inject","z":"dad6f0f1.28177","name":"Send Page","topic":"","payload":"CCPAGE,0707288,Hello World","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":560,"y":260,"wires":[["734abd62.6c0054"]]},{"id":"e34f4022.12139","type":"inject","z":"dad6f0f1.28177","name":"Enable Dry Contact 1","topic":"","payload":"SINP1,1,911,Door   ","payloadType":"string","repeat":"","crontab":"","once":false,"x":520,"y":180,"wires":[["734abd62.6c0054"]]},{"id":"37e179b9.9b9f86","type":"comment","z":"b8bd1cc3.4827","name":"Put Unprocessed On the Webpage","info":"","x":200,"y":260,"wires":[]},{"id":"f1c61ac.2a61be8","type":"template","z":"b8bd1cc3.4827","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT `index`, `pagerNumber`, `sysID`, `content`, `msgPart1`, `msgPart2`, `sender`, `rxTime`, `status`, `FP`, `rxTime`,`payload`\nFROM `log`\nWHERE  `status` = 'Active' OR `status` = 'Late'\nORDER BY  `rxTime` DESC \nLIMIT 5;","output":"str","x":330,"y":300,"wires":[["f1a5e48e.f2da48"]]},{"id":"daef15a.4ef89e8","type":"websocket out","z":"b8bd1cc3.4827","name":"","server":"5e6c9ab1.74ef04","client":"","x":1390,"y":300,"wires":[]},{"id":"f1a5e48e.f2da48","type":"sqlite","z":"b8bd1cc3.4827","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":510,"y":300,"wires":[["c1b56b46.0f7818","3f35a816.675e18"]]},{"id":"8be4aba0.feaed8","type":"template","z":"b8bd1cc3.4827","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{#payload}}\n\n  <div class=\"FADisplay {{style}}\" onclick= send.send('{{index}}') >\n     {{{msgPart1}}}\n     <BR>\n     {{{msgPart2}}} {{sender}}\n     <BR>\n     {{{elapsed}}}\n   </div>\n{{/payload}}","output":"str","x":1210,"y":300,"wires":[["daef15a.4ef89e8"]]},{"id":"3eca0fc8.c120d","type":"websocket in","z":"b8bd1cc3.4827","name":"","server":"addfeab3.3935e8","client":"","x":140,"y":460,"wires":[["c5eb9330.50819"]]},{"id":"1f847469.688d7c","type":"comment","z":"b8bd1cc3.4827","name":"Hide Message on Click","info":"","x":160,"y":420,"wires":[]},{"id":"cd533235.40194","type":"template","z":"b8bd1cc3.4827","name":"Update Active to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Manually Removed', statusTime = '{{timestamp}}' WHERE `index` = {{payload}};","output":"str","x":610,"y":440,"wires":[["3e54b72d.158e18"]]},{"id":"3e54b72d.158e18","type":"sqlite","z":"b8bd1cc3.4827","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":810,"y":440,"wires":[["18e72d9f.360682"]]},{"id":"18e72d9f.360682","type":"link out","z":"b8bd1cc3.4827","name":"","links":["13c2aaaa.74d295","8452a925.e651d8","f72ff61b.e8d618","f8b2c7bc.b77368","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":915,"y":440,"wires":[]},{"id":"a760c9de.c3c958","type":"change","z":"b8bd1cc3.4827","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":440,"wires":[["cd533235.40194"]]},{"id":"c5eb9330.50819","type":"switch","z":"b8bd1cc3.4827","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"9999","v2t":"num"},{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":460,"wires":[["a760c9de.c3c958"],["91921094.a8632"]]},{"id":"8452a925.e651d8","type":"link in","z":"b8bd1cc3.4827","name":"Received Page","links":["c94a9d48.9c2c","91921094.a8632","18e72d9f.360682"],"x":215,"y":340,"wires":[["f1c61ac.2a61be8"]]},{"id":"c1b56b46.0f7818","type":"function","z":"b8bd1cc3.4827","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"default\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":300,"wires":[["7502bae2.b01d14"]]},{"id":"91921094.a8632","type":"link out","z":"b8bd1cc3.4827","name":"","links":["8452a925.e651d8"],"x":375,"y":480,"wires":[]},{"id":"6d21559e.0372fc","type":"http in","z":"b8bd1cc3.4827","name":"","url":"/firstaid","method":"get","upload":false,"swaggerDoc":"","x":130,"y":180,"wires":[["e27d3777.8cf898","6d3d48bb.e324b8"]]},{"id":"8e112c9a.4a00a","type":"comment","z":"b8bd1cc3.4827","name":"Build Webpage","info":"","x":140,"y":20,"wires":[]},{"id":"23c32a03.41b276","type":"http response","z":"b8bd1cc3.4827","name":"","statusCode":"","headers":{},"x":770,"y":160,"wires":[]},{"id":"598c3baa.7efd84","type":"template","z":"b8bd1cc3.4827","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<head>\n\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    <title>{{title}}</title>\n    \n    <script src=\"moment.js\"></script>\n    <script>\n{{{script}}}\n    </script>\n    \n\n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n<LINK href=\"FP.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n\n<audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n\n    <div class=\"heading\">\n\n        <div class=\"left\">\n            {{{global.left}}}\n        </div>\n\n        <div class=\"middle\">\n            <h1 id=\"title\">{{title}}</h1>\n        </div>\n\n        <div class=\"right\">\n            <div class=\"clock\" id=\"time\"></div>\n        </div>\n\n    </div>\n\n    <div class=\"wrapper2\" id=\"data\">\n    </div>\n\n</body>\n\n</html>","output":"str","x":650,"y":160,"wires":[["23c32a03.41b276"]]},{"id":"4d7773b3.0108ec","type":"change","z":"b8bd1cc3.4827","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall First Aid Display","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":160,"wires":[["d3c7d55.b404528"]]},{"id":"33ff1e8e.291482","type":"function","z":"ca9def01.26ba2","name":"Payload to Page","func":"var message = msg.payload;\nvar sendmessage = message; //.replace(/\\n/g, \" \");\nvar capcode = msg.capcode;\nvar address = 0707288;//capcode;\nvar page = \"CCPAGE,\"+ address + \",\"+ sendmessage + \"\\n\";\nmsg.payload = page\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":220,"wires":[["2dd9fe99.b05ae2","8d0ad831.2c6d48","1302589a.0ed467"]]},{"id":"2dd9fe99.b05ae2","type":"debug","z":"ca9def01.26ba2","name":"Page Sent","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":590,"y":180,"wires":[]},{"id":"7b760cf6.6127c4","type":"comment","z":"ca9def01.26ba2","name":"Send Page","info":"","x":140,"y":40,"wires":[]},{"id":"d51608e.09159f8","type":"switch","z":"ca9def01.26ba2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"cont","v":"undefined","vt":"str"},{"t":"cont","v":"null","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":160,"wires":[["38ff2879.47e0b8"],["38ff2879.47e0b8"],["38ff2879.47e0b8"]]},{"id":"38ff2879.47e0b8","type":"change","z":"ca9def01.26ba2","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Please Enter a Message to Send","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":140,"wires":[["f13e64e1.363ed8"]]},{"id":"d19364d9.208968","type":"switch","z":"ca9def01.26ba2","name":"","property":"capcode","propertyType":"msg","rules":[{"t":"null"},{"t":"cont","v":"undefined","vt":"str"},{"t":"cont","v":"null","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":100,"wires":[["ebe0115.f169ff"],["ebe0115.f169ff"],["ebe0115.f169ff"]]},{"id":"ebe0115.f169ff","type":"change","z":"ca9def01.26ba2","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Please Select a User to Send a Page to","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":100,"wires":[["f13e64e1.363ed8"]]},{"id":"f13e64e1.363ed8","type":"delay","z":"ca9def01.26ba2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":690,"y":120,"wires":[[]]},{"id":"fb44d9db.726018","type":"change","z":"ca9def01.26ba2","name":"","rules":[{"t":"set","p":"justSent","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":40,"wires":[[]]},{"id":"8d0ad831.2c6d48","type":"serial out","z":"ca9def01.26ba2","name":"","serial":"5d6eb2f4.fc698c","x":580,"y":220,"wires":[]},{"id":"1302589a.0ed467","type":"serial out","z":"ca9def01.26ba2","name":"","serial":"741a68b.a601698","x":590,"y":260,"wires":[]},{"id":"4c251e8b.6402c","type":"inject","z":"ca9def01.26ba2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":220,"wires":[["33ff1e8e.291482"]]},{"id":"e6a67389.74b79","type":"inject","z":"e3cbac21.52804","name":"Fields","topic":"","payload":"RECV,4,0707288,Fields-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":560,"wires":[["20b00ad9.a4f806"]]},{"id":"8640e243.89df6","type":"inject","z":"e3cbac21.52804","name":"Dispense","topic":"","payload":"RECV,4,0707288,Dispense-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":400,"wires":[["20b00ad9.a4f806"]]},{"id":"4d5bb5e.2bf1d4c","type":"inject","z":"e3cbac21.52804","name":"Contact Lenses","topic":"","payload":"RECV,4,0707288,Contact Lenses-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":440,"wires":[["20b00ad9.a4f806"]]},{"id":"6a5bf06c.fc135","type":"inject","z":"e3cbac21.52804","name":"S.T.O","topic":"","payload":"RECV,4,0707288,S.T.O-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":480,"wires":[["20b00ad9.a4f806"]]},{"id":"22dd9f8a.64805","type":"inject","z":"e3cbac21.52804","name":"Screening","topic":"","payload":"RECV,4,0707288,Screening-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":520,"wires":[["20b00ad9.a4f806"]]},{"id":"44fabae3.3db4e4","type":"inject","z":"e3cbac21.52804","name":"Other","topic":"","payload":"RECV,4,0707288,Other-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":600,"wires":[["20b00ad9.a4f806"]]},{"id":"4c799f99.19a61","type":"inject","z":"e3cbac21.52804","name":"SV Dispense","topic":"","payload":"RECV,4,0707288,SV Dispense-Rm. 6","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":640,"wires":[["20b00ad9.a4f806"]]},{"id":"c0a5f342.0797","type":"inject","z":"e3cbac21.52804","name":"Multi-focal","topic":"","payload":"RECV,4,0707288,Multi-focal-Rm. 6","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":680,"wires":[["20b00ad9.a4f806"]]},{"id":"aa0c2a8e.b25c88","type":"inject","z":"e3cbac21.52804","name":"Complex RX","topic":"","payload":"RECV,4,0707288,Complex RX-Rm. 6","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":720,"wires":[["20b00ad9.a4f806"]]},{"id":"9d234d71.58c4d","type":"inject","z":"e3cbac21.52804","name":"Fields/Photos","topic":"","payload":"RECV,4,0707288,Fields/Photos-Rm. 6","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":760,"wires":[["20b00ad9.a4f806"]]},{"id":"522ae6c5.5c6358","type":"inject","z":"e3cbac21.52804","name":"Other","topic":"","payload":"RECV,4,0707288,C/L Hearcare-Rm. 6","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":800,"wires":[["20b00ad9.a4f806"]]},{"id":"20b00ad9.a4f806","type":"link out","z":"e3cbac21.52804","name":"","links":["cef4599e.d2faf8"],"x":520,"y":600,"wires":[]},{"id":"cef4599e.d2faf8","type":"link in","z":"e3cbac21.52804","name":"","links":["20b00ad9.a4f806"],"x":335,"y":140,"wires":[["1c485e4b.a63e92"]]},{"id":"e055a06d.48f1a","type":"inject","z":"e3cbac21.52804","name":"Late","topic":"","payload":"RECV,4,0707288,Late-Rm. 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":360,"wires":[["20b00ad9.a4f806"]]},{"id":"f5c9a8af.c8e3d8","type":"inject","z":"b8bd1cc3.4827","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":300,"wires":[["f1c61ac.2a61be8"]]},{"id":"d3c7d55.b404528","type":"template","z":"b8bd1cc3.4827","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"     var receive = new WebSocket('ws://' + location.host + '/firstaid/receive');\n     var send = new WebSocket('ws://' + location.host + '/firstaid/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n  \n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n//Play Sound\nsend.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play()\n};\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n","output":"str","x":530,"y":160,"wires":[["598c3baa.7efd84"]]},{"id":"7502bae2.b01d14","type":"function","z":"b8bd1cc3.4827","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":300,"wires":[["782036fe.ccf868"]]},{"id":"782036fe.ccf868","type":"function","z":"b8bd1cc3.4827","name":"Time elapsed","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = msg.payload[i].rxTime;\n   var now = Date.now();\n   \nvar elapsedTS = now -rxtime;\nvar elapsedS = parseInt(elapsedTS / 1000);\n\nvar date = new Date(null);  \ndate.setSeconds(elapsedS); // specify value for SECONDS here\nvar elapsed = date.toISOString().substr(11, 8);        \n\nmsg.payload[i].elapsed = elapsed\n\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":300,"wires":[["8be4aba0.feaed8"]]},{"id":"347129a0.c27516","type":"comment","z":"d0e2bfbf.dfe3f","name":"Put Unprocessed On the Webpage","info":"","x":200,"y":320,"wires":[]},{"id":"50ca75a6.b021bc","type":"template","z":"d0e2bfbf.dfe3f","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT `index`, `pagerNumber`, `sysID`, `content`, `msgPart1`, `msgPart2`, `sender`, `rxTime`, `status`, `FP`, `rxTime`\nFROM `log`\nWHERE  `status` = 'Active' OR `status` = 'Late'\nORDER BY  `rxTime` ASC\nLIMIT 25;","output":"str","x":290,"y":360,"wires":[["fd8d56d.e7aa7a8"]]},{"id":"2ed84fa4.796ce","type":"websocket out","z":"d0e2bfbf.dfe3f","name":"","server":"4d6db4a9.f35a1c","client":"","x":1330,"y":360,"wires":[]},{"id":"fd8d56d.e7aa7a8","type":"sqlite","z":"d0e2bfbf.dfe3f","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":470,"y":360,"wires":[["95edf698.93a828"]]},{"id":"202c524f.39489e","type":"template","z":"d0e2bfbf.dfe3f","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<div class=\"grid-container\">\n{{#payload}}\n\n  <div class=\"tableDisplay {{style}}\" onclick= send.send('{{index}}') >\n     {{{msgPart1}}}\n     <BR>\n     {{{msgPart2}}} {{sender}}\n     <BR>\n     {{{elapsed}}}\n    \n   </div>\n{{/payload}}\n\n</div>","output":"str","x":1150,"y":360,"wires":[["2ed84fa4.796ce"]]},{"id":"c46324a1.00d1e8","type":"websocket in","z":"d0e2bfbf.dfe3f","name":"","server":"c2e44b88.6a4e78","client":"","x":140,"y":520,"wires":[["942c85de.4a0538"]]},{"id":"3d3f5ebf.ecd7d2","type":"comment","z":"d0e2bfbf.dfe3f","name":"Hide Message on Click","info":"","x":160,"y":480,"wires":[]},{"id":"f28c0a0f.a04258","type":"template","z":"d0e2bfbf.dfe3f","name":"Update Active to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Manually Removed', statusTime = '{{timestamp}}' WHERE `index` = {{payload}};","output":"str","x":610,"y":500,"wires":[["12068c22.433ac4"]]},{"id":"12068c22.433ac4","type":"sqlite","z":"d0e2bfbf.dfe3f","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":810,"y":500,"wires":[["5f3d896d.781188"]]},{"id":"5f3d896d.781188","type":"link out","z":"d0e2bfbf.dfe3f","name":"","links":["13c2aaaa.74d295","7b129f21.76ae3","f72ff61b.e8d618","f8b2c7bc.b77368"],"x":915,"y":500,"wires":[]},{"id":"aa42f2de.8b38c","type":"change","z":"d0e2bfbf.dfe3f","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":500,"wires":[["f28c0a0f.a04258"]]},{"id":"942c85de.4a0538","type":"switch","z":"d0e2bfbf.dfe3f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"9999","v2t":"num"},{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":520,"wires":[["aa42f2de.8b38c"],["adc7e162.e371e"]]},{"id":"7b129f21.76ae3","type":"link in","z":"d0e2bfbf.dfe3f","name":"Received Page","links":["c94a9d48.9c2c","adc7e162.e371e","5f3d896d.781188"],"x":155,"y":400,"wires":[["50ca75a6.b021bc"]]},{"id":"95edf698.93a828","type":"function","z":"d0e2bfbf.dfe3f","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"default\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":360,"wires":[["6a1eea5b.f38504"]]},{"id":"adc7e162.e371e","type":"link out","z":"d0e2bfbf.dfe3f","name":"","links":["7b129f21.76ae3"],"x":375,"y":540,"wires":[]},{"id":"68f940a1.aa25a","type":"http in","z":"d0e2bfbf.dfe3f","name":"","url":"/table","method":"get","upload":false,"swaggerDoc":"","x":120,"y":240,"wires":[["1e6521b9.49276e"]]},{"id":"dd7be086.62c","type":"comment","z":"d0e2bfbf.dfe3f","name":"Build Webpage","info":"","x":140,"y":20,"wires":[]},{"id":"41327f62.b2296","type":"http response","z":"d0e2bfbf.dfe3f","name":"","statusCode":"","headers":{},"x":750,"y":220,"wires":[]},{"id":"4d8cff25.18cce","type":"template","z":"d0e2bfbf.dfe3f","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<head>\n\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    <title>{{title}}</title>\n    \n    <script>\n{{{script}}}\n    </script>\n    \n\n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n<LINK href=\"FP.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n<audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n\n    <div class=\"heading\">\n\n        <div class=\"left\">\n            {{{global.left}}}\n        </div>\n\n        <div class=\"middle\">\n            <h1 id=\"title\">{{title}}</h1>\n        </div>\n\n        <div class=\"right\">\n            <div class=\"clock\" id=\"time\"></div>\n        </div>\n\n    </div>\n\n    <div class=\"wrapper2\" id=\"data\">\n    </div>\n\n</body>\n\n</html>","output":"str","x":630,"y":220,"wires":[["41327f62.b2296"]]},{"id":"b20ec190.c8d73","type":"change","z":"d0e2bfbf.dfe3f","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Table Display","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":220,"wires":[["c20fda87.cc67c8"]]},{"id":"2efce273.a5ca5e","type":"inject","z":"d0e2bfbf.dfe3f","name":"","topic":"","payload":"","payloadType":"str","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":360,"wires":[["50ca75a6.b021bc"]]},{"id":"c20fda87.cc67c8","type":"template","z":"d0e2bfbf.dfe3f","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"     var receive = new WebSocket('ws://' + location.host + '/table/receive');\n     var send = new WebSocket('ws://' + location.host + '/table/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n  \n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n  \n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n//Play Sound\nsend.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play()\n};\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n","output":"str","x":510,"y":220,"wires":[["4d8cff25.18cce"]]},{"id":"6a1eea5b.f38504","type":"function","z":"d0e2bfbf.dfe3f","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":360,"wires":[["a93183fc.ce466"]]},{"id":"a93183fc.ce466","type":"function","z":"d0e2bfbf.dfe3f","name":"Time elapsed","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = msg.payload[i].rxTime;\n   var now = Date.now();\n   \nvar elapsedTS = now -rxtime;\nvar elapsedS = parseInt(elapsedTS / 1000);\n\nvar date = new Date(null);  \ndate.setSeconds(elapsedS); // specify value for SECONDS here\nvar elapsed = date.toISOString().substr(11, 8);        \n\nmsg.payload[i].elapsed = elapsed\n\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":360,"wires":[["202c524f.39489e"]]},{"id":"b8fb71d2.ee132","type":"comment","z":"53e35596.381c0c","name":"Put Quick Page On the Webpage","info":"","x":190,"y":320,"wires":[]},{"id":"c4849d.0bb81b6","type":"template","z":"53e35596.381c0c","name":"Select Quick Page Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM `quick_page`;","output":"str","x":230,"y":360,"wires":[["552dba34.1f3124"]]},{"id":"7b33fb9a.d5c6e4","type":"websocket out","z":"53e35596.381c0c","name":"","server":"b03253f0.29251","client":"","x":790,"y":360,"wires":[]},{"id":"552dba34.1f3124","type":"sqlite","z":"53e35596.381c0c","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":430,"y":360,"wires":[["8ac6b75b.594968"]]},{"id":"8ac6b75b.594968","type":"template","z":"53e35596.381c0c","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<div class=\"grid-container\">\n{{#payload}}\n\n  <div class=\"tableDisplay\" onclick= send.send('{{index}}') >\n     {{{content}}}\n     <BR>\n     to \n     <BR>\n         Pager {{pagerNumber}}:{{sysID}}\n   </div>\n{{/payload}}\n\n</div>","output":"str","x":590,"y":360,"wires":[["7b33fb9a.d5c6e4"]]},{"id":"cfc68d0c.62c43","type":"websocket in","z":"53e35596.381c0c","name":"","server":"25343a6d.90cb36","client":"","x":160,"y":480,"wires":[["a548061f.54f0e8"]]},{"id":"68b8882e.ea23b8","type":"comment","z":"53e35596.381c0c","name":"Send Message on Click","info":"","x":160,"y":440,"wires":[]},{"id":"46042ba6.d8f454","type":"template","z":"53e35596.381c0c","name":"Get Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT *\nFROM `quick_page`\nWHERE `index` = {{payload}};","output":"str","x":600,"y":460,"wires":[["cc8e6c1f.215e6"]]},{"id":"cc8e6c1f.215e6","type":"sqlite","z":"53e35596.381c0c","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":750,"y":460,"wires":[["7b2e6691.d4da08","b52928ed.f9b338"]]},{"id":"e0895cf.e2cc3a","type":"change","z":"53e35596.381c0c","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":460,"wires":[["46042ba6.d8f454"]]},{"id":"a548061f.54f0e8","type":"switch","z":"53e35596.381c0c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"9999","v2t":"num"},{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":480,"wires":[["e0895cf.e2cc3a"],["17234e1e.8eeca2"]]},{"id":"b28b9e2d.bfccc","type":"link in","z":"53e35596.381c0c","name":"Received Page","links":["17234e1e.8eeca2","35084556.d6290a"],"x":75,"y":360,"wires":[["c4849d.0bb81b6"]]},{"id":"17234e1e.8eeca2","type":"link out","z":"53e35596.381c0c","name":"","links":["b28b9e2d.bfccc"],"x":415,"y":500,"wires":[]},{"id":"6ce28d0.bdfa474","type":"http in","z":"53e35596.381c0c","name":"","url":"/quickpage","method":"get","upload":false,"swaggerDoc":"","x":140,"y":240,"wires":[["7530d890.2f9e38"]]},{"id":"49c037c6.8dc4a8","type":"comment","z":"53e35596.381c0c","name":"Build Webpage","info":"","x":140,"y":20,"wires":[]},{"id":"1ec8e1d3.e5803e","type":"http response","z":"53e35596.381c0c","name":"","statusCode":"","headers":{},"x":790,"y":220,"wires":[]},{"id":"89919094.304b","type":"template","z":"53e35596.381c0c","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<head>\n\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    <title>{{title}}</title>\n    \n    <script src=\"moment.js\"></script>\n    <script>\n{{{script}}}\n    </script>\n    \n\n    <LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n\n<audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n\n    <div class=\"heading\">\n\n        <div class=\"left\">\n            {{{global.left}}}\n        </div>\n\n        <div class=\"middle\">\n            <h1 id=\"title\">{{title}}</h1>\n        </div>\n\n        <div class=\"right\">\n            <div class=\"clock\" id=\"time\"></div>\n        </div>\n\n    </div>\n\n    <div class=\"wrapper2\" id=\"data\">\n    </div>\n\n</body>\n\n</html>","output":"str","x":670,"y":220,"wires":[["1ec8e1d3.e5803e"]]},{"id":"22601c7c.9bf294","type":"change","z":"53e35596.381c0c","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Quick Page","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":220,"wires":[["6a9ce3d9.08b75c"]]},{"id":"6a9ce3d9.08b75c","type":"template","z":"53e35596.381c0c","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"     var receive = new WebSocket('ws://' + location.host + '/quickpage/receive');\n     var send = new WebSocket('ws://' + location.host + '/quickpage/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n  \n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n  \n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n//Play Sound\nsend.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play()\n};\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n","output":"str","x":550,"y":220,"wires":[["89919094.304b"]]},{"id":"297421bf.20dd2e","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":80,"wires":[["778882cf.77930c"]]},{"id":"9d24fe8d.65aec","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE \"quick_page\" ( `index` INTEGER PRIMARY KEY AUTOINCREMENT, `pagerNumber` INTEGER, `sysID` INTEGER, `content` TEXT, `FP` TEXT )","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1070,"y":80,"wires":[["297421bf.20dd2e"]]},{"id":"778882cf.77930c","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1390,"y":80,"wires":[]},{"id":"76d7a70a.2fcec8","type":"comment","z":"ba76d305.cf8ad","name":"Log","info":"","x":490,"y":40,"wires":[]},{"id":"de9a1c50.0387e","type":"comment","z":"ba76d305.cf8ad","name":"Quick Page","info":"","x":1230,"y":40,"wires":[]},{"id":"5380aeca.f0398","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1390,"y":120,"wires":[]},{"id":"d2a7806a.847fb","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":120,"wires":[["5380aeca.f0398"]]},{"id":"6727d5f9.79503c","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'quick_page';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1080,"y":120,"wires":[["d2a7806a.847fb"]]},{"id":"13dadbb0.3bee54","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":240,"wires":[["881c792.ec4a688"]]},{"id":"42fa1f34.f12d1","type":"inject","z":"ba76d305.cf8ad","name":"Clear Table","topic":"DELETE FROM 'quick_page';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1070,"y":240,"wires":[["13dadbb0.3bee54"]]},{"id":"71f5ce83.ae175","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1390,"y":160,"wires":[]},{"id":"30d4a402.d0012c","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":160,"wires":[["71f5ce83.ae175"]]},{"id":"fe233e7d.a51e","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'quick_page';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1080,"y":160,"wires":[["30d4a402.d0012c"]]},{"id":"881c792.ec4a688","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1390,"y":240,"wires":[]},{"id":"ee95f3c1.3f828","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1390,"y":200,"wires":[]},{"id":"a4a3a07e.f78fa","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":200,"wires":[["ee95f3c1.3f828"]]},{"id":"2d34ef10.10738","type":"inject","z":"ba76d305.cf8ad","name":"Reset Auto Increment (Clear Table First)","topic":"DELETE FROM sqlite_sequence WHERE name = 'quick_page';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":980,"y":200,"wires":[["a4a3a07e.f78fa"]]},{"id":"7b2e6691.d4da08","type":"template","z":"53e35596.381c0c","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PAGE,{{payload.0.pagerNumber}},{{payload.0.sysID}},{{{payload.0.content}}}\\f{{{payload.0.FP}}}","output":"str","x":900,"y":460,"wires":[["3cb58cbd.165284"]]},{"id":"3cb58cbd.165284","type":"serial out","z":"53e35596.381c0c","name":"","serial":"2db6df1c.cd63b","x":1050,"y":460,"wires":[]},{"id":"45d30e7b.f78f8","type":"serial in","z":"e3cbac21.52804","name":"","serial":"2db6df1c.cd63b","x":150,"y":80,"wires":[["184ea2f9.fe199d"]]},{"id":"184ea2f9.fe199d","type":"switch","z":"e3cbac21.52804","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"RECV,4,","vt":"str"},{"t":"eq","v":"/n","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":80,"wires":[["1c485e4b.a63e92"],[],[]]},{"id":"bfe6947b.66f8f8","type":"template","z":"53e35596.381c0c","name":"Add Msg to DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'group', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime', 'FP', 'payload') \nVALUES ('0', '{{payload.0.pagerNumber}}', '{{payload.0.sysID}}', '0', '{{payload.0.content}}', 'n/a', 'n/a', '{{payload.0.sender}}','{{timestamp}}', 'Quick Page', '{{timestamp}}', '{{{payload.0.FP}}}', 'n/a');","output":"str","x":1040,"y":520,"wires":[["3c1f3e87.640562"]]},{"id":"3c1f3e87.640562","type":"sqlite","z":"53e35596.381c0c","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":520,"wires":[["80365a9f.6e5ef8"]]},{"id":"b52928ed.f9b338","type":"change","z":"53e35596.381c0c","name":"Time","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":520,"wires":[["bfe6947b.66f8f8"]]},{"id":"80365a9f.6e5ef8","type":"link out","z":"53e35596.381c0c","name":"to Log","links":["13c2aaaa.74d295","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":1335,"y":520,"wires":[]},{"id":"1bf9a4b6.f54f3b","type":"comment","z":"1c96dbb1.1bc354","name":"Put All On the Webpage","info":"","x":140,"y":320,"wires":[]},{"id":"40df00fd.261f1","type":"http response","z":"1c96dbb1.1bc354","name":"","statusCode":"","headers":{},"x":750,"y":240,"wires":[]},{"id":"47e061c2.9cfec","type":"template","z":"1c96dbb1.1bc354","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM `log`\nORDER BY  `{{global.sort-by}}` {{global.direction}}","output":"str","x":330,"y":420,"wires":[["544d98ea.b79288"]]},{"id":"a7584546.9a1cb8","type":"websocket out","z":"1c96dbb1.1bc354","name":"","server":"32989c5a.d6ee14","client":"","x":1290,"y":420,"wires":[]},{"id":"8595684f.e6b5d8","type":"comment","z":"1c96dbb1.1bc354","name":"Build Webpage","info":"","x":100,"y":60,"wires":[]},{"id":"544d98ea.b79288","type":"sqlite","z":"1c96dbb1.1bc354","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":510,"y":420,"wires":[["958508cb.755b28"]]},{"id":"40e6251b.e6404c","type":"function","z":"1c96dbb1.1bc354","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n    var statusTime = new Date(msg.payload[i].statusTime);\n                var displayStatusDate = statusTime.toLocaleDateString();\n                var displayStatusTime = statusTime.toLocaleTimeString();\n                \n  \n              \n     if (msg.payload[i].exported === null) {\n    msg.payload[i].displayExportedTime = \"n/a\"\n    msg.payload[i].displayExportedDate = \"n/a\"\n} else {\nvar exportedTime = new Date(msg.payload[i].exported);\n    var displayExportedDate = exportedTime.toLocaleDateString();\n    var displayExportedTime = exportedTime.toLocaleTimeString();\n              \n    msg.payload[i].displayExportedTime = displayExportedTime\n    msg.payload[i].displayExportedDate = displayExportedDate\n}         \n               \n                \n                msg.payload[i].displayStatusTime = displayStatusTime\n                msg.payload[i].displayStatusDate = displayStatusDate\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":420,"wires":[["3530697b.f604f6"]]},{"id":"bcfd7457.19e388","type":"link in","z":"1c96dbb1.1bc354","name":"log","links":["363f5c70.e7e144","320906f1.fd1fba","ecbc4376.b117e","d2d8b8d2.67e9a8","8469e8af.2a6df8","2c38eaf2.df6f76","bc4b27b0.6d1478","5652483b.e30f08","e14222d1.c9cb7","f40e69c9.7d2798","18e72d9f.360682","80365a9f.6e5ef8","9b70e3c3.c129d","5ce459da.1e66f8","dde42ec0.d2e1f","50e59502.8aad2c","38eb5a75.961926"],"x":175,"y":440,"wires":[["47e061c2.9cfec"]]},{"id":"ee469ce7.3e75a","type":"websocket in","z":"1c96dbb1.1bc354","name":"","server":"8ad92631.0da208","client":"","x":120,"y":360,"wires":[["9e864380.21a48"]]},{"id":"6763c15d.e3fa5","type":"template","z":"1c96dbb1.1bc354","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    \n    <title>{{title}}</title>\n    \n    <script>\n        {{{script}}}\n    </script>\n    \n\n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n\n<body onLoad='startTime();'>\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n    \n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.left}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n</body>\n\n</html>","output":"str","x":630,"y":240,"wires":[["40df00fd.261f1"]]},{"id":"a74297ce.590ef8","type":"change","z":"1c96dbb1.1bc354","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Full Log","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":240,"wires":[["8e473da7.f3f4f"]]},{"id":"958508cb.755b28","type":"function","z":"1c96dbb1.1bc354","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":420,"wires":[["40e6251b.e6404c"]]},{"id":"3530697b.f604f6","type":"template","z":"1c96dbb1.1bc354","name":"Build Data (div Backup)","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<div class=\"nestedLog\">\n    <div class=\"bold sort-by\" onclick= send.send('index')>Index</div>\n    <div class=\"bold sort-by\" onclick= send.send('sender')>Callpoint</div>\n    <div class=\"bold sort-by\" onclick= send.send('content')>Message</div>\n    <div class=\"bold\">Receive Time</div>\n    <div class=\"bold sort-by\" onclick= send.send('rxTime')>Receive Date</div>\n    <div class=\"bold sort-by\" onclick= send.send('status')>Status</div>\n    <div class=\"bold\">Status Time</div>\n    <div class=\"bold sort-by\" onclick= send.send('statusTime')>Status Date</div>\n    <div class=\"bold\">Export Time</div>\n    <div class=\"bold sort-by\" onclick= send.send('exported')>Export Date</div>\n    <div class=\"bold sort-by\" onclick= send.send('pagerNumber')>Recipient</div>\n    <div class=\"bold sort-by\" onclick= send.send('sysID')>System ID</div>\n    <div class=\"bold sort-by\" onclick= send.send('group')>Group</div>\n    <div class=\"bold sort-by\" onclick= send.send('FP')>Flash Pattern</div>\n</div>\n{{#payload}}\n <div class=\"nestedLog {{style}}\">\n    <div>{{index}}</div>\n    <div>{{sender}}</div>\n    <div>{{{content}}}</div>\n    <div>{{displayTime}}</div>\n    <div>{{displayDate}}</div>\n    <div>{{status}}</div>\n    <div>{{displayStatusTime}}</div>\n    <div>{{displayStatusDate}}</div>\n    <div>{{{displayExportedTime}}}</div>\n    <div>{{{displayExportedDate}}}</div>\n    <div>{{pagerNumber}}</div>\n    <div>{{sysID}}</div>\n    <div>{{group}}</div>\n    <div>{{FP}}</div>\n  </div>\n{{/payload}}","output":"str","x":1070,"y":420,"wires":[["a7584546.9a1cb8"]]},{"id":"8e473da7.f3f4f","type":"template","z":"1c96dbb1.1bc354","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/log-full/receive');\nvar send = new WebSocket('ws://' + location.host + '/log-full/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":510,"y":240,"wires":[["6763c15d.e3fa5"]]},{"id":"9e864380.21a48","type":"switch","z":"1c96dbb1.1bc354","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Open","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":360,"wires":[["f0d611c3.bfa1d"],["47e061c2.9cfec"]]},{"id":"f0d611c3.bfa1d","type":"change","z":"1c96dbb1.1bc354","name":"","rules":[{"t":"set","p":"sort-by","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":360,"wires":[["1d5a046c.c6fa9c"]]},{"id":"1d5a046c.c6fa9c","type":"switch","z":"1c96dbb1.1bc354","name":"","property":"direction","propertyType":"global","rules":[{"t":"eq","v":"ASC","vt":"str"},{"t":"eq","v":"DESC","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":360,"wires":[["70b3cf79.3c274"],["aa735ccd.7575e"]]},{"id":"70b3cf79.3c274","type":"change","z":"1c96dbb1.1bc354","name":"","rules":[{"t":"set","p":"direction","pt":"global","to":"DESC","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":340,"wires":[["9b70e3c3.c129d"]]},{"id":"aa735ccd.7575e","type":"change","z":"1c96dbb1.1bc354","name":"","rules":[{"t":"set","p":"direction","pt":"global","to":"ASC","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":380,"wires":[["9b70e3c3.c129d"]]},{"id":"9b70e3c3.c129d","type":"link out","z":"1c96dbb1.1bc354","name":"","links":["bcfd7457.19e388"],"x":915,"y":360,"wires":[]},{"id":"38c97d52.720a32","type":"http in","z":"1c96dbb1.1bc354","name":"","url":"/log-full","method":"get","upload":false,"swaggerDoc":"","x":110,"y":260,"wires":[["ecde1301.2ebb3"]]},{"id":"577e3b25.879e44","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"sort-by","pt":"global","to":"index","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":240,"wires":[[]]},{"id":"b6c859b7.94b658","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"direction","pt":"global","to":"DESC","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":280,"wires":[[]]},{"id":"9da7d1fb.8f7cd","type":"http response","z":"b209c94d.26d798","name":"","statusCode":"","headers":{},"x":750,"y":260,"wires":[]},{"id":"b3d8b7b0.5cd1d8","type":"comment","z":"b209c94d.26d798","name":"Build Webpage","info":"","x":120,"y":40,"wires":[]},{"id":"5e3e72a4.9cd99c","type":"template","z":"b209c94d.26d798","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    \n    <title>{{title}}</title>\n    \n    <script>\n        {{{script}}}\n    </script>\n    \n\n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n\n<body onLoad='startTime();'>\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n    \n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.left}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n</body>\n\n</html>","output":"str","x":630,"y":260,"wires":[["9da7d1fb.8f7cd"]]},{"id":"14d14541.b18d6b","type":"template","z":"b209c94d.26d798","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/log-daily/receive');\nvar send = new WebSocket('ws://' + location.host + '/log-daily/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":510,"y":260,"wires":[["5e3e72a4.9cd99c"]]},{"id":"c6cb5bad.c0e8d8","type":"http in","z":"b209c94d.26d798","name":"","url":"/log-daily","method":"get","upload":false,"swaggerDoc":"","x":110,"y":280,"wires":[["5dda820c.bf5e2c"]]},{"id":"27fce5ac.018c5a","type":"change","z":"b209c94d.26d798","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Daily Log","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":260,"wires":[["14d14541.b18d6b"]]},{"id":"cd63b42b.c622b8","type":"switch","z":"e3cbac21.52804","name":"","property":"sysID","propertyType":"msg","rules":[{"t":"eq","v":"sysID","vt":"global"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":80,"wires":[["c94a9d48.9c2c","e8a93519.478388"],[]]},{"id":"9ff12e3d.bf8a4","type":"inject","z":"dad6f0f1.28177","name":"Set Welcome Message","topic":"","payload":"WPROG,Hello World!","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":520,"y":300,"wires":[["734abd62.6c0054"]]},{"id":"6166ccee.a7a074","type":"file in","z":"85d51a2d.db2228","name":"","filename":"/var/www/pager/received.txt","format":"utf8","chunk":false,"sendError":false,"x":280,"y":60,"wires":[["7135ce58.df4ed","db876576.365048"]]},{"id":"ba2546c7.c3a838","type":"inject","z":"dad6f0f1.28177","name":"Set Pager Number on Pager","topic":"","payload":"CCPROG,1,0800080","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":340,"wires":[["734abd62.6c0054"]]},{"id":"2e0a6b46.bba6d4","type":"inject","z":"dad6f0f1.28177","name":"Set All Page Number on Pager","topic":"","payload":"CCPROG,2,0807288","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":490,"y":380,"wires":[["734abd62.6c0054"]]},{"id":"45923828.f892f8","type":"inject","z":"dad6f0f1.28177","name":"Set System Code on Pager","topic":"","payload":"CCPROG,3,0800000","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":510,"y":420,"wires":[["734abd62.6c0054"]]},{"id":"b1874a1b.abe738","type":"switch","z":"b00e2d77.a9931","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":220,"wires":[["cf30e34b.c1eb2"],["349faf1f.208a4"]]},{"id":"afe55d0.be19fa","type":"DataIn","z":"60528a1b.f32364","collection":"e1c85b2c.abed18","name":"","update":false,"path":"/settings","x":1380,"y":760,"wires":[]},{"id":"aa834245.ef833","type":"inject","z":"60528a1b.f32364","name":"Settings","topic":"","payload":"[{\"Name\":\"Home\",\"Address\":\"/home\"},{\"Name\":\"Settings Menu\",\"Address\":\"/settings\"},{\"Name\":\"Log Out\",\"Address\":\"/login/clear\"}]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1240,"y":760,"wires":[["afe55d0.be19fa"]]},{"id":"fc768851.034bd8","type":"template","z":"60528a1b.f32364","name":"settings_list","field":"settings_list","fieldType":"global","format":"handlebars","syntax":"mustache","template":"    {{#payload}}\n        <a href=\"{{{Address}}}\" class=\"settings\">{{Name}}</a>\n        <BR>\n    {{/payload}}","output":"str","x":570,"y":980,"wires":[[]]},{"id":"8701841e.83ae28","type":"comment","z":"60528a1b.f32364","name":"Set settings list","info":"","x":900,"y":980,"wires":[]},{"id":"df83a534.775ff8","type":"DataOut","z":"60528a1b.f32364","collection":"e1c85b2c.abed18","name":"","path":"/settings","error":false,"x":420,"y":980,"wires":[["fc768851.034bd8"]]},{"id":"9b687973.c1c618","type":"comment","z":"60528a1b.f32364","name":"Set Modules","info":"","x":730,"y":980,"wires":[]},{"id":"c1a00628.59b6f8","type":"http in","z":"38ad3d43.e07282","name":"","url":"/login","method":"get","upload":false,"swaggerDoc":"","x":140,"y":100,"wires":[["6192a8be.4d72c8"]]},{"id":"550b5a0f.5072d4","type":"comment","z":"38ad3d43.e07282","name":"Build Webpage","info":"","x":160,"y":60,"wires":[]},{"id":"c89bb567.c3cb18","type":"http response","z":"38ad3d43.e07282","name":"","statusCode":"","headers":{},"x":770,"y":120,"wires":[]},{"id":"2c769665.50ee0a","type":"template","z":"38ad3d43.e07282","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n</body>\n\n</html>","output":"str","x":650,"y":120,"wires":[["c89bb567.c3cb18"]]},{"id":"25806f78.9cf92","type":"change","z":"38ad3d43.e07282","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Settings Login","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":120,"wires":[["32a07662.8f48aa"]]},{"id":"32a07662.8f48aa","type":"template","z":"38ad3d43.e07282","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/login/receive');\nvar send = new WebSocket('ws://' + location.host + '/login/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":530,"y":120,"wires":[["2c769665.50ee0a"]]},{"id":"d9b40d6b.4750d","type":"switch","z":"38ad3d43.e07282","name":"","property":"payload.password","propertyType":"msg","rules":[{"t":"eq","v":"Outtti5853","vt":"str"},{"t":"eq","v":"password","vt":"global"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":310,"y":240,"wires":[["af027ca6.8807c"],["78978698.738818"],["e7a85e8d.a40d2"]]},{"id":"feec4f17.d019f","type":"comment","z":"38ad3d43.e07282","name":"Handle Input from Webpage","info":"","x":200,"y":200,"wires":[]},{"id":"349faf1f.208a4","type":"link out","z":"b00e2d77.a9931","name":"back to settings","links":["4212ad6a.fb9f04"],"x":355,"y":240,"wires":[]},{"id":"4212ad6a.fb9f04","type":"link in","z":"38ad3d43.e07282","name":"","links":["1154197f.e1f607","349faf1f.208a4","6376dfd7.0157b","81380517.b42f28","b88a2c28.954e5","bdc216af.c3bff8","d6762c10.0cdbe","d544b9ec.e25b78"],"x":295,"y":140,"wires":[["25806f78.9cf92"]]},{"id":"67842090.6201b","type":"comment","z":"60528a1b.f32364","name":"Defaults","info":"* /sw,/hw,/fw - Used to set the versions shown on the settings pages\n* sysID - Used to set the system ID Filter\n* Modules - contains a JSON string used to set the Links to main pages and their displayed Names\n* Serial - Used to set the system serial number\n* Password - Used to set the default system password - 1234 at this time\n* Settings - contains a JSON string used to set the Links to settings pages and their displayed Names","x":1300,"y":360,"wires":[]},{"id":"ae630a94.2c51f8","type":"comment","z":"38ad3d43.e07282","name":"Put Data On the Webpage","info":"","x":190,"y":400,"wires":[]},{"id":"41f9608f.5bce4","type":"websocket out","z":"38ad3d43.e07282","name":"","server":"f92c2145.f46df","client":"","x":630,"y":440,"wires":[]},{"id":"3f8cd8ce.f9f008","type":"template","z":"38ad3d43.e07282","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<form action=\"/login/submit\">\n Please enter your Password:\n  <input type=\"password\" name=\"password\"><BR>\n  <input type=\"submit\" value=\"Send\">\n  </form>","output":"str","x":450,"y":440,"wires":[["41f9608f.5bce4"]]},{"id":"54cf62a0.f54f4c","type":"websocket in","z":"38ad3d43.e07282","name":"","server":"d7115ac0.1e2888","client":"","x":160,"y":440,"wires":[["973bf238.76f1a"]]},{"id":"973bf238.76f1a","type":"switch","z":"38ad3d43.e07282","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":440,"wires":[["3f8cd8ce.f9f008"]]},{"id":"e7a85e8d.a40d2","type":"change","z":"38ad3d43.e07282","name":"Redirect to /Login","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/login","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":280,"wires":[["c89bb567.c3cb18"]]},{"id":"78978698.738818","type":"function","z":"38ad3d43.e07282","name":"Make Admin","func":"msg.cookies = { admin: {\n        value: true,\n        maxAge: 300000\n    }};\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":240,"wires":[["e7a85e8d.a40d2"]]},{"id":"aa135bce.84f318","type":"function","z":"38ad3d43.e07282","name":"Remove Admin","func":"msg.cookies = { };\nmsg.cookies[\"admin\"] = false;\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":300,"wires":[["e7a85e8d.a40d2"]]},{"id":"d5467695.376cc8","type":"http in","z":"38ad3d43.e07282","name":"","url":"/login/submit","method":"get","upload":false,"swaggerDoc":"","x":160,"y":240,"wires":[["d9b40d6b.4750d"]]},{"id":"6192a8be.4d72c8","type":"switch","z":"38ad3d43.e07282","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":100,"wires":[["eb0b90cc.4383"],["25806f78.9cf92"]]},{"id":"eb0b90cc.4383","type":"link out","z":"38ad3d43.e07282","name":"back to menu","links":["53c094fc.bf043c"],"x":375,"y":60,"wires":[]},{"id":"aed19d60.1bcf1","type":"http in","z":"38ad3d43.e07282","name":"","url":"/login/clear","method":"get","upload":false,"swaggerDoc":"","x":160,"y":300,"wires":[["aa135bce.84f318"]]},{"id":"c070b318.2640f","type":"http in","z":"ce69645.1231098","name":"","url":"/settings","method":"get","upload":false,"swaggerDoc":"","x":110,"y":80,"wires":[["e8bbabec.1eb078"]]},{"id":"1ce62238.e590ce","type":"comment","z":"ce69645.1231098","name":"Build Webpage","info":"","x":120,"y":40,"wires":[]},{"id":"e4466f0c.3d898","type":"http response","z":"ce69645.1231098","name":"","statusCode":"","headers":{},"x":770,"y":60,"wires":[]},{"id":"8d29f36c.245ee","type":"template","z":"ce69645.1231098","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n       <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n        IP: {{global.ip}}<br>\n        Serial: {{global.serial}}<br>\n        Software Version: {{global.sw}}<br>\n        Hardware Version: {{global.hw}}<br>\n        Firmware Version: {{global.fw}}\n    </div>\n    \n</div>\n\n<div class=\"grid-container\" id=\"data\">\n    \n<a href=\"/system\" class=\"TableDisplay\">System Settings</a>\n<BR>\n\n<a href=\"/setQP\" class=\"TableDisplay\">Set Quick Page</a>\n<BR>\n<a href=\"/alias\" class=\"TableDisplay\">Set Aliases</a>\n<BR>   \n<a href=\"/setFP\" class=\"TableDisplay\">Flash Pattern Effects</a>\n <BR>\n<a href=\"/engineer\" class=\"TableDisplay\">Engineering</a>\n\n\n\n</div>\n\n</body>\n\n</html>","output":"str","x":650,"y":60,"wires":[["e4466f0c.3d898"]]},{"id":"9a894be0.c3ef68","type":"change","z":"ce69645.1231098","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Settings Menu","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":60,"wires":[["301ebffb.48325"]]},{"id":"301ebffb.48325","type":"template","z":"ce69645.1231098","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/settings/receive');\nvar send = new WebSocket('ws://' + location.host + '/settings/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":530,"y":60,"wires":[["8d29f36c.245ee"]]},{"id":"e8bbabec.1eb078","type":"switch","z":"ce69645.1231098","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":80,"wires":[["9a894be0.c3ef68"],["81380517.b42f28"]]},{"id":"81380517.b42f28","type":"link out","z":"ce69645.1231098","name":"back to settings","links":["4212ad6a.fb9f04"],"x":375,"y":100,"wires":[]},{"id":"53c094fc.bf043c","type":"link in","z":"ce69645.1231098","name":"","links":["eb0b90cc.4383"],"x":155,"y":120,"wires":[["e8bbabec.1eb078"]]},{"id":"af027ca6.8807c","type":"function","z":"38ad3d43.e07282","name":"Make Admin (No Timeout)","func":"msg.cookies = { admin: {\n        value: true\n    },god: {\n        value: true\n    }};\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":200,"wires":[["e7a85e8d.a40d2"]]},{"id":"12220908.b98747","type":"comment","z":"e3cbac21.52804","name":"Testing Inputs","info":"","x":150,"y":320,"wires":[]},{"id":"4996d159.b234a","type":"http in","z":"69336e92.97cdb","name":"","url":"/system","method":"get","upload":false,"swaggerDoc":"","x":110,"y":100,"wires":[["7c4201a8.b3066"]]},{"id":"187a93b1.32310c","type":"comment","z":"69336e92.97cdb","name":"Build Webpage","info":"","x":120,"y":60,"wires":[]},{"id":"199c7ecc.549871","type":"http response","z":"69336e92.97cdb","name":"","statusCode":"","headers":{},"x":750,"y":80,"wires":[]},{"id":"cacfd3ca.9f14e","type":"template","z":"69336e92.97cdb","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"beep()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n<form action=\"/system\" method=\"post\">\nOld Password:<input type=\"password\" name=\"Oldpassword\">    <br>\nNew Password:<input type=\"password\" name=\"Newpassword\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n\n<p class=\"notes\">Logs are sent to the email address shown below.<br>To update the email address, enter a new address below and press enter.</p>\n<input type=\"email\" class=\"name\" id=\"email\" onchange=\"send.send(email.value)\" placeholder=\"{{global.to}}\">\n\nSet WIFI (Caution Do NOT Adjust Whilst Using WIFI,Reboot to Take Affect)\n<BR>\n<form action=\"/system\" method=\"post\">\nSSID:<input type=\"text\" name=\"SSID\">    <br>\nPassword:<input type=\"text\" name=\"wifiPassword\"> \n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n\n<BR>\nReset Entire Database (This cannot be undone)\n<form action=\"/system\" method=\"post\">\n    <input type=\"submit\" name=\"resetLog\" value=\"Reset Log\">\n</form>\n<BR>\n    \nClear Exported Data (This cannot be undone)\n<form action=\"/system\" method=\"post\">\n    <input type=\"submit\" name=\"resetLogExported\" value=\"Clear Exported\">\n</form>\n<BR>  \n    \n<form action=\"/system\" method=\"post\">\n  Set System Time (date and time):\n  <input type=\"datetime-local\" name=\"dtime\" id=\"dtime\">\n  <script type=\"text/javascript\">\n  var d = new Date();\n  var elem = document.getElementById(\"dtime\"); \n  elem.value = d.toISOString().slice(0,16);\n</script>\n  <input type=\"submit\" value=\"Send\">\n</form>\n\n\n\n<form action=\"/system\" method=\"post\"  id=\"select\">\n  Beep Style:<select name=\"beep\" form=\"select\" id=\"select\">\n         <optgroup label=\"Select One\">\n         <option value=null>No Beep</option>\n         <option value=\"beep.ogg\">Beep</option>\n         <option value=\"beepbeep.ogg\">Beep Beep</option>\n</select>\n<script>\nfunction beep() {\n    document.getElementById(\"select\").value = \"{{global.beep}}\";\n}\n</script>\n<br>\n  <input type=\"submit\" value=\"Submit\">\n</form>\n\n<p class=\"notes bold\">WARNING: You will need to physically disconnect and then re-connect power to CaptureCall in order to power-up again.</p>\n<button class=\"name red\" onclick=\"send.send('Shutdown')\">Safely Shutdown CaptureCall</button>\n\n</div>\n\n</body>\n\n</html>","output":"str","x":630,"y":80,"wires":[["199c7ecc.549871"]]},{"id":"1e8420df.7c031f","type":"change","z":"69336e92.97cdb","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall System Settings","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":80,"wires":[["98ed7ab7.2cd148"]]},{"id":"98ed7ab7.2cd148","type":"template","z":"69336e92.97cdb","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/system/receive');\nvar send = new WebSocket('ws://' + location.host + '/system/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\nvar msg = 0; // Make Incoming WS \n\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n function load(){\n startTime();\n\n }\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n\n}","output":"str","x":510,"y":80,"wires":[["cacfd3ca.9f14e"]]},{"id":"362fd6bc.ba6c3a","type":"comment","z":"69336e92.97cdb","name":"Handle Input from Webpage","info":"","x":160,"y":160,"wires":[]},{"id":"7c4201a8.b3066","type":"switch","z":"69336e92.97cdb","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":100,"wires":[["1e8420df.7c031f"],["b88a2c28.954e5"]]},{"id":"b88a2c28.954e5","type":"link out","z":"69336e92.97cdb","name":"back to settings","links":["4212ad6a.fb9f04"],"x":355,"y":120,"wires":[]},{"id":"125ae207.80eb3e","type":"debug","z":"69336e92.97cdb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":370,"y":240,"wires":[]},{"id":"c7c45d8f.12889","type":"http in","z":"69336e92.97cdb","name":"","url":"/system","method":"post","upload":false,"swaggerDoc":"","x":110,"y":360,"wires":[["125ae207.80eb3e","c9f6a9fb.0edea8","f050cc3.7a73d3","c8a190e9.9de6f","5d7de49b.eeb99c","189c8a46.070806","7de72cac.c0aa54","b469ec62.d0cd9"]]},{"id":"99040fdf.f6567","type":"http response","z":"69336e92.97cdb","name":"","statusCode":"","headers":{},"x":490,"y":200,"wires":[]},{"id":"c9f6a9fb.0edea8","type":"change","z":"69336e92.97cdb","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/system","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":200,"wires":[["99040fdf.f6567"]]},{"id":"f050cc3.7a73d3","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.Oldpassword","propertyType":"msg","rules":[{"t":"eq","v":"password","vt":"global"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":280,"wires":[["fb03dcb8.2779c"]]},{"id":"fb03dcb8.2779c","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.Newpassword","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":280,"wires":[["d2cffd80.616a"]]},{"id":"c8a190e9.9de6f","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.resetLog","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":320,"wires":[["50f38ebe.b90e6"]]},{"id":"50f38ebe.b90e6","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"DELETE FROM 'log';","name":"CaptureCall","x":490,"y":320,"wires":[["8f47f31.57d841"]]},{"id":"8f47f31.57d841","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"DELETE FROM sqlite_sequence WHERE name = 'log';","name":"CaptureCall","x":650,"y":320,"wires":[[]]},{"id":"d34e5b49.7bf368","type":"exec","z":"69336e92.97cdb","command":"sudo ./node-red-static/bin/set_time.sh","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":750,"y":440,"wires":[[],[],[]]},{"id":"5d7de49b.eeb99c","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.dtime","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":440,"wires":[["78bc6495.20be4c"]]},{"id":"78bc6495.20be4c","type":"change","z":"69336e92.97cdb","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.dtime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":440,"wires":[["d34e5b49.7bf368"]]},{"id":"dd4326a.4c6d8d8","type":"comment","z":"60528a1b.f32364","name":"Initiate on Boot","info":"Sets Global Variables from JSON DB\n\n* Set IP Address- Gets the system IP address, adds it to global.ip and also sets /ip in the json DB\n* Set system ID  - Gets system ID from json DB and sets global.sysID - This is used to filter messages\n* Set Email Address - Gets last email from json DB and sets global.to\n* Add Power on Message to DB - Writes to DB when system Powers on\n* Set Serial Number - Gets Serial from json DB and sets global.serial\n* Set Software Version - Gets S/W Version from json DB and sets global.sw\n* Set Hardware Version - Gets H/W Version from json DB and sets global.hw\n* Set Firmware Version - Gets F/W Version from json DB and sets global.fw\n* Set Password - Gets system Password from json DB and sets global.password\n* Set Left Header Links - Gets json List of modules for main pages from json DB and sets global.left. Used to set contents list on main pages\n* Set Settings Links - Gets json List of settings pages for settings pages from json DB and sets global.setings_list. Used to set contents list on settings pages\n* Set sort by - Sets default sort coloum to \"index\" on boot\n* Set sort direction - Sets default sort direction to \"ASC\" on boot","x":160,"y":100,"wires":[]},{"id":"8c59e2f4.29158","type":"file","z":"69336e92.97cdb","name":"","filename":"/etc/wpa_supplicant/wpa_supplicant.conf","appendNewline":false,"createDir":true,"overwriteFile":"true","x":720,"y":540,"wires":[[]]},{"id":"9b1e3c99.05267","type":"template","z":"23c43518.b3ff0a","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/display/receive');\nvar send = new WebSocket('ws://' + location.host + '/display/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n  \n};\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n","output":"str","x":550,"y":180,"wires":[["9b9c90b8.58988"]]},{"id":"73f17ab3.8171b4","type":"websocket out","z":"e3cbac21.52804","name":"","server":"4f629706.3fbcb8","client":"","x":980,"y":40,"wires":[]},{"id":"189c8a46.070806","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.beep","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":500,"wires":[["d3b7c6b5.1adc78"]]},{"id":"d3b7c6b5.1adc78","type":"change","z":"69336e92.97cdb","name":"","rules":[{"t":"set","p":"beep","pt":"global","to":"payload.beep","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":500,"wires":[["d4b6378c.272a18"]]},{"id":"e8a93519.478388","type":"switch","z":"e3cbac21.52804","name":"","property":"beep","propertyType":"global","rules":[{"t":"neq","v":"null","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":830,"y":40,"wires":[["8cb1f66b.d0bd48","73f17ab3.8171b4"]]},{"id":"8cb1f66b.d0bd48","type":"debug","z":"e3cbac21.52804","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":970,"y":80,"wires":[]},{"id":"1fcc7681.3b52f9","type":"http in","z":"3c78672c.9cb1f8","name":"","url":"/engineer","method":"get","upload":false,"swaggerDoc":"","x":110,"y":100,"wires":[["ae6afdf1.ec95"]]},{"id":"cb5867c.68a8f98","type":"comment","z":"3c78672c.9cb1f8","name":"Build Webpage","info":"","x":120,"y":60,"wires":[]},{"id":"a2067d6d.88795","type":"http response","z":"3c78672c.9cb1f8","name":"","statusCode":"","headers":{},"x":850,"y":60,"wires":[]},{"id":"37cbd25.2782f2e","type":"template","z":"3c78672c.9cb1f8","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"load()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n    Override User Password\n<form action=\"/engineer\" method=\"post\">\nNew Password:<input type=\"password\" name=\"Newpassword\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n\n<form action=\"/engineer\" method=\"post\">\nSystem ID:<input type=\"number\" name=\"sysID\" value=\"{{{global.sysID}}}\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n\nSW,HW,FW Versions\n<BR>\n<form action=\"/engineer\" method=\"post\">\nS/W Version:<input type=\"text\" name=\"sw\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n<form action=\"/engineer\" method=\"post\">\nH/W Version:<input type=\"text\" name=\"hw\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n<form action=\"/engineer\" method=\"post\">\nF/W Version:<input type=\"text\" name=\"fw\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n\n\n<form action=\"/engineer\" method=\"post\">\nSerial Number:<input type=\"text\" name=\"serial\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n\nModules \n<BR>\n<form action=\"/engineer/modules\" method=\"post\" >\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Dynamic Display,display\">Dynamic Display<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to First Aid Display,firstaid\">First Aid<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Table Display,table\">Table Display<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Daily Log,log-daily\">Daily Log<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Full Log,log-full\">Full Log<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Quick Page,quickpage\">Quick Page<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Free Page,freepage\">Free Page<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Go to Split Screen,split-screen\">Split Screen<br>\n  <input type=\"checkbox\" name=\"modules\" value=\"Export,export\">Export<br>\n  <input type=\"submit\" value=\"Submit\">\n</form>\n\nHome Page \n<BR>\n<form action=\"/engineer/home\" method=\"post\" >\n  <input type=\"radio\" name=\"home\" value=\"Dynamic Display\">Dynamic Display<br>\n  <input type=\"radio\" name=\"home\" value=\"First Aid\">First Aid<br>\n  <input type=\"radio\" name=\"home\" value=\"Table Display\">Table Display<br>\n  <input type=\"radio\" name=\"home\" value=\"Daily Log\">Daily Log<br>\n  <input type=\"radio\" name=\"home\" value=\"Full Log\">Full Log<br>\n  <input type=\"radio\" name=\"home\" value=\"Quick Page\">Quick Page<br>\n  <input type=\"radio\" name=\"home\" value=\"Free Page\">Free Page<br>\n  <input type=\"radio\" name=\"home\" value=\"Split Screen\">Split Screen<br>\n  <input type=\"radio\" name=\"home\" value=\"Export\">Export<br>\n  <input type=\"submit\" value=\"Submit\">\n</form>\n\n</div>\n\n</body>\n\n</html>","output":"str","x":730,"y":60,"wires":[["a2067d6d.88795"]]},{"id":"fa3ed0c3.ed4f2","type":"change","z":"3c78672c.9cb1f8","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"Engineer Settings (You Shouldnt Be here!!)","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":60,"wires":[["5399ea08.e994d4"]]},{"id":"5399ea08.e994d4","type":"template","z":"3c78672c.9cb1f8","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/engineer/receive');\nvar send = new WebSocket('ws://' + location.host + '/engineer/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\nvar msg = 0; // Make Incoming WS \n\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n function load(){\n startTime();\n\n\n }\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n\n}\n","output":"str","x":610,"y":60,"wires":[["37cbd25.2782f2e"]]},{"id":"7cdf9f1.64cb96","type":"comment","z":"3c78672c.9cb1f8","name":"Handle Input from Webpage","info":"","x":160,"y":180,"wires":[]},{"id":"ae6afdf1.ec95","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":100,"wires":[["955921b8.9204b"],["6a4a330d.caa02c"]]},{"id":"6a4a330d.caa02c","type":"link out","z":"3c78672c.9cb1f8","name":"back to settings","links":["4212ad6a.fb9f04"],"x":475,"y":100,"wires":[]},{"id":"50515aa1.2eb434","type":"debug","z":"3c78672c.9cb1f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":350,"y":220,"wires":[]},{"id":"4542c4dd.010acc","type":"http in","z":"3c78672c.9cb1f8","name":"","url":"/engineer","method":"post","upload":false,"swaggerDoc":"","x":120,"y":380,"wires":[["50515aa1.2eb434","c015747.3acb388","43cb6fdc.1deb8","94144d51.57536","8c38994d.e15088","b63c9f87.5f014","5a8a591e.ae8e38","a7cda32c.2c3ea"]]},{"id":"b2ea038a.746bf","type":"http response","z":"3c78672c.9cb1f8","name":"","statusCode":"","headers":{},"x":490,"y":500,"wires":[]},{"id":"c015747.3acb388","type":"change","z":"3c78672c.9cb1f8","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/engineer","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":500,"wires":[["b2ea038a.746bf"]]},{"id":"43cb6fdc.1deb8","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"payload.Newpassword","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":300,"wires":[["8d460834.a08b98"]]},{"id":"8d460834.a08b98","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"password","pt":"global","to":"payload.Newpassword","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":300,"wires":[["4fb7501b.1e92b"]]},{"id":"955921b8.9204b","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"req.cookies.god","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":80,"wires":[["fa3ed0c3.ed4f2"],["6a4a330d.caa02c"]]},{"id":"94144d51.57536","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"payload.sw","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":340,"wires":[["2ecb85ed.adc67a"]]},{"id":"8c38994d.e15088","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"payload.hw","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":380,"wires":[["b054030c.77671"]]},{"id":"b63c9f87.5f014","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"payload.fw","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":420,"wires":[["12fa8d82.9467a2"]]},{"id":"5a8a591e.ae8e38","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"payload.serial","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":460,"wires":[["3b656b80.fb4db4"]]},{"id":"94ec7853.b41548","type":"http in","z":"3c78672c.9cb1f8","name":"","url":"/engineer/modules","method":"post","upload":false,"swaggerDoc":"","x":150,"y":620,"wires":[["c015747.3acb388","eb8a0340.f959c","149a9733.581029"]]},{"id":"7de72cac.c0aa54","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.SSID","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":540,"wires":[["e1a70dd2.314ae"]]},{"id":"e1a70dd2.314ae","type":"template","z":"69336e92.97cdb","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdevupdate_config=1ap_scan=1fast_reauth=1country=GBnetwork={\tssid=\"{{SSID}}\"\tpsk=\"{{wifiPassword}}\"}","output":"str","x":480,"y":540,"wires":[["8c59e2f4.29158"]]},{"id":"eb8a0340.f959c","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.modules","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":620,"wires":[["f73fccf0.915ef"]]},{"id":"f73fccf0.915ef","type":"split","z":"3c78672c.9cb1f8","name":"","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":530,"y":620,"wires":[["7dd493ab.1e829c"]]},{"id":"7dd493ab.1e829c","type":"split","z":"3c78672c.9cb1f8","name":"","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":650,"y":620,"wires":[["b7556597.feb648"]]},{"id":"b7556597.feb648","type":"join","z":"3c78672c.9cb1f8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":770,"y":620,"wires":[["4e8b463d.b7a8e8"]]},{"id":"4e8b463d.b7a8e8","type":"join","z":"3c78672c.9cb1f8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":890,"y":620,"wires":[["a914fc2c.03001","30a21c3d.2546d4"]]},{"id":"a914fc2c.03001","type":"template","z":"3c78672c.9cb1f8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"[{{#payload}}{\"Name\": \"{{0}}\",\"Address\": \"{{1}}\"},{{/payload}}{\"Name\": \"Go to Settings\",\"Address\": \"login\"}]","output":"str","x":1020,"y":620,"wires":[["b3351a4d.0d92c8","a1c2cf8c.f9e76","e8d7c8d7.9a90f8"]]},{"id":"6768ce45.ac79b","type":"template","z":"3c78672c.9cb1f8","name":"Left Header","field":"left","fieldType":"global","format":"handlebars","syntax":"mustache","template":"    {{#payload}}\n        <a href=\"/{{Address}}\" class=\"settings\">{{Name}}</a>\n        <BR>\n    {{/payload}}","output":"str","x":1310,"y":620,"wires":[[]]},{"id":"b3351a4d.0d92c8","type":"json","z":"3c78672c.9cb1f8","name":"","property":"payload","action":"","pretty":false,"x":1150,"y":620,"wires":[["6768ce45.ac79b","302cfd77.c37b22"]]},{"id":"302cfd77.c37b22","type":"debug","z":"3c78672c.9cb1f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1310,"y":580,"wires":[]},{"id":"e27d3777.8cf898","type":"switch","z":"b8bd1cc3.4827","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"req.url","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":280,"y":180,"wires":[["4d7773b3.0108ec"],["7eec4d28.128ec4"]]},{"id":"7eec4d28.128ec4","type":"link out","z":"b8bd1cc3.4827","name":"","links":["f13a1f16.82872"],"x":375,"y":200,"wires":[]},{"id":"6d3d48bb.e324b8","type":"debug","z":"b8bd1cc3.4827","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":270,"y":220,"wires":[]},{"id":"3f35a816.675e18","type":"debug","z":"b8bd1cc3.4827","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":670,"y":260,"wires":[]},{"id":"30a21c3d.2546d4","type":"split","z":"3c78672c.9cb1f8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1000,"y":660,"wires":[["17fbd4b7.b3e2db"]]},{"id":"17fbd4b7.b3e2db","type":"split","z":"3c78672c.9cb1f8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1130,"y":660,"wires":[["a821f15.e4ab71"]]},{"id":"a821f15.e4ab71","type":"join","z":"3c78672c.9cb1f8","name":"","mode":"custom","build":"string","property":"payload.1","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1250,"y":660,"wires":[["93b50442.d6ff88"]]},{"id":"93b50442.d6ff88","type":"join","z":"3c78672c.9cb1f8","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":" /","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1370,"y":660,"wires":[["6d78fc51.e4be64"]]},{"id":"6d78fc51.e4be64","type":"template","z":"3c78672c.9cb1f8","name":"","field":"modules","fieldType":"global","format":"handlebars","syntax":"mustache","template":"/{{{payload}}}","output":"str","x":1500,"y":660,"wires":[[]]},{"id":"1e6521b9.49276e","type":"switch","z":"d0e2bfbf.dfe3f","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"req.url","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":260,"y":240,"wires":[["b20ec190.c8d73"],["e9c91e07.38088"]]},{"id":"e9c91e07.38088","type":"link out","z":"d0e2bfbf.dfe3f","name":"","links":["f13a1f16.82872"],"x":355,"y":260,"wires":[]},{"id":"815b7467.abb828","type":"switch","z":"23c43518.b3ff0a","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"/display","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":300,"y":180,"wires":[["5e777687.bf0378"],["c6b24bdc.0d6158"]]},{"id":"c6b24bdc.0d6158","type":"link out","z":"23c43518.b3ff0a","name":"","links":["f13a1f16.82872"],"x":395,"y":220,"wires":[]},{"id":"5dda820c.bf5e2c","type":"switch","z":"b209c94d.26d798","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"req.url","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":260,"y":280,"wires":[["27fce5ac.018c5a"],["d2ce817e.0c903"]]},{"id":"d2ce817e.0c903","type":"link out","z":"b209c94d.26d798","name":"","links":["f13a1f16.82872"],"x":355,"y":300,"wires":[]},{"id":"ecde1301.2ebb3","type":"switch","z":"1c96dbb1.1bc354","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"req.url","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":260,"y":260,"wires":[["a74297ce.590ef8"],["70722b52.c7b7d4"]]},{"id":"70722b52.c7b7d4","type":"link out","z":"1c96dbb1.1bc354","name":"","links":["f13a1f16.82872"],"x":355,"y":280,"wires":[]},{"id":"7530d890.2f9e38","type":"switch","z":"53e35596.381c0c","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"req.url","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":300,"y":240,"wires":[["22601c7c.9bf294"],["ce2ef575.3ca4f8"]]},{"id":"ce2ef575.3ca4f8","type":"link out","z":"53e35596.381c0c","name":"","links":["f13a1f16.82872"],"x":395,"y":260,"wires":[]},{"id":"9a8592b4.48574","type":"http in","z":"da0e8c29.a0583","name":"","url":"/freepage","method":"get","upload":false,"swaggerDoc":"","x":150,"y":280,"wires":[["28ed18d2.41fe48"]]},{"id":"193f6c.ae4d9094","type":"comment","z":"da0e8c29.a0583","name":"Build Webpage","info":"","x":160,"y":60,"wires":[]},{"id":"96c00b4.7fb27f8","type":"http response","z":"da0e8c29.a0583","name":"","statusCode":"","headers":{},"x":810,"y":260,"wires":[]},{"id":"58f43d6a.217ba4","type":"template","z":"da0e8c29.a0583","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<head>\n\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    <title>{{title}}</title>\n    \n    <script src=\"moment.js\"></script>\n    <script>\n{{{script}}}\n    </script>\n    \n\n    <LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n\n<audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n\n    <div class=\"heading\">\n\n        <div class=\"left\">\n            {{{global.left}}}\n        </div>\n\n        <div class=\"middle\">\n            <h1 id=\"title\">{{title}}</h1>\n        </div>\n\n        <div class=\"right\">\n            <div class=\"clock\" id=\"time\"></div>\n        </div>\n\n    </div>\n\n    <div class=\"wrapper2\" id=\"data\">\n        \n<form action=\"/freepage\" method=\"post\">\nMessage:<input type=\"text\" name=\"msg\">    <br>\nPager Number:<input type=\"text\" name=\"pager\">    <br>\n<input type=\"submit\" value=\"Submit\"><br>\n</form>\n</div>\n\n</body>\n\n</html>","output":"str","x":690,"y":260,"wires":[["96c00b4.7fb27f8"]]},{"id":"a549a41f.be52a8","type":"change","z":"da0e8c29.a0583","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Free Page","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":260,"wires":[["2d6935b5.0e1e5a"]]},{"id":"2d6935b5.0e1e5a","type":"template","z":"da0e8c29.a0583","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n  \n\nvar msg = 0; // Make Incoming WS Global\n\n\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n","output":"str","x":570,"y":260,"wires":[["58f43d6a.217ba4"]]},{"id":"b5c989c8.493098","type":"template","z":"da0e8c29.a0583","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PAGE,{{payload.pager}},{{global.sysID}},{{{payload.msg}}}","output":"str","x":580,"y":440,"wires":[["8df845ff.456a78"]]},{"id":"8df845ff.456a78","type":"serial out","z":"da0e8c29.a0583","name":"","serial":"2db6df1c.cd63b","x":730,"y":440,"wires":[]},{"id":"32d66138.55bfde","type":"template","z":"da0e8c29.a0583","name":"Add Msg to DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'group', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime', 'FP', 'payload') \nVALUES ('0', '{{payload.pager}}', '{{global.sysID}}', '0', '{{payload.msg}}', 'n/a', 'n/a', '0','{{timestamp}}', 'Free Page', '{{timestamp}}', 'n/a', 'n/a');","output":"str","x":720,"y":480,"wires":[["1a95ace0.4a9ab3"]]},{"id":"1a95ace0.4a9ab3","type":"sqlite","z":"da0e8c29.a0583","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":910,"y":480,"wires":[["5ce459da.1e66f8"]]},{"id":"8b3e4b35.77b2b8","type":"change","z":"da0e8c29.a0583","name":"Time","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":480,"wires":[["32d66138.55bfde"]]},{"id":"5ce459da.1e66f8","type":"link out","z":"da0e8c29.a0583","name":"to Log","links":["13c2aaaa.74d295","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":1015,"y":480,"wires":[]},{"id":"28ed18d2.41fe48","type":"switch","z":"da0e8c29.a0583","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"req.url","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":320,"y":280,"wires":[["a549a41f.be52a8"],["1bdee69f.d69879"]]},{"id":"1bdee69f.d69879","type":"link out","z":"da0e8c29.a0583","name":"","links":["f13a1f16.82872"],"x":415,"y":300,"wires":[]},{"id":"4266164c.a16568","type":"http in","z":"da0e8c29.a0583","name":"","url":"/freepage","method":"post","upload":false,"swaggerDoc":"","x":160,"y":460,"wires":[["98e4013d.1c2f1","b3ff9920.1c52c8"]]},{"id":"98e4013d.1c2f1","type":"switch","z":"da0e8c29.a0583","name":"","property":"payload.msg","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":460,"wires":[["8dd98e0a.18474"]]},{"id":"8dd98e0a.18474","type":"switch","z":"da0e8c29.a0583","name":"","property":"payload.pager","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":460,"wires":[["b5c989c8.493098","8b3e4b35.77b2b8"]]},{"id":"85475c00.6943d8","type":"http response","z":"da0e8c29.a0583","name":"","statusCode":"","headers":{},"x":490,"y":400,"wires":[]},{"id":"b3ff9920.1c52c8","type":"change","z":"da0e8c29.a0583","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/freepage","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":400,"wires":[["85475c00.6943d8"]]},{"id":"8855b97e.ed5368","type":"http in","z":"d0562e73.de681","name":"","url":"/setFP","method":"get","upload":false,"swaggerDoc":"","x":110,"y":80,"wires":[["4f94a092.61ad8"]]},{"id":"715fcf0c.2295f","type":"comment","z":"d0562e73.de681","name":"Build Webpage","info":"","x":120,"y":40,"wires":[]},{"id":"23569d68.5a06c2","type":"http response","z":"d0562e73.de681","name":"","statusCode":"","headers":{},"x":730,"y":60,"wires":[]},{"id":"9f2607db.34b9e8","type":"template","z":"d0562e73.de681","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n       <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n</body>\n\n</html>","output":"str","x":610,"y":60,"wires":[["23569d68.5a06c2"]]},{"id":"2a483322.2e26cc","type":"change","z":"d0562e73.de681","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Flash Pattern Effects","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":60,"wires":[["20a5e394.a75b0c"]]},{"id":"14929ad3.d3b6d5","type":"comment","z":"d0562e73.de681","name":"Put Data On the Webpage","info":"","x":150,"y":140,"wires":[]},{"id":"4ee69f48.01c99","type":"websocket out","z":"d0562e73.de681","name":"","server":"4f808f22.bd9c5","client":"","x":770,"y":180,"wires":[]},{"id":"5ab39dc5.a847d4","type":"template","z":"d0562e73.de681","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\n<div class=\"wrapper\">\n<form action=\"/setFP\" method=\"post\" id=\"add\">\nDefault <br> \nBackground Color:<input type=\"color\" name=\"defaultBG\" value=\"{{payload.0.defaultBG}}\"> Font Color:<input type=\"color\" name=\"defaultFont\" value=\"{{payload.0.defaultFont}}\"> <input type=\"checkbox\" name=\"defaultFlash\" value=\"checked\" {{payload.0.defaultFlash}}>Flash<br>    \n    \nVibe 1 <br> \nBackground Color:<input type=\"color\" name=\"V1BG\" value=\"{{payload.0.V1BG}}\"> Font Color:<input type=\"color\" name=\"V1Font\" value=\"{{payload.0.V1Font}}\"> <input type=\"checkbox\" name=\"V1Flash\" value=\"checked\" {{payload.0.V1Flash}}>Flash<br>\nVibe 2 <br> \nBackground Color:<input type=\"color\" name=\"V2BG\" value=\"{{payload.0.V2BG}}\"> Font Color:<input type=\"color\" name=\"V2Font\" value=\"{{payload.0.V2Font}}\"> <input type=\"checkbox\" name=\"V2Flash\" value=\"checked\" {{payload.0.V2Flash}}>Flash<br>\nVibe 3 <br> \nBackground Color:<input type=\"color\" name=\"V3BG\" value=\"{{payload.0.V3BG}}\"> Font Color:<input type=\"color\" name=\"V3Font\" value=\"{{payload.0.V3Font}}\"> <input type=\"checkbox\" name=\"V3Flash\" value=\"checked\" {{payload.0.V3Flash}}>Flash<br>\n    \nBeep 1 <br> \nBackground Color:<input type=\"color\" name=\"B1BG\" value=\"{{payload.0.B1BG}}\"> Font Color:<input type=\"color\" name=\"B1Font\" value=\"{{payload.0.B1Font}}\"> <input type=\"checkbox\" name=\"B1Flash\" value=\"checked\" {{payload.0.B1Flash}}>Flash<br>\nBeep 2 <br> \nBackground Color:<input type=\"color\" name=\"B2BG\" value=\"{{payload.0.B2BG}}\"> Font Color:<input type=\"color\" name=\"B2Font\" value=\"{{payload.0.B2Font}}\"> <input type=\"checkbox\" name=\"B2Flash\" value=\"checked\" {{payload.0.B2Flash}}>Flash<br>\nBeep 3 <br> \nBackground Color:<input type=\"color\" name=\"B3BG\" value=\"{{payload.0.B3BG}}\"> Font Color:<input type=\"color\" name=\"B3Font\" value=\"{{payload.0.B3Font}}\"> <input type=\"checkbox\" name=\"B3Flash\" value=\"checked\" {{payload.0.B3Flash}}>Flash<br>\n\nVibe/Beep 1 <br> \nBackground Color:<input type=\"color\" name=\"VB1BG\" value=\"{{payload.0.VB1BG}}\"> Font Color:<input type=\"color\" name=\"VB1Font\" value=\"{{payload.0.VB1Font}}\"> <input type=\"checkbox\" name=\"VB1Flash\" value=\"checked\" {{payload.0.VB1Flash}}>Flash<br>\nVibe/Beep 2 <br> \nBackground Color:<input type=\"color\" name=\"VB2BG\" value=\"{{payload.0.VB2BG}}\"> Font Color:<input type=\"color\" name=\"VB2Font\" value=\"{{payload.0.VB2Font}}\"> <input type=\"checkbox\" name=\"VB2Flash\" value=\"checked\" {{payload.0.VB2Flash}}>Flash<br>\nVibe/Beep 3 <br> \nBackground Color:<input type=\"color\" name=\"VB3BG\" value=\"{{payload.0.VB3BG}}\"> Font Color:<input type=\"color\" name=\"VB3Font\" value=\"{{payload.0.VB3Font}}\"> <input type=\"checkbox\" name=\"VB3Flash\" value=\"checked\" {{payload.0.VB3Flash}}>Flash<br>\n\nLookdown <br>\nBackground Color:<input type=\"color\" name=\"B1b3BG\" value=\"{{payload.0.B1b3BG}}\"> Font Color:<input type=\"color\" name=\"B1b3Font\" value=\"{{payload.0.B1b3Font}}\"> <input type=\"checkbox\" name=\"B1b3Flash\" value=\"checked\" {{payload.0.B1b3Flash}}>Flash<br>\n\n\n\n<br>\n<input type=\"submit\" value=\"Submit\">\n</form>    ","output":"str","x":590,"y":180,"wires":[["4ee69f48.01c99"]]},{"id":"9d79df3.aaa812","type":"websocket in","z":"d0562e73.de681","name":"","server":"a0127eb8.b242b","client":"","x":120,"y":180,"wires":[["f19f0b88.1da698"]]},{"id":"f19f0b88.1da698","type":"switch","z":"d0562e73.de681","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":180,"wires":[["3b021a54.3400d6"]]},{"id":"20a5e394.a75b0c","type":"template","z":"d0562e73.de681","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/setFP/receive');\nvar send = new WebSocket('ws://' + location.host + '/setFP/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":490,"y":60,"wires":[["9f2607db.34b9e8"]]},{"id":"611efccd.97f434","type":"comment","z":"d0562e73.de681","name":"Handle Input from Webpage","info":"","x":160,"y":240,"wires":[]},{"id":"4f94a092.61ad8","type":"switch","z":"d0562e73.de681","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":80,"wires":[["2a483322.2e26cc"],["a3483953.4356f8"]]},{"id":"a3483953.4356f8","type":"link out","z":"d0562e73.de681","name":"back to settings","links":["4212ad6a.fb9f04"],"x":335,"y":100,"wires":[]},{"id":"80ccb8a9.a8b6b8","type":"http in","z":"d0562e73.de681","name":"","url":"/setFP","method":"post","upload":false,"swaggerDoc":"","x":110,"y":340,"wires":[["bcbf0cd6.00d0d","b72a4410.a678b8","91650265.06ee3","8edd4cbd.dc908"]]},{"id":"e753d0a.a94ac3","type":"http response","z":"d0562e73.de681","name":"","statusCode":"","headers":{},"x":410,"y":300,"wires":[]},{"id":"bcbf0cd6.00d0d","type":"change","z":"d0562e73.de681","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/setFP","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":300,"wires":[["e753d0a.a94ac3"]]},{"id":"7e96f9d2.8aca18","type":"file","z":"d0562e73.de681","name":"","filename":"./node-red-static/FP.css","appendNewline":false,"createDir":false,"overwriteFile":"true","x":470,"y":340,"wires":[[]]},{"id":"b72a4410.a678b8","type":"template","z":"d0562e73.de681","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"/* Flash Patterns */\n.default {\n  background-color: {{payload.defaultBG}};\n  color: {{payload.defaultFont}};\n  animation: {{payload.defaultFlash}} linear 1s infinite;\n  \n\n}\n\n.V1 {\n  background-color: {{payload.V1BG}};\n  color: {{payload.V1Font}};\n  animation: {{payload.V1Flash}} linear 1s infinite;\n}\n\n.V2 {\n  background-color: {{payload.V2BG}};\n  color: {{payload.V2Font}};\n  animation: {{payload.V2Flash}} linear 1s infinite;\n }\n\n.V3 {\n  background-color: {{payload.V3BG}};\n  color: {{payload.V3Font}};\n  animation: {{payload.V3Flash}} linear 1s infinite;\n}\n\n.B1 {\n  background-color: {{payload.B1BG}};\n  color: {{payload.B1Font}};\n  animation: {{payload.B1Flash}} linear 1s infinite;\n}\n\n.B2 {\n  background-color: {{payload.B2BG}};\n  color: {{payload.B2Font}};\n  animation: {{payload.B2Flash}} linear 1s infinite;\n}\n\n.B3 {\n  background-color: {{payload.B3BG}};\n  color: {{payload.B3Font}};\n  animation: {{payload.B3Flash}} linear 1s infinite;\n}\n\n.VB1 {\n  background-color: {{payload.VB1BG}};\n  color: {{payload.VB1Font}};\n  animation: {{payload.VB1Flash}} linear 1s infinite;\n}\n\n.VB2 {  background-color: {{payload.VB2BG}};\ncolor: {{payload.VB2Font}};\n  animation: {{payload.VB2Flash}} linear 1s infinite;\n }\n\n.VB3 {\n  background-color: {{payload.VB3BG}};\n  color: {{payload.VB3Font}};\n  animation: {{payload.VB3Flash}} linear 1s infinite;\n}\n\n.B1b3 {\n  background-color: {{payload.B1b3BG}};\n  color: {{payload.B1b3Font}};\n  animation: {{payload.B1b3Flash}} linear 1s infinite;\n}\n\n@keyframes checked {\n0% { opacity: 1; } \n\t50% { opacity: .1; } \n\t100% { opacity: 1; }\n}","output":"str","x":280,"y":340,"wires":[["7e96f9d2.8aca18"]]},{"id":"7e7fe23b.84c74c","type":"split","z":"60528a1b.f32364","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":890,"y":680,"wires":[["afbb1eb0.29539"]]},{"id":"afbb1eb0.29539","type":"split","z":"60528a1b.f32364","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1020,"y":680,"wires":[["ff45b5a4.aa7888"]]},{"id":"ff45b5a4.aa7888","type":"join","z":"60528a1b.f32364","name":"","mode":"custom","build":"string","property":"payload.1","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1140,"y":680,"wires":[["19139a6d.7e50d6"]]},{"id":"19139a6d.7e50d6","type":"join","z":"60528a1b.f32364","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":" /","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1260,"y":680,"wires":[["d70e1277.46b2"]]},{"id":"d70e1277.46b2","type":"template","z":"60528a1b.f32364","name":"","field":"modules","fieldType":"global","format":"handlebars","syntax":"mustache","template":"/{{{payload}}}","output":"str","x":1390,"y":680,"wires":[[]]},{"id":"91650265.06ee3","type":"debug","z":"d0562e73.de681","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":270,"y":420,"wires":[]},{"id":"72e42bd5.2616a4","type":"template","z":"60528a1b.f32364","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET ip = '{{ip}}', sysID = '{{sysID}}', email = '{{email}}', serial = '{{serial}}', beep = '{{beep}}', sw = '{{sw}}', hw = '{{hw}}', fw = '{{fw}}', password = '{{password}}', modules = '{{modules}}', settings = '{{settings}}', sortby = '{{sortby}}', direction = '{{direction}}'\nWHERE ID = 1;","output":"str","x":620,"y":1260,"wires":[["fb23c3fd.6aaee"]]},{"id":"fb23c3fd.6aaee","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":770,"y":1260,"wires":[["ed7000ef.81664"]]},{"id":"b16ad8ab.ea9388","type":"inject","z":"60528a1b.f32364","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":1260,"wires":[["72e42bd5.2616a4"]]},{"id":"ed7000ef.81664","type":"debug","z":"60528a1b.f32364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":1260,"wires":[]},{"id":"57680870.a4fee8","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":460,"wires":[]},{"id":"40e8a718.7db078","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":420,"wires":[["5c137e7c.eafe6"]]},{"id":"51df7832.56f338","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE \"settings\" ( `ID` INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE, `ip` TEXT, `sysID` INTEGER,  `home` TEXT, `email` TEXT, `serial` TEXT, `beep` TEXT, `sw` TEXT, `hw` TEXT, `fw` TEXT, `password` TEXT, `modules` TEXT, `settings` TEXT)","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":420,"wires":[["40e8a718.7db078"]]},{"id":"5c137e7c.eafe6","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":420,"wires":[]},{"id":"9613dd14.40516","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":580,"wires":[["4c6d8b9f.7c4cc4"]]},{"id":"87545ba1.2ba438","type":"inject","z":"ba76d305.cf8ad","name":"Clear Table","topic":"DELETE FROM 'settings';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":580,"wires":[["9613dd14.40516"]]},{"id":"abdc0875.b34ba8","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":460,"wires":[["57680870.a4fee8"]]},{"id":"475501bd.5f68b","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'settings';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":460,"wires":[["abdc0875.b34ba8"]]},{"id":"2d395ca8.d5cbf4","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":500,"wires":[]},{"id":"1f6d8d53.6e5823","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":500,"wires":[["2d395ca8.d5cbf4"]]},{"id":"1da18834.e7d818","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'settings';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":500,"wires":[["1f6d8d53.6e5823"]]},{"id":"4c6d8b9f.7c4cc4","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":580,"wires":[]},{"id":"4b450df0.e83c84","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":540,"wires":[]},{"id":"bad165b9.945888","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":540,"wires":[["4b450df0.e83c84"]]},{"id":"12e4d3cf.a38c7c","type":"inject","z":"ba76d305.cf8ad","name":"Reset Auto Increment (Clear Table First)","topic":"DELETE FROM sqlite_sequence WHERE name = 'settings';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":540,"wires":[["bad165b9.945888"]]},{"id":"a035d2e1.6932a","type":"comment","z":"ba76d305.cf8ad","name":"Settings","info":"","x":500,"y":380,"wires":[]},{"id":"4ac7d74f.7f2f58","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":620,"wires":[["80b030ab.c8c21"]]},{"id":"615f1b49.7d75d4","type":"inject","z":"ba76d305.cf8ad","name":"Build Blank","topic":"INSERT INTO `settings`(`ID`,`ip`,`sysID`,`home`,`email`,`serial`,`beep`,`sw`,`hw`,`fw`,`password`,`modules`,`settings`) VALUES (1,\"NULL\",0,\"Dynamic Display\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"1234\",'[{\"Name\": \"Go to Dynamic Display\",\"Address\": \"display\"},{\"Name\": \"Go to First Aid Display\",\"Address\": \"firstaid\"},{\"Name\": \"Go to Table Display\",\"Address\": \"table\"},{\"Name\": \"Go to Daily Log\",\"Address\": \"log-daily\"},{\"Name\": \"Go to Full Log\",\"Address\": \"log-full\"},{\"Name\": \"Go to Quick Page\",\"Address\": \"quickpage\"},{\"Name\": \"Go to Free Page\",\"Address\": \"freepage\"},{\"Name\": \"Go to Split Screen\",\"Address\": \"split-screen\"},{\"Name\": \"Go to Settings\",\"Address\": \"login\"}]','[ { \"Name\": \"Home\", \"Address\": \"\" }, {\"Name\": \"Settings Menu\",\"Address\": \"settings\"},{\"Name\": \"Log Out\",\"Address\": \"login/clear\"} ]');","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":620,"wires":[["4ac7d74f.7f2f58"]]},{"id":"80b030ab.c8c21","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":620,"wires":[]},{"id":"48fb704c.ee3ce","type":"debug","z":"60528a1b.f32364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":830,"y":1080,"wires":[]},{"id":"7803d392.d1921c","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":670,"y":1080,"wires":[["48fb704c.ee3ce"]]},{"id":"cedf4942.1bd208","type":"inject","z":"60528a1b.f32364","name":"Select All","topic":"Select * FROM 'settings';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":520,"y":1080,"wires":[["7803d392.d1921c"]]},{"id":"7ece05b1.f644dc","type":"template","z":"60528a1b.f32364","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET ip = '{{payload[0].address}}'\nWHERE ID = 1;","output":"str","x":560,"y":160,"wires":[["13ca5266.4f02ce"]]},{"id":"13ca5266.4f02ce","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":710,"y":160,"wires":[[]]},{"id":"a94eeb3d.5f0798","type":"comment","z":"60528a1b.f32364","name":"Reset Default sort to Index","info":"","x":670,"y":240,"wires":[]},{"id":"24af3739.9123f8","type":"comment","z":"60528a1b.f32364","name":"Reset Default sort Direction to Descending","info":"","x":720,"y":280,"wires":[]},{"id":"d7a0c439.7d7da8","type":"inject","z":"60528a1b.f32364","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":1140,"wires":[[]]},{"id":"cd02f13e.c5758","type":"debug","z":"60528a1b.f32364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":850,"y":1140,"wires":[]},{"id":"d57eea24.248848","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `serial` FROM `settings`;","name":"CaptureCall","x":430,"y":360,"wires":[["29aa4748.4a38f8"]]},{"id":"6504a56c.dec16c","type":"comment","z":"60528a1b.f32364","name":"Set Global IP Address","info":"","x":900,"y":120,"wires":[]},{"id":"29000af8.4b1dd6","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"sysID","pt":"global","to":"payload[0].sysID","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":320,"wires":[[]]},{"id":"f8c63b29.6d2638","type":"comment","z":"60528a1b.f32364","name":"Set sysID","info":"","x":760,"y":320,"wires":[]},{"id":"75e740cb.10229","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `sysID` FROM `settings`;","name":"CaptureCall","x":430,"y":320,"wires":[["29000af8.4b1dd6"]]},{"id":"6d072298.ce0c6c","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"serial","pt":"global","to":"payload[0].serial","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":400,"wires":[[]]},{"id":"3dcdfe5b.03ee22","type":"comment","z":"60528a1b.f32364","name":"Set Serial","info":"","x":760,"y":400,"wires":[]},{"id":"1ecf1066.91d79","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `email` FROM `settings`;","name":"CaptureCall","x":430,"y":400,"wires":[["6d072298.ce0c6c"]]},{"id":"b226a04c.535eb","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"beep","pt":"global","to":"payload[0].beep","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":440,"wires":[[]]},{"id":"71a41ac8.736de4","type":"comment","z":"60528a1b.f32364","name":"Set beep","info":"","x":760,"y":440,"wires":[]},{"id":"64152e36.bad9a","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `beep` FROM `settings`;","name":"CaptureCall","x":430,"y":440,"wires":[["b226a04c.535eb"]]},{"id":"956c0a4b.435d18","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"sw","pt":"global","to":"payload[0].sw","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":480,"wires":[[]]},{"id":"702ec949.a6b798","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `sw` FROM `settings`;","name":"CaptureCall","x":430,"y":480,"wires":[["956c0a4b.435d18"]]},{"id":"36f03d71.440912","type":"comment","z":"60528a1b.f32364","name":"Set H/W Version","info":"","x":780,"y":520,"wires":[]},{"id":"afb53090.a53f7","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"hw","pt":"global","to":"payload[0].hw","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":520,"wires":[[]]},{"id":"b97ab582.64ca48","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `hw` FROM `settings`;","name":"CaptureCall","x":430,"y":520,"wires":[["afb53090.a53f7"]]},{"id":"6aed35a2.f6254c","type":"comment","z":"60528a1b.f32364","name":"Set F/W Version","info":"","x":780,"y":560,"wires":[]},{"id":"d36a9d78.9203","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"fw","pt":"global","to":"payload[0].fw","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":560,"wires":[[]]},{"id":"e9329103.798d6","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `fw` FROM `settings`;","name":"CaptureCall","x":430,"y":560,"wires":[["d36a9d78.9203"]]},{"id":"67a9b493.e3fe5c","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"password","pt":"global","to":"payload[0].password","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":600,"wires":[[]]},{"id":"33e54f6c.30f9e","type":"comment","z":"60528a1b.f32364","name":"Set password","info":"","x":810,"y":600,"wires":[]},{"id":"2787e72e.d4af98","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `password` FROM `settings`;","name":"CaptureCall","x":430,"y":600,"wires":[["67a9b493.e3fe5c"]]},{"id":"4fb7501b.1e92b","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET password = '{{payload.password}}'\nWHERE ID = 1;","output":"str","x":680,"y":300,"wires":[["616085bf.e2beec"]]},{"id":"616085bf.e2beec","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":830,"y":300,"wires":[[]]},{"id":"a1c2cf8c.f9e76","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET modules = '{{{payload}}}'\nWHERE ID = 1;","output":"str","x":1300,"y":540,"wires":[["4dd2cde6.07a074","55534cbe.57ef14"]]},{"id":"4dd2cde6.07a074","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1450,"y":540,"wires":[[]]},{"id":"75c7b90a.961778","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET sw = '{{payload.sw}}'\nWHERE ID = 1;","output":"str","x":640,"y":340,"wires":[["bd146bf.801c898"]]},{"id":"bd146bf.801c898","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":790,"y":340,"wires":[[]]},{"id":"20e10feb.cf737","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET hw = '{{payload.hw}}'\nWHERE ID = 1;","output":"str","x":640,"y":380,"wires":[["e80c7be9.9ace28"]]},{"id":"e80c7be9.9ace28","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":790,"y":380,"wires":[[]]},{"id":"8416e01a.3a8d6","type":"comment","z":"3c78672c.9cb1f8","name":"Password","info":"","x":980,"y":300,"wires":[]},{"id":"8e87cea6.9a0d9","type":"comment","z":"3c78672c.9cb1f8","name":"sw","info":"","x":930,"y":340,"wires":[]},{"id":"6bdc1aab.84a294","type":"comment","z":"3c78672c.9cb1f8","name":"hw","info":"","x":930,"y":380,"wires":[]},{"id":"e422f09f.92a03","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET fw = '{{payload.fw}}'\nWHERE ID = 1;","output":"str","x":640,"y":420,"wires":[["9cc31680.08ceb8"]]},{"id":"9cc31680.08ceb8","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":790,"y":420,"wires":[[]]},{"id":"efbe982a.feae18","type":"comment","z":"3c78672c.9cb1f8","name":"fw","info":"","x":930,"y":420,"wires":[]},{"id":"2006e9b0.a7d446","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET serial = '{{payload.serial}}'\nWHERE ID = 1;","output":"str","x":660,"y":460,"wires":[["a64a089f.8939a8"]]},{"id":"a64a089f.8939a8","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":810,"y":460,"wires":[[]]},{"id":"238ca74a.e623a8","type":"comment","z":"3c78672c.9cb1f8","name":"serial","info":"","x":950,"y":460,"wires":[]},{"id":"a7cda32c.2c3ea","type":"switch","z":"3c78672c.9cb1f8","name":"","property":"payload.sysID","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":260,"wires":[["24bf5ab5.e2a7d6"]]},{"id":"24bf5ab5.e2a7d6","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"sysID","pt":"global","to":"payload.sysID","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":260,"wires":[["37d3eeb3.bec942"]]},{"id":"37d3eeb3.bec942","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET sysID = '{{payload.sysID}}'\nWHERE ID = 1;","output":"str","x":660,"y":260,"wires":[["2848e3d3.d0019c"]]},{"id":"2848e3d3.d0019c","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":810,"y":260,"wires":[[]]},{"id":"c194319b.6aaa5","type":"comment","z":"3c78672c.9cb1f8","name":"sysID","info":"","x":950,"y":260,"wires":[]},{"id":"2ecb85ed.adc67a","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"sw","pt":"global","to":"payload.sw","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":340,"wires":[["75c7b90a.961778"]]},{"id":"b054030c.77671","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"hw","pt":"global","to":"payload.hw","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":380,"wires":[["20e10feb.cf737"]]},{"id":"12fa8d82.9467a2","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"fw","pt":"global","to":"payload.fw","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":420,"wires":[["e422f09f.92a03"]]},{"id":"3b656b80.fb4db4","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"serial","pt":"global","to":"payload.serial","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":460,"wires":[["2006e9b0.a7d446"]]},{"id":"d2cffd80.616a","type":"change","z":"69336e92.97cdb","name":"","rules":[{"t":"set","p":"password","pt":"global","to":"payload.Newpassword","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":280,"wires":[["10577483.1658ab"]]},{"id":"10577483.1658ab","type":"template","z":"69336e92.97cdb","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET password = '{{payload.password}}'\nWHERE ID = 1;","output":"str","x":810,"y":280,"wires":[["f7b2c8cf.8744f8"]]},{"id":"f7b2c8cf.8744f8","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":960,"y":280,"wires":[[]]},{"id":"b50de3ac.d427d","type":"comment","z":"69336e92.97cdb","name":"Password","info":"","x":1110,"y":280,"wires":[]},{"id":"d4b6378c.272a18","type":"template","z":"69336e92.97cdb","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET beep = '{{payload.beep}}'\nWHERE ID = 1;","output":"str","x":660,"y":500,"wires":[["a472fd8f.cc606"]]},{"id":"a472fd8f.cc606","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":810,"y":500,"wires":[[]]},{"id":"cd7b9816.b1a838","type":"comment","z":"69336e92.97cdb","name":"Beep","info":"","x":950,"y":500,"wires":[]},{"id":"8edd4cbd.dc908","type":"template","z":"d0562e73.de681","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `colors`\nSET \n`defaultBG`  =  '{{payload.defaultBG}}',\n`defaultFont` = '{{payload.defaultFont}}',\n`defaultFlash` = '{{payload.defaultFlash}}',\n`V1BG` = '{{payload.V1BG}}',\n`V1Font` = '{{payload.V1Font}}',\n`V1Flash` = '{{payload.V1Flash}}',\n`V2BG` = '{{payload.V2BG}}',\n`V2Font` = '{{payload.V2Font}}',\n`V2Flash` = '{{payload.V2Flash}}',\n`V3BG` = '{{payload.V3BG}}',\n`V3Font` = '{{payload.V3Font}}',\n`V3Flash` = '{{payload.V3Flash}}',\n`B1BG` = '{{payload.B1BG}}',\n`B1Font` = '{{payload.B1Font}}',\n`B1Flash` = '{{payload.B1Flash}}',\n`B2BG` = '{{payload.B2BG}}',\n`B2Font` = '{{payload.B2Font}}',\n`B2Flash` = '{{payload.B2Flash}}',\n`B3BG` = '{{payload.B3BG}}',\n`B3Font` = '{{payload.B3Font}}',\n`B3Flash` = '{{payload.B3Flash}}',\n`VB1BG` = '{{payload.VB1BG}}',\n`VB1Font` = '{{payload.VB1Font}}',\n`VB1Flash` = '{{payload.VB1Flash}}',\n`VB2BG` = '{{payload.defaultBG}}',\n`VB2Font` = '{{payload.VB2Font}}',\n`VB2Flash` = '{{payload.VB2Flash}}',\n`VB3BG` = '{{payload.VB3BG}}',\n`VB3Font` = '{{payload.VB3Font}}',\n`VB3Flash` = '{{payload.VB3Flash}}',\n`B1b3BG` = '{{payload.B1b3BG}}',\n`B1b3Font` = '{{payload.B1b3Font}}',\n`B1b3Flash` = '{{payload.B1b3Flash}}'\nWHERE ID  =  1;","output":"str","x":280,"y":380,"wires":[["f7d5473c.3e6488"]]},{"id":"f7d5473c.3e6488","type":"sqlite","z":"d0562e73.de681","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":430,"y":380,"wires":[[]]},{"id":"5e336be9.76b194","type":"comment","z":"d0562e73.de681","name":"FP Colors","info":"","x":580,"y":380,"wires":[]},{"id":"3b021a54.3400d6","type":"sqlite","z":"d0562e73.de681","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT * FROM `colors`;","name":"CaptureCall","x":410,"y":180,"wires":[["d31a057.54931f8","5ab39dc5.a847d4"]]},{"id":"d31a057.54931f8","type":"debug","z":"d0562e73.de681","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload[0]","x":610,"y":260,"wires":[]},{"id":"b359f9e7.8eb888","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1410,"y":460,"wires":[]},{"id":"85a50328.58f91","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1250,"y":420,"wires":[["c97062da.9cd87"]]},{"id":"e6dff7e2.499de8","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE `colors` ( \t`ID`\tINTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE, \t`defaultBG`\tINTEGER, \t`defaultFont`\tINTEGER, \t`defaultFlash`\tTEXT, \t`V1BG`\tINTEGER, \t`V1Font`\tINTEGER, \t`V1Flash`\tTEXT, `V2BG`\tINTEGER, \t`V2Font`\tINTEGER, \t`V2Flash`\tTEXT, `V3BG`\tINTEGER, \t`V3Font`\tINTEGER, \t`V3Flash`\tTEXT, `B1BG`\tINTEGER, \t`B1Font`\tINTEGER, \t`B1Flash`\tTEXT, `B2BG`\tINTEGER, \t`B2Font`\tINTEGER, \t`B2Flash`\tTEXT, `B3BG`\tINTEGER, \t`B3Font`\tINTEGER, \t`B3Flash`\tTEXT, `VB1BG`\tINTEGER, \t`VB1Font`\tINTEGER, \t`VB1Flash`\tTEXT, `VB2BG`\tINTEGER, \t`VB2Font`\tINTEGER, \t`VB2Flash`\tTEXT, `VB3BG`\tINTEGER, \t`VB3Font`\tINTEGER, \t`VB3Flash`\tTEXT, `B1b3BG`\tINTEGER, \t`B1b3Font`\tINTEGER, \t`B1b3Flash`\tTEXT );","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1090,"y":420,"wires":[["85a50328.58f91"]]},{"id":"c97062da.9cd87","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1410,"y":420,"wires":[]},{"id":"12729fac.b0518","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1250,"y":580,"wires":[["228a7978.3f8ee6"]]},{"id":"26e09611.ca020a","type":"inject","z":"ba76d305.cf8ad","name":"Clear Table","topic":"DELETE FROM 'colors';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1090,"y":580,"wires":[["12729fac.b0518"]]},{"id":"808fb896.6bc138","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1250,"y":460,"wires":[["b359f9e7.8eb888"]]},{"id":"27f3b071.e469e","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'colors';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1100,"y":460,"wires":[["808fb896.6bc138"]]},{"id":"c778da44.5ea878","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1410,"y":500,"wires":[]},{"id":"539dc36d.fa222c","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1250,"y":500,"wires":[["c778da44.5ea878"]]},{"id":"f3584fe.28529b","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'colors';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1100,"y":500,"wires":[["539dc36d.fa222c"]]},{"id":"228a7978.3f8ee6","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1410,"y":580,"wires":[]},{"id":"54044754.6691d8","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1410,"y":540,"wires":[]},{"id":"d36d4b0d.d951c8","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1250,"y":540,"wires":[["54044754.6691d8"]]},{"id":"27b9a10f.09813e","type":"inject","z":"ba76d305.cf8ad","name":"Reset Auto Increment (Clear Table First)","topic":"DELETE FROM sqlite_sequence WHERE name = 'colors';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1000,"y":540,"wires":[["d36d4b0d.d951c8"]]},{"id":"486767ea.69d218","type":"comment","z":"ba76d305.cf8ad","name":"Colors","info":"","x":1250,"y":380,"wires":[]},{"id":"33e449ab.039e96","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1250,"y":620,"wires":[["ee2c5cca.e43b2"]]},{"id":"ce78853a.c47cf8","type":"inject","z":"ba76d305.cf8ad","name":"Build Blank","topic":"INSERT INTO `colors`(`ID`,`defaultBG`, `defaultFont`, `defaultFlash`  ,`V1BG`, `V1Font`, `V1Flash`  ,`V2BG`, `V2Font`, `V2Flash`  ,`V3BG`, `V3Font`, `V3Flash`  ,`B1BG`, `B1Font`, `B1Flash`  ,`B2BG`, `B2Font`, `B2Flash`  ,`B3BG`, `B3Font`, `B3Flash`  ,`VB1BG`, `VB1Font`, `VB1Flash`  ,`VB2BG`, `VB2Font`, `VB2Flash`  ,`VB3BG`, `VB3Font`, `VB3Flash`  ,`B1b3BG`, `B1b3Font`, `B1b3Flash`) VALUES (1,\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\",\"NULL\");","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1100,"y":620,"wires":[["33e449ab.039e96"]]},{"id":"ee2c5cca.e43b2","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1410,"y":620,"wires":[]},{"id":"d965519c.d547e","type":"function","z":"934a5982.d432b8","name":"Split from Receiver","func":"var result = msg.payload.match(/RECV,4,(\\d+),(.+)/);\n\nmsg.capcode = result[1];\nmsg.content0 = result[2];\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":320,"wires":[["f3b21ea1.e93ea","ba4712be.c42b"]]},{"id":"a1f5bab6.fa5fc8","type":"serial in","z":"934a5982.d432b8","name":"","serial":"5d6eb2f4.fc698c","x":90,"y":340,"wires":[["d965519c.d547e","77fe45e.0495ebc"]]},{"id":"5544a289.742b0c","type":"template","z":"934a5982.d432b8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Capcode: {{capcode}}\nContent: {{content0}}\n\nPager Number: {{PagerNumber}}\nSystem ID: {{SystemID}}\n\nGroup: {{group}}\nContent: {{content}}\n\nPart 1: {{msgPart1}}\nPart 2: {{msgPart2}}\n\nSender: {{sender}}\nHandled?: {{handled}}\n\nFlash Pattern: {{FP}}\n\nExample: {{msgPart1}} {{msgPart2}} {{sender}}","output":"str","x":1060,"y":320,"wires":[["2aebe2f0.de1f1e"]]},{"id":"2aebe2f0.de1f1e","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":320,"wires":[]},{"id":"f3b21ea1.e93ea","type":"function","z":"934a5982.d432b8","name":"Convert Capcode to LRS","func":"var capcode = msg.capcode\nvar cc = capcode.toString();\nvar pagerStr = cc.substring(cc.length - 5, cc.Length);\nvar pagercalc = parseInt(pagerStr);\nvar pagerNumber = pagercalc/8;\nvar sysID = ((capcode - pagercalc)-700000)/100000;\n\nmsg.PagerNumber = pagerNumber\nmsg.SystemID = sysID\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":320,"wires":[["1187f492.534cfb","4129de75.9234"]]},{"id":"1187f492.534cfb","type":"function","z":"934a5982.d432b8","name":"Process Message","func":"var result = msg.content0.match(/\\[?(\\d+)?\\]?(?<=\\]|^)(.*?)(?=\\.|$)\\.?\\s?(\\d+)?:?(Handled\\s\\d)?%?0?C?(.+)?/);\n\nmsg.group = result[1];\nmsg.content = result[2];\nmsg.sender = result[3];\nmsg.handled = result[4];\nmsg.FP = result[5];\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":730,"y":320,"wires":[["53eb8c88.5889e4","941ee730.9e9ca8"]]},{"id":"53eb8c88.5889e4","type":"function","z":"934a5982.d432b8","name":"Split Content","func":"var result = msg.content0.match(/((?<=^)(.*?)(?=-|$))?((?<=-)(.*?)(?=$))?/);\n\nmsg.msgPart1 = result[1];\nmsg.msgPart2 = result[2];\n\nreturn msg;\n","outputs":1,"noerr":0,"x":910,"y":320,"wires":[["5544a289.742b0c","1de6656d.926b9b"]]},{"id":"77fe45e.0495ebc","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":270,"y":360,"wires":[]},{"id":"ba4712be.c42b","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":450,"y":280,"wires":[]},{"id":"4129de75.9234","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":690,"y":360,"wires":[]},{"id":"941ee730.9e9ca8","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":890,"y":280,"wires":[]},{"id":"1de6656d.926b9b","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1050,"y":360,"wires":[]},{"id":"986a7a65.862eb8","type":"inject","z":"934a5982.d432b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":520,"wires":[["aa24009a.1e9c6"]]},{"id":"aa24009a.1e9c6","type":"sqlite","z":"934a5982.d432b8","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT * FROM `log`\nWHERE  `status` = 'Active'\nORDER BY  `rxTime` DESC ;","name":"","x":380,"y":520,"wires":[["8ca2a6f9.05f6b8","690353cc.a2654c"]]},{"id":"8ca2a6f9.05f6b8","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":520,"wires":[]},{"id":"690353cc.a2654c","type":"function","z":"934a5982.d432b8","name":"","func":"\nfunction getCount(check) {\n    var count = 0;\n    for (var i = 0; i < msg.payload.length; i++) {\n        if (msg.payload[i].payload == check) {\n            count++;\n          \n        }\n    }\n    return count;\n}\n\nmsg.payload = getCount(\"RECV,4,0707288,Emergency-Area. 2\");   // should return 3\n  node.log(\"Something happened\");\n  node.warn(\"Something happened you should know about\");\n  node.debug(\"?\")\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":560,"wires":[["3879e473.3d7efc"]]},{"id":"3879e473.3d7efc","type":"debug","z":"934a5982.d432b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":560,"wires":[]},{"id":"53ef0d3c.2f1ab4","type":"comment","z":"9939c833.99b318","name":"Put Unprocessed On the Webpage","info":"","x":180,"y":300,"wires":[]},{"id":"43e3479.f2432b8","type":"http in","z":"9939c833.99b318","name":"","url":"/split-screen","method":"get","upload":false,"swaggerDoc":"","x":120,"y":240,"wires":[["2c5430ff.3123f"]]},{"id":"64ebaca6.468d04","type":"template","z":"9939c833.99b318","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT *\nFROM `log`\nWHERE date(datetime(rxtime / 1000 , 'unixepoch')) = date('now') AND `status` = 'Split Screen'\nORDER BY  `rxTime` DESC;","output":"str","x":350,"y":340,"wires":[["1ca1dc8e.ddbd13"]]},{"id":"f862321.2f6e7d","type":"websocket out","z":"9939c833.99b318","name":"","server":"a08ab62d.cf01f8","client":"","x":1940,"y":340,"wires":[]},{"id":"eea0957b.ea1d38","type":"comment","z":"9939c833.99b318","name":"Build Webpage","info":"","x":120,"y":20,"wires":[]},{"id":"1ca1dc8e.ddbd13","type":"sqlite","z":"9939c833.99b318","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":530,"y":340,"wires":[["bcbbf453.9c3be8"]]},{"id":"75811f80.19931","type":"template","z":"9939c833.99b318","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<form action=\"/split-screen\" method=\"post\"  id=\"select\">\nMessage:<input type=\"text\" name=\"msg\">   \nQuick Page Message:<select name=\"msg\" form=\"select\" id=\"select\">\n        <option value=\"\"></option>\n        {{#quickpage}}\n         <option value=\"{{content}}\">{{content}}</option>\n        {{/quickpage}}\n</select>\nRecepient:<select name=\"pager\" form=\"select\" id=\"select\">\n        {{#payload}}\n         <option value=\"{{pagerNumber}}\">{{alias}}</option>\n        {{/payload}}\n</select>\nAppend Time:<input type=\"checkbox\" name=\"time\">\n<input type=\"submit\" value=\"Send\"><br>\n</form>\n\n\n<hr>\n\n<div class=\"nested2\">\n    <div class=\"bold\">Message</div>\n    <div class=\"bold\">Sent Time</div>\n</div>\n{{#data}}\n <div class=\"nested2\">\n    <div>{{{content}}}</div>\n    <div>{{displayTime}}</div>\n  </div>\n{{/data}}","output":"str","x":1730,"y":340,"wires":[["f862321.2f6e7d"]]},{"id":"a4f5a96e.07e058","type":"function","z":"9939c833.99b318","name":"Convert Time to local","func":"var array = msg.data\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.data[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n                msg.data[i].displayDate = displayDate\n                msg.data[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":1380,"y":340,"wires":[["9e910a95.ff8228"]]},{"id":"29af0c05.167c54","type":"http response","z":"9939c833.99b318","name":"","statusCode":"","headers":{},"x":790,"y":240,"wires":[]},{"id":"ea314091.3deb1","type":"template","z":"9939c833.99b318","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n<LINK href=\"FP.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    \n<audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n\n<div class=\"heading\">\n          \n    <div class=\"left\">{{{global.left}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n\n   <div class=\"split one wrapper\" id=\"one\"></div>\n   <div class=\"split two wrapper\" id=\"two\"></div>\n\n\n\n</body>\n\n</html>","output":"str","x":670,"y":240,"wires":[["29af0c05.167c54"]]},{"id":"4b6b4ad.def5eb4","type":"change","z":"9939c833.99b318","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Split Screen","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":240,"wires":[["34ba9fd9.0d6b2"]]},{"id":"44b5460f.fe4328","type":"function","z":"9939c833.99b318","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"default\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":1200,"y":340,"wires":[["a4f5a96e.07e058"]]},{"id":"34ba9fd9.0d6b2","type":"template","z":"9939c833.99b318","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var one = new WebSocket('ws://' + location.host + '/split-screen/receive/one');\nvar two = new WebSocket('ws://' + location.host + '/split-screen/receive/two');\nvar send = new WebSocket('ws://' + location.host + '/split-screen/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change One\none.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"one\").innerHTML = msg.payload;\n};\n\n// Change Two\ntwo.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"two\").innerHTML = msg.payload;\n};\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n","output":"str","x":550,"y":240,"wires":[["ea314091.3deb1"]]},{"id":"2c5430ff.3123f","type":"switch","z":"9939c833.99b318","name":"Licenced?","property":"modules","propertyType":"global","rules":[{"t":"cont","v":"/split-screen","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":300,"y":240,"wires":[["4b6b4ad.def5eb4"],["a72b8463.b905e8"]]},{"id":"a72b8463.b905e8","type":"link out","z":"9939c833.99b318","name":"","links":["f13a1f16.82872"],"x":395,"y":280,"wires":[]},{"id":"d14f8279.4648c","type":"websocket out","z":"9939c833.99b318","name":"","server":"2dd9c4a8.1fbccc","client":"","x":1260,"y":380,"wires":[]},{"id":"6b55aec3.28832","type":"template","z":"9939c833.99b318","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<div class=\"nested3\">\n    <div class=\"bold\">Callpoint</div>\n    <div class=\"bold\">Message</div>\n    <div class=\"bold\">Receive Time</div>\n</div>\n{{#payload}}\n <div class=\"nested3\">\n    <div>{{alias}} ({{sender}})</div>\n    <div>{{{content}}}</div>\n    <div>{{displayTime}}</div>\n  </div>\n{{/payload}}","output":"str","x":1050,"y":380,"wires":[["d14f8279.4648c"]]},{"id":"5ea3efa2.1fb7a","type":"sqlite","z":"60528a1b.f32364","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT `modules` FROM `settings`;","name":"CaptureCall","x":430,"y":640,"wires":[["a8a636bc.460278"]]},{"id":"149a9733.581029","type":"debug","z":"3c78672c.9cb1f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":360,"y":680,"wires":[]},{"id":"55534cbe.57ef14","type":"debug","z":"3c78672c.9cb1f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":1440,"y":500,"wires":[]},{"id":"e8d7c8d7.9a90f8","type":"debug","z":"3c78672c.9cb1f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1230,"y":460,"wires":[]},{"id":"a8a636bc.460278","type":"json","z":"60528a1b.f32364","name":"","property":"payload.0.modules","action":"","pretty":true,"x":570,"y":640,"wires":[["45a5ba11.d51434"]]},{"id":"45a5ba11.d51434","type":"change","z":"60528a1b.f32364","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0].modules","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":640,"wires":[["7e7fe23b.84c74c","8ef3cc6f.9a91a"]]},{"id":"e9663b25.2ecdf8","type":"comment","z":"b209c94d.26d798","name":"Put All On the Webpage","info":"","x":140,"y":340,"wires":[]},{"id":"572a891c.622e28","type":"template","z":"b209c94d.26d798","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM log WHERE date(datetime(rxtime / 1000 , 'unixepoch')) = date('now') AND `sender` != \"System\"\nORDER BY  `{{global.sort-by}}` {{global.direction}}","output":"str","x":330,"y":440,"wires":[["29fa674e.c38bc8"]]},{"id":"dc7b6d43.82fea","type":"websocket out","z":"b209c94d.26d798","name":"","server":"c0402614.f01608","client":"","x":1300,"y":440,"wires":[]},{"id":"29fa674e.c38bc8","type":"sqlite","z":"b209c94d.26d798","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":510,"y":440,"wires":[["23fab3c1.0aebac"]]},{"id":"e3e5acdd.18f9","type":"function","z":"b209c94d.26d798","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n    var statusTime = new Date(msg.payload[i].statusTime);\n                var displayStatusDate = statusTime.toLocaleDateString();\n                var displayStatusTime = statusTime.toLocaleTimeString();\n                \n  \n              \n     if (msg.payload[i].exported === null) {\n    msg.payload[i].displayExportedTime = \"n/a\"\n    msg.payload[i].displayExportedDate = \"n/a\"\n} else {\nvar exportedTime = new Date(msg.payload[i].exported);\n    var displayExportedDate = exportedTime.toLocaleDateString();\n    var displayExportedTime = exportedTime.toLocaleTimeString();\n              \n    msg.payload[i].displayExportedTime = displayExportedTime\n    msg.payload[i].displayExportedDate = displayExportedDate\n}         \n               \n                \n                msg.payload[i].displayStatusTime = displayStatusTime\n                msg.payload[i].displayStatusDate = displayStatusDate\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":440,"wires":[["9658fb59.3ebfe8"]]},{"id":"4a4f10a5.b3051","type":"link in","z":"b209c94d.26d798","name":"log","links":["363f5c70.e7e144","320906f1.fd1fba","ecbc4376.b117e","d2d8b8d2.67e9a8","8469e8af.2a6df8","2c38eaf2.df6f76","bc4b27b0.6d1478","5652483b.e30f08","e14222d1.c9cb7","f40e69c9.7d2798","18e72d9f.360682","80365a9f.6e5ef8","906b7dc8.7a615","5ce459da.1e66f8","dde42ec0.d2e1f","50e59502.8aad2c","38eb5a75.961926"],"x":175,"y":460,"wires":[["572a891c.622e28"]]},{"id":"23fab3c1.0aebac","type":"function","z":"b209c94d.26d798","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":440,"wires":[["e3e5acdd.18f9"]]},{"id":"9658fb59.3ebfe8","type":"template","z":"b209c94d.26d798","name":"Build Data (div Backup)","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<div class=\"nested10\">\n    <div class=\"bold sort-by\" onclick= send.send('index')>Index</div>\n    <div class=\"bold sort-by\" onclick= send.send('sender')>Callpoint</div>\n    <div class=\"bold sort-by\" onclick= send.send('content')>Message</div>\n    <div class=\"bold\">Receive Time</div>\n    <div class=\"bold sort-by\" onclick= send.send('rxTime')>Receive Date</div>\n    <div class=\"bold sort-by\" onclick= send.send('status')>Status</div>\n    <div class=\"bold\">Status Time</div>\n    <div class=\"bold sort-by\" onclick= send.send('statusTime')>Status Date</div>\n    <div class=\"bold sort-by\" onclick= send.send('pagerNumber')>Recipient</div>\n    <div class=\"bold sort-by\" onclick= send.send('sysID')>System ID</div>\n</div>\n{{#payload}}\n <div class=\"nested10 {{style}}\">\n    <div>{{index}}</div>\n    <div>{{sender}}</div>\n    <div>{{{content}}}</div>\n    <div>{{displayTime}}</div>\n    <div>{{displayDate}}</div>\n    <div>{{status}}</div>\n    <div>{{displayStatusTime}}</div>\n    <div>{{displayStatusDate}}</div>\n    <div>{{pagerNumber}}</div>\n    <div>{{sysID}}</div>\n  </div>\n{{/payload}}","output":"str","x":1070,"y":440,"wires":[["dc7b6d43.82fea"]]},{"id":"8aed6be1.ef9ee8","type":"switch","z":"b209c94d.26d798","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Open","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":380,"wires":[["1fbb2868.8151c8"],["572a891c.622e28"]]},{"id":"1fbb2868.8151c8","type":"change","z":"b209c94d.26d798","name":"","rules":[{"t":"set","p":"sort-by","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":380,"wires":[["b2f96c3b.4bd61"]]},{"id":"b2f96c3b.4bd61","type":"switch","z":"b209c94d.26d798","name":"","property":"direction","propertyType":"global","rules":[{"t":"eq","v":"ASC","vt":"str"},{"t":"eq","v":"DESC","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":380,"wires":[["4f227785.08f048"],["c10df447.d42fe8"]]},{"id":"4f227785.08f048","type":"change","z":"b209c94d.26d798","name":"","rules":[{"t":"set","p":"direction","pt":"global","to":"DESC","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":360,"wires":[["906b7dc8.7a615"]]},{"id":"c10df447.d42fe8","type":"change","z":"b209c94d.26d798","name":"","rules":[{"t":"set","p":"direction","pt":"global","to":"ASC","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":400,"wires":[["906b7dc8.7a615"]]},{"id":"906b7dc8.7a615","type":"link out","z":"b209c94d.26d798","name":"","links":["4a4f10a5.b3051"],"x":915,"y":380,"wires":[]},{"id":"8e929840.f614b8","type":"websocket in","z":"b209c94d.26d798","name":"","server":"c7526c07.3fd51","client":"","x":110,"y":380,"wires":[["8aed6be1.ef9ee8"]]},{"id":"4cfa91f3.ed729","type":"template","z":"9939c833.99b318","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT *\nFROM log\nLEFT JOIN callpointAlias ON log.sender = callpointAlias.callpoint\nWHERE date(datetime(rxtime / 1000 , 'unixepoch')) = date('now') AND `sender` != \"System\" AND `status` != \"Split Screen\" AND `status` != \"Quick Page\"\nORDER BY  `rxTime` DESC ;\n","output":"str","x":350,"y":380,"wires":[["462cb1cd.d5668"]]},{"id":"462cb1cd.d5668","type":"sqlite","z":"9939c833.99b318","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":530,"y":380,"wires":[["9dcbe880.cbfd68"]]},{"id":"d6b3daac.f529a8","type":"function","z":"9939c833.99b318","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n    var statusTime = new Date(msg.payload[i].statusTime);\n                var displayStatusDate = statusTime.toLocaleDateString();\n                var displayStatusTime = statusTime.toLocaleTimeString();\n                \n  \n              \n     if (msg.payload[i].exported === null) {\n    msg.payload[i].displayExportedTime = \"n/a\"\n    msg.payload[i].displayExportedDate = \"n/a\"\n} else {\nvar exportedTime = new Date(msg.payload[i].exported);\n    var displayExportedDate = exportedTime.toLocaleDateString();\n    var displayExportedTime = exportedTime.toLocaleTimeString();\n              \n    msg.payload[i].displayExportedTime = displayExportedTime\n    msg.payload[i].displayExportedDate = displayExportedDate\n}         \n               \n                \n                msg.payload[i].displayStatusTime = displayStatusTime\n                msg.payload[i].displayStatusDate = displayStatusDate\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":380,"wires":[["6b55aec3.28832"]]},{"id":"310fbd39.4aefd2","type":"link in","z":"9939c833.99b318","name":"log","links":["363f5c70.e7e144","320906f1.fd1fba","ecbc4376.b117e","d2d8b8d2.67e9a8","8469e8af.2a6df8","2c38eaf2.df6f76","bc4b27b0.6d1478","5652483b.e30f08","e14222d1.c9cb7","f40e69c9.7d2798","18e72d9f.360682","80365a9f.6e5ef8","baaeb70f.7624e8","5ce459da.1e66f8","dde42ec0.d2e1f","50e59502.8aad2c","38eb5a75.961926"],"x":195,"y":340,"wires":[["4cfa91f3.ed729","64ebaca6.468d04"]]},{"id":"9dcbe880.cbfd68","type":"function","z":"9939c833.99b318","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].FP != \"n/a\") {\n    msg.payload[i].style = msg.payload[i].FP\n} else {\n    msg.payload[i].style = \"\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":380,"wires":[["d6b3daac.f529a8"]]},{"id":"84a5871.9fe7f78","type":"websocket in","z":"9939c833.99b318","name":"","server":"1bd09651.1c7e5a","client":"","x":120,"y":380,"wires":[["4cfa91f3.ed729","64ebaca6.468d04"]]},{"id":"ef7571cc.7263e","type":"template","z":"9939c833.99b318","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PAGE,{{payload.pager}},{{global.sysID}},{{{payload.msg.0}}}{{{payload.msg.1}}}","output":"str","x":980,"y":560,"wires":[["ce99cc49.66e21"]]},{"id":"ce99cc49.66e21","type":"serial out","z":"9939c833.99b318","name":"","serial":"2db6df1c.cd63b","x":1130,"y":540,"wires":[]},{"id":"6274cf00.0a1c2","type":"template","z":"9939c833.99b318","name":"Add Msg to DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'group', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime', 'FP', 'payload') \nVALUES ('0', '{{payload.pager}}', '{{global.sysID}}', '0', '{{payload.msg.0}}{{payload.msg.1}}', 'n/a', 'n/a', '0','{{timestamp}}', 'Split Screen', '{{timestamp}}', 'n/a', 'n/a');","output":"str","x":680,"y":600,"wires":[["a8dab2.0050755"]]},{"id":"a8dab2.0050755","type":"sqlite","z":"9939c833.99b318","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":850,"y":600,"wires":[["50e59502.8aad2c"]]},{"id":"c6d4d9ae.312498","type":"change","z":"9939c833.99b318","name":"Time","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":600,"wires":[["6274cf00.0a1c2"]]},{"id":"50e59502.8aad2c","type":"link out","z":"9939c833.99b318","name":"to Log","links":["13c2aaaa.74d295","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":955,"y":600,"wires":[]},{"id":"11250122.c6d38f","type":"http in","z":"9939c833.99b318","name":"","url":"/split-screen","method":"post","upload":false,"swaggerDoc":"","x":110,"y":580,"wires":[["a6576438.126eb8","d7ea00f6.43c3f"]]},{"id":"a6576438.126eb8","type":"switch","z":"9939c833.99b318","name":"","property":"payload.msg","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":600,"wires":[["d9c7bd92.31891"]]},{"id":"d9c7bd92.31891","type":"switch","z":"9939c833.99b318","name":"","property":"payload.pager","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":600,"wires":[["c6d4d9ae.312498","a195fdab.e7d59"]]},{"id":"371f81d8.dcb76e","type":"http response","z":"9939c833.99b318","name":"","statusCode":"","headers":{},"x":430,"y":560,"wires":[]},{"id":"d7ea00f6.43c3f","type":"change","z":"9939c833.99b318","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/split-screen","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":560,"wires":[["371f81d8.dcb76e"]]},{"id":"a195fdab.e7d59","type":"switch","z":"9939c833.99b318","name":"Add Time?","property":"payload.time","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":560,"wires":[["f397bfa5.91fa5"],["ef7571cc.7263e"]]},{"id":"f3ba90d6.e35a8","type":"template","z":"9939c833.99b318","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PAGE,{{payload.pager}},{{global.sysID}},{{{payload.msg.0}}}{{{payload.msg.1}}} - {{timestamp}}","output":"str","x":980,"y":520,"wires":[["ce99cc49.66e21"]]},{"id":"28ef9eb6.42bf32","type":"http in","z":"aefd70ef.7eada","name":"","url":"/alias","method":"get","upload":false,"swaggerDoc":"","x":140,"y":100,"wires":[["45d27d60.5ea254"]]},{"id":"9711d2d6.97894","type":"comment","z":"aefd70ef.7eada","name":"Build Webpage","info":"","x":160,"y":60,"wires":[]},{"id":"9ab051c9.9e6c2","type":"http response","z":"aefd70ef.7eada","name":"","statusCode":"","headers":{},"x":770,"y":80,"wires":[]},{"id":"fd17d86b.67bd68","type":"template","z":"aefd70ef.7eada","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n       <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n   <div class=\"split one\" id=\"one\"></div>\n   <div class=\"split two\" id=\"two\"></div>\n\n</body>\n\n</html>","output":"str","x":650,"y":80,"wires":[["9ab051c9.9e6c2"]]},{"id":"985b6867.2a1678","type":"change","z":"aefd70ef.7eada","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Alias Settings","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":80,"wires":[["93423381.4c2d"]]},{"id":"a86c760c.7b36a8","type":"comment","z":"aefd70ef.7eada","name":"Put Data On the Webpage","info":"","x":190,"y":160,"wires":[]},{"id":"94b47d04.ae69c","type":"websocket out","z":"aefd70ef.7eada","name":"","server":"a446718.a7f529","client":"","x":1080,"y":200,"wires":[]},{"id":"71c32cea.d4ec34","type":"template","z":"aefd70ef.7eada","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":" <h>Callpoint Alias</h>\n<form action=\"/alias/callpoint\" method=\"post\" id=\"add\">\n  Alias: <input type=\"test\" name=\"alias\"><br>\n  Callpoint: <input type=\"number\" name=\"callpoint\"><br>\n  <input type=\"submit\" value=\"Add\">\n</form>    \n</div>\n<select id=\"dropdown1\">\n    <optgroup label=\"Select One\">\n        {{#payload}}\n         <option value=\"{{alias}}\">{{alias}}</option>\n        {{/payload}}\n</select>\n<input type=\"button\" onclick=\"send.send(dropdown1.value)\"value=\"Remove Alias\">\n</div>\n\n<p>\n{{#payload}}\n         \n{{alias}} - {{callpoint}}<br>\n        \n{{/payload}}\n</p>","output":"str","x":890,"y":200,"wires":[["94b47d04.ae69c"]]},{"id":"b512bc0d.d43f","type":"websocket in","z":"aefd70ef.7eada","name":"","server":"942141f5.a8944","client":"","x":160,"y":200,"wires":[["4f3bb7d.e64b048"]]},{"id":"4f3bb7d.e64b048","type":"switch","z":"aefd70ef.7eada","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":200,"wires":[["f348a3c8.85d4f","1be0c166.45d06f"]]},{"id":"93423381.4c2d","type":"template","z":"aefd70ef.7eada","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var one = new WebSocket('ws://' + location.host + '/alias/receive/one');\nvar two = new WebSocket('ws://' + location.host + '/alias/receive/two');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change One\none.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"one\").innerHTML = msg.payload;\n};\n\n// Change Two\ntwo.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"two\").innerHTML = msg.payload;\n};\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":530,"y":80,"wires":[["fd17d86b.67bd68"]]},{"id":"1157baf1.be4815","type":"switch","z":"aefd70ef.7eada","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":420,"wires":[["dae3733e.a0988","e986d976.0314d8"]]},{"id":"bc148d76.a62","type":"websocket in","z":"aefd70ef.7eada","name":"","server":"942141f5.a8944","client":"","x":160,"y":420,"wires":[["7e03a9d4.4bb4e8","1157baf1.be4815"]]},{"id":"36d8bcee.9da994","type":"comment","z":"aefd70ef.7eada","name":"Handle Input from Webpage","info":"","x":200,"y":360,"wires":[]},{"id":"45d27d60.5ea254","type":"switch","z":"aefd70ef.7eada","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":100,"wires":[["985b6867.2a1678"],["d6762c10.0cdbe"]]},{"id":"d6762c10.0cdbe","type":"link out","z":"aefd70ef.7eada","name":"back to settings","links":["4212ad6a.fb9f04"],"x":355,"y":120,"wires":[]},{"id":"f348a3c8.85d4f","type":"template","z":"aefd70ef.7eada","name":"Select Callpoint Alias Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM `callpointAlias`;","output":"str","x":520,"y":200,"wires":[["ad32f728.22c268"]]},{"id":"ad32f728.22c268","type":"sqlite","z":"aefd70ef.7eada","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":730,"y":200,"wires":[["71c32cea.d4ec34"]]},{"id":"dae3733e.a0988","type":"template","z":"aefd70ef.7eada","name":"Remove from DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `callpointAlias`\nWHERE `alias`=\"{{payload}}\";","output":"str","x":470,"y":400,"wires":[["74d9e28c.999adc"]]},{"id":"74d9e28c.999adc","type":"sqlite","z":"aefd70ef.7eada","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":650,"y":420,"wires":[["2aef09c2.a99756","f348a3c8.85d4f","1be0c166.45d06f"]]},{"id":"a8a41f6c.c859c","type":"http response","z":"aefd70ef.7eada","name":"","statusCode":"","headers":{},"x":950,"y":420,"wires":[]},{"id":"2aef09c2.a99756","type":"change","z":"aefd70ef.7eada","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/alias","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":420,"wires":[["a8a41f6c.c859c"]]},{"id":"3fc6dfd3.b70a3","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":760,"wires":[]},{"id":"832fc0b1.28f94","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":720,"wires":[["976ebe96.056fb"]]},{"id":"d57c20e3.ee9b5","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE `callpointAlias` ( \t`alias`\tTEXT NOT NULL UNIQUE, \t`callpoint`\tINTEGER, \tPRIMARY KEY(`alias`) );","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":720,"wires":[["832fc0b1.28f94"]]},{"id":"976ebe96.056fb","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":720,"wires":[]},{"id":"d5b1ce4.fc2243","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":760,"wires":[["3fc6dfd3.b70a3"]]},{"id":"6e9ee648.335c78","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'callpointAlias';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":760,"wires":[["d5b1ce4.fc2243"]]},{"id":"248f1d7c.5d1392","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":800,"wires":[]},{"id":"77797078.887ca","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":800,"wires":[["248f1d7c.5d1392"]]},{"id":"5bf69e06.abe9c","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'callpointAlias';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":800,"wires":[["77797078.887ca"]]},{"id":"6db20a0e.856054","type":"comment","z":"ba76d305.cf8ad","name":"Callpoint Alias","info":"","x":510,"y":680,"wires":[]},{"id":"11f87268.98cf0e","type":"catch","z":"aefd70ef.7eada","name":"","scope":["2682099a.780f86"],"x":890,"y":600,"wires":[["2aef09c2.a99756"]]},{"id":"7600a838.ea1d88","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1390,"y":760,"wires":[]},{"id":"dfbe9a4a.a1b5b8","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":720,"wires":[["e7a282a3.524fe"]]},{"id":"7a138fdf.f91a1","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE `pagerAlias` ( \t`alias`\tTEXT NOT NULL UNIQUE,\t`pagerNumber`\tINTEGER, \tPRIMARY KEY(`alias`) );","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1070,"y":720,"wires":[["dfbe9a4a.a1b5b8"]]},{"id":"e7a282a3.524fe","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1390,"y":720,"wires":[]},{"id":"aa037a7f.c6f688","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":760,"wires":[["7600a838.ea1d88"]]},{"id":"aecab930.dc9588","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'pagerAlias';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1080,"y":760,"wires":[["aa037a7f.c6f688"]]},{"id":"5908d21c.0f52cc","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1390,"y":800,"wires":[]},{"id":"fd18b4b1.d2b8b8","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":800,"wires":[["5908d21c.0f52cc"]]},{"id":"e3504781.f45ab8","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'pagerAlias';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1080,"y":800,"wires":[["fd18b4b1.d2b8b8"]]},{"id":"7fe45b38.db3764","type":"comment","z":"ba76d305.cf8ad","name":"Pager Alias","info":"","x":1250,"y":680,"wires":[]},{"id":"652c145.e95fbec","type":"template","z":"aefd70ef.7eada","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h>Pager Alias</h>\n<form action=\"/alias/pager\" method=\"post\" id=\"add\">\n  Alias: <input type=\"test\" name=\"alias\"><br>\n  Pager Number: <input type=\"number\" name=\"pager\"><br>\n  <input type=\"submit\" value=\"Add\">\n</form>    \n</div>\n<select id=\"dropdown2\">\n    <optgroup label=\"Select One\">\n        {{#payload}}\n         <option value=\"{{alias}}\">{{alias}}</option>\n        {{/payload}}\n</select>\n<input type=\"button\" onclick=\"send.send(dropdown2.value)\"value=\"Remove Alias\">\n</div>\n\n<p>\n{{#payload}}\n         \n{{alias}} - {{pagerNumber}}<br>\n        \n{{/payload}}\n</p>","output":"str","x":890,"y":240,"wires":[["b6d177b6.5ed828"]]},{"id":"b6d177b6.5ed828","type":"websocket out","z":"aefd70ef.7eada","name":"","server":"f2da83eb.80921","client":"","x":1080,"y":240,"wires":[]},{"id":"1be0c166.45d06f","type":"template","z":"aefd70ef.7eada","name":"Select Pager Alias Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM `pagerAlias`;","output":"str","x":530,"y":240,"wires":[["3cc69ef9.e1d652"]]},{"id":"3cc69ef9.e1d652","type":"sqlite","z":"aefd70ef.7eada","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":730,"y":240,"wires":[["652c145.e95fbec"]]},{"id":"d1ca6275.be209","type":"template","z":"aefd70ef.7eada","name":"Add Alias to DB (Callpoint)","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `callpointAlias` ('alias', 'callpoint') VALUES ('{{payload.alias}}', '{{payload.callpoint}}');","output":"str","x":680,"y":640,"wires":[["2682099a.780f86","535c1893.ec9098"]]},{"id":"2682099a.780f86","type":"sqlite","z":"aefd70ef.7eada","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":910,"y":640,"wires":[["2aef09c2.a99756"]]},{"id":"c66c8b92.74ac88","type":"switch","z":"aefd70ef.7eada","name":"","property":"payload.alias","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":640,"wires":[["9eb090eb.f8e7b"]]},{"id":"155d7c3a.46dc04","type":"http in","z":"aefd70ef.7eada","name":"","url":"/alias/callpoint","method":"post","upload":false,"swaggerDoc":"","x":170,"y":640,"wires":[["c66c8b92.74ac88"]]},{"id":"535c1893.ec9098","type":"debug","z":"aefd70ef.7eada","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":900,"y":700,"wires":[]},{"id":"9eb090eb.f8e7b","type":"switch","z":"aefd70ef.7eada","name":"","property":"payload.callpoint","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":640,"wires":[["d1ca6275.be209"],["2aef09c2.a99756"]]},{"id":"aebb3baa.6eb7a8","type":"template","z":"aefd70ef.7eada","name":"Add Alias to DB (Pager Number)","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `pagerAlias` ('alias', 'pagerNumber') VALUES ('{{payload.alias}}', '{{payload.pager}}');","output":"str","x":670,"y":700,"wires":[["2682099a.780f86","535c1893.ec9098"]]},{"id":"f73e9b49.4b30c8","type":"switch","z":"aefd70ef.7eada","name":"","property":"payload.alias","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":700,"wires":[["551d4a9f.207a94"]]},{"id":"3936b9d7.0c8a46","type":"http in","z":"aefd70ef.7eada","name":"","url":"/alias/pager","method":"post","upload":false,"swaggerDoc":"","x":170,"y":700,"wires":[["f73e9b49.4b30c8"]]},{"id":"551d4a9f.207a94","type":"switch","z":"aefd70ef.7eada","name":"","property":"payload.pager","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":700,"wires":[["aebb3baa.6eb7a8"],["2aef09c2.a99756"]]},{"id":"7e03a9d4.4bb4e8","type":"debug","z":"aefd70ef.7eada","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":210,"y":560,"wires":[]},{"id":"e986d976.0314d8","type":"template","z":"aefd70ef.7eada","name":"Remove from DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `pagerAlias`\nWHERE `alias`=\"{{payload}}\";","output":"str","x":470,"y":440,"wires":[["74d9e28c.999adc"]]},{"id":"9e910a95.ff8228","type":"sqlite","z":"9939c833.99b318","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT * FROM `pagerAlias`;","name":"CaptureCall","x":1570,"y":340,"wires":[["75811f80.19931"]]},{"id":"f397bfa5.91fa5","type":"moment","z":"9939c833.99b318","name":"","topic":"","input":"","inputType":"date","inTz":"Etc/UTC","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm:ss","locale":"en_US","output":"timestamp","outputType":"msg","outTz":"Etc/ETC/GMT","x":800,"y":520,"wires":[["f3ba90d6.e35a8"]]},{"id":"e9175bc6.696678","type":"http in","z":"53762a60.6160b4","name":"","url":"/setQP","method":"get","upload":false,"swaggerDoc":"","x":110,"y":80,"wires":[["c6e6ed59.8e76a"]]},{"id":"ec979ea5.33cb9","type":"comment","z":"53762a60.6160b4","name":"Build Webpage","info":"","x":120,"y":40,"wires":[]},{"id":"e3bb57cc.a2b9a8","type":"http response","z":"53762a60.6160b4","name":"","statusCode":"","headers":{},"x":730,"y":60,"wires":[]},{"id":"ae41ee14.e3ce3","type":"template","z":"53762a60.6160b4","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>{{title}}</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n<LINK href=\"style.css\" rel=\"stylesheet\" type=\"text/css\">\n\n</head>\n\n<body onload=\"startTime()\">\n    <audio id=\"beep\" src=\"sounds/{{global.beep}}\" type=\"audio/ogg\"></audio>\n\n<div class=\"heading\">\n          \n       <div class=\"left\">{{{global.settings_list}}}</div>\n    \n    <div class=\"middle\">\n        <h1 id=\"title\">{{title}}</h1>\n    </div>\n    \n    <div class=\"right\">\n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n</div>\n\n<div class=\"wrapper\" id=\"data\">\n\n</div>\n\n</body>\n\n</html>","output":"str","x":610,"y":60,"wires":[["e3bb57cc.a2b9a8"]]},{"id":"ac0517b6.d9e3f8","type":"change","z":"53762a60.6160b4","name":"Title","rules":[{"t":"set","p":"title","pt":"msg","to":"CaptureCall Quick Page Settings","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":60,"wires":[["e03e5ad0.d30828"]]},{"id":"7d82eb2d.b0c5f4","type":"comment","z":"53762a60.6160b4","name":"Put Data On the Webpage","info":"","x":150,"y":140,"wires":[]},{"id":"a840eab1.b75478","type":"websocket out","z":"53762a60.6160b4","name":"","server":"7d649c17.1d11a4","client":"","x":990,"y":180,"wires":[]},{"id":"ffb39ddf.99166","type":"template","z":"53762a60.6160b4","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\n<div class=\"wrapper\">\n<form action=\"/setQP\" method=\"post\" id=\"add\">\n  Pager Number: <input type=\"number\" name=\"pagerNumber\" defaultValue = \"0707288\"><br>\n  System ID: <input type=\"number\" name=\"sysID\" defaultValue = \"0\"><br>\n  Message: <input type=\"text\" name=\"content\"><br>\n  Beep Time (s)(Blank for Default):<input type=\"number\" name=\"Beep\" defaultValue = \"0\">\n  Beep Style:<select name=\"beep\" form=\"add\">\n    <optgroup label=\"Select One\">\n         <option value=\"\">Default</option>\n         <option value=\"b0\">Loud Beep</option>\n         <option value=\"b1\">Soft Beep</option>\n         <option value=\"b2\">Vibe/Beep</option>\n         <option value=\"b3\">Look-down Mode</option>\n</select><br>\n  Vibe Time (s)(Blank for Default):<input type=\"number\" name=\"Vibe\" defaultValue = \"0\">\n  Vibe Style:<select name=\"vibe\" form=\"add\">\n    <optgroup label=\"Select One\">\n         <option value=\"\">Default</option>\n         <option value=\"v0\">Constant</option>\n         <option value=\"v1\">Pulse 1</option>\n         <option value=\"v2\">Pulse 2</option>\n         <option value=\"v3\">Pulse 3</option>\n         <option value=\"v4\">Pulse 4</option>\n         <option value=\"v5\">Pulse 5</option>\n         <option value=\"v6\">Pulse 6</option>\n</select><br>\n    \n  <input type=\"submit\" value=\"Submit\">\n</form>    \n</div>\n<select id=\"dropdown\">\n    <optgroup label=\"Select One\">\n        {{#payload}}\n         <option value=\"{{index}}\">{{content}}</option>\n        {{/payload}}\n</select>\n<input type=\"button\" onclick=\"send.send(dropdown.value)\"value=\"Remove Quick Page\">\n</div>","output":"str","x":810,"y":180,"wires":[["a840eab1.b75478"]]},{"id":"92aec48c.fadac8","type":"switch","z":"53762a60.6160b4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":180,"wires":[["9f4fce9b.9166c"]]},{"id":"e03e5ad0.d30828","type":"template","z":"53762a60.6160b4","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"var receive = new WebSocket('ws://' + location.host + '/setQP/receive');\nvar send = new WebSocket('ws://' + location.host + '/setQP/send');\nvar beep = new WebSocket('ws://' + location.host + '/beep');\nvar popup = new WebSocket('ws://' + location.host + '/alert');\n\n//Play Sound\nbeep.onmessage = function(d) {\nvar audio = document.getElementById(\"beep\"); \n  audio.play();\n};\n\n// Display Popup\npopup.onmessage = function(d) {\n    var txt = d.data;\n     msg = JSON.parse(txt);\n   alert(msg.payload);\n};\n\n\nvar msg = 0; // Make Incoming WS Global\n\n// Change Main Data\nreceive.onmessage = function(d) {\n    var txt = d.data;\n    msg = JSON.parse(txt);\n    console.log(msg);\n    document.getElementById(\"data\").innerHTML = msg.payload;\n};\n\n\n        \n// When the connection is open, send some data to the server\nsend.onopen = function() {\n    console.log('WebSocket Open');\n    send.send('Open');\n};\n\n\nfunction startTime() { //Clock\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML = h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} \n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}","output":"str","x":490,"y":60,"wires":[["ae41ee14.e3ce3"]]},{"id":"fc4eff16.dd3f8","type":"switch","z":"53762a60.6160b4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"},{"t":"btwn","v":"1","vt":"num","v2":"99","v2t":"num"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":300,"wires":[[],["7f378075.f7be8"]]},{"id":"4e627db0.a3e074","type":"websocket in","z":"53762a60.6160b4","name":"","server":"c91ee09b.1a258","client":"","x":120,"y":300,"wires":[["fc4eff16.dd3f8"]]},{"id":"bc4c68fa.9963a8","type":"comment","z":"53762a60.6160b4","name":"Handle Input from Webpage","info":"","x":160,"y":240,"wires":[]},{"id":"c6e6ed59.8e76a","type":"switch","z":"53762a60.6160b4","name":"","property":"req.cookies.admin","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":80,"wires":[["ac0517b6.d9e3f8"],["13b61216.32c1de"]]},{"id":"13b61216.32c1de","type":"link out","z":"53762a60.6160b4","name":"back to settings","links":["167e6a6e.86b396"],"x":335,"y":100,"wires":[]},{"id":"9f4fce9b.9166c","type":"template","z":"53762a60.6160b4","name":"Select Quick Page Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM `quick_page`;","output":"str","x":450,"y":180,"wires":[["564be98d.3a55c8"]]},{"id":"564be98d.3a55c8","type":"sqlite","z":"53762a60.6160b4","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":650,"y":180,"wires":[["ffb39ddf.99166"]]},{"id":"7f378075.f7be8","type":"template","z":"53762a60.6160b4","name":"Remove from DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `quick_page`\nWHERE `index`={{payload}};","output":"str","x":430,"y":300,"wires":[["d9aa645.2a16c98"]]},{"id":"d9aa645.2a16c98","type":"sqlite","z":"53762a60.6160b4","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":610,"y":300,"wires":[["cdcb98ae.5c59b8","9f4fce9b.9166c"]]},{"id":"6b47318.4e6cbd","type":"template","z":"53762a60.6160b4","name":"Add Quick Page to DB","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `quick_page` ('pagerNumber', 'sysID', 'content', 'FP') VALUES ('{{payload.pagerNumber}}', '{{payload.sysID}}', '{{payload.content}}','{{{payload.Beep}}}{{{payload.beep}}}{{{payload.Vibe}}}{{{payload.vibe}}}');","output":"str","x":940,"y":360,"wires":[["d5ea3a46.87db18","fe3e481f.ed3938"]]},{"id":"d5ea3a46.87db18","type":"sqlite","z":"53762a60.6160b4","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1130,"y":360,"wires":[["cdcb98ae.5c59b8"]]},{"id":"97d8194e.7a33a8","type":"http response","z":"53762a60.6160b4","name":"","statusCode":"","headers":{},"x":910,"y":300,"wires":[]},{"id":"10135363.fe9ead","type":"switch","z":"53762a60.6160b4","name":"","property":"payload.pagerNumber","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":360,"wires":[["958dd024.861a1"]]},{"id":"462fce27.0f5ca","type":"http in","z":"53762a60.6160b4","name":"","url":"/setQP","method":"post","upload":false,"swaggerDoc":"","x":110,"y":360,"wires":[["10135363.fe9ead","afe8f3e1.75e91"]]},{"id":"cdcb98ae.5c59b8","type":"change","z":"53762a60.6160b4","name":"Redirect","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"302","tot":"num"},{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.location","pt":"msg","to":"/setQP","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":300,"wires":[["97d8194e.7a33a8"]]},{"id":"958dd024.861a1","type":"switch","z":"53762a60.6160b4","name":"","property":"payload.Beep","propertyType":"msg","rules":[{"t":"empty"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":360,"wires":[["1d87eeb9.d998e1"],["53e2c166.67fc3"]]},{"id":"53e2c166.67fc3","type":"template","z":"53762a60.6160b4","name":"","field":"payload.Beep","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"B{{payload.Beep}}","output":"str","x":500,"y":380,"wires":[["1d87eeb9.d998e1"]]},{"id":"1d87eeb9.d998e1","type":"switch","z":"53762a60.6160b4","name":"","property":"payload.Vibe","propertyType":"msg","rules":[{"t":"empty"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":360,"wires":[["6b47318.4e6cbd"],["bfe05008.2f677"]]},{"id":"bfe05008.2f677","type":"template","z":"53762a60.6160b4","name":"","field":"payload.Vibe","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"V{{payload.Vibe}}","output":"str","x":760,"y":380,"wires":[["6b47318.4e6cbd"]]},{"id":"afe8f3e1.75e91","type":"debug","z":"53762a60.6160b4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":250,"y":400,"wires":[]},{"id":"fe3e481f.ed3938","type":"debug","z":"53762a60.6160b4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":1120,"y":400,"wires":[]},{"id":"e037583e.2056e8","type":"websocket in","z":"53762a60.6160b4","name":"","server":"c91ee09b.1a258","client":"","x":120,"y":180,"wires":[["92aec48c.fadac8"]]},{"id":"bcbbf453.9c3be8","type":"change","z":"9939c833.99b318","name":"","rules":[{"t":"set","p":"data","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":340,"wires":[["a69165f3.061688"]]},{"id":"81235432.a8b4d8","type":"debug","z":"b00e2d77.a9931","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1240,"y":440,"wires":[]},{"id":"a69165f3.061688","type":"sqlite","z":"9939c833.99b318","mydb":"fd38eee5.8bd8a","sqlquery":"fixed","sql":"SELECT * FROM `quick_page`;","name":"CaptureCall","x":850,"y":340,"wires":[["7bc4367c.81c528"]]},{"id":"7bc4367c.81c528","type":"change","z":"9939c833.99b318","name":"","rules":[{"t":"set","p":"quickpage","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":340,"wires":[["44b5460f.fe4328"]]},{"id":"bcaa4b58.b00838","type":"websocket in","z":"69336e92.97cdb","name":"","server":"a0966341.283ff","client":"","x":150,"y":640,"wires":[["dca52341.8c16b"]]},{"id":"dca52341.8c16b","type":"switch","z":"69336e92.97cdb","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Shutdown","vt":"str"},{"t":"regex","v":"(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":640,"wires":[["29adcff4.e3f22"],["546dfdb9.54b494"]]},{"id":"3f515a45.9371e6","type":"exec","z":"69336e92.97cdb","command":"shutdown -P now","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"","x":790,"y":640,"wires":[["b9a5b18a.866ae"],["b9a5b18a.866ae"],["b9a5b18a.866ae"]]},{"id":"e4294a05.13e988","type":"delay","z":"69336e92.97cdb","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":640,"wires":[["3f515a45.9371e6"]]},{"id":"17b82f1c.dc10e1","type":"websocket out","z":"69336e92.97cdb","name":"Show Alert for Shutdown","server":"91b7d145.fc4e5","client":"","x":810,"y":600,"wires":[]},{"id":"29adcff4.e3f22","type":"change","z":"69336e92.97cdb","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"CaptureCall is Shutting Down... Please Close your Browser (If Necessary)","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":640,"wires":[["e4294a05.13e988","2915607d.c556d","eb73389b.af5378"]]},{"id":"513b3c7d.0c1584","type":"template","z":"69336e92.97cdb","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Power Off','Power Off', '{{timestamp}}', '{{timestamp}}');","output":"str","x":760,"y":680,"wires":[["3cfca496.2234dc"]]},{"id":"3cfca496.2234dc","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":910,"y":680,"wires":[[]]},{"id":"2915607d.c556d","type":"change","z":"69336e92.97cdb","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":680,"wires":[["513b3c7d.0c1584"]]},{"id":"b9a5b18a.866ae","type":"debug","z":"69336e92.97cdb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1000,"y":640,"wires":[]},{"id":"7ac5988d.f9d118","type":"template","z":"69336e92.97cdb","name":"Clear","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `log` WHERE `exported` IS NOT NULL;","output":"str","x":470,"y":380,"wires":[["ed55d58.3ba2528"]]},{"id":"ed55d58.3ba2528","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":610,"y":380,"wires":[["6249b7a0.8bf748"]]},{"id":"6249b7a0.8bf748","type":"change","z":"69336e92.97cdb","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Records Deleted","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":380,"wires":[["a3140b4b.44c628","2dc2fcae.42e424"]]},{"id":"e5189a68.b6f6d8","type":"websocket out","z":"69336e92.97cdb","name":"Show Alert for Clear Database","server":"91b7d145.fc4e5","client":"","x":1170,"y":340,"wires":[]},{"id":"a3140b4b.44c628","type":"change","z":"69336e92.97cdb","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":380,"wires":[["49f2faea.1f4d04"]]},{"id":"49f2faea.1f4d04","type":"template","z":"69336e92.97cdb","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Records Deleted','Records Deleted', '{{timestamp}}', '{{timestamp}}');","output":"str","x":1080,"y":380,"wires":[["9811c3df.4feea"]]},{"id":"9811c3df.4feea","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1230,"y":380,"wires":[[]]},{"id":"b469ec62.d0cd9","type":"switch","z":"69336e92.97cdb","name":"","property":"payload.resetLogExported","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":380,"wires":[["7ac5988d.f9d118"]]},{"id":"2dc2fcae.42e424","type":"delay","z":"69336e92.97cdb","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":340,"wires":[["e5189a68.b6f6d8"]]},{"id":"eb73389b.af5378","type":"delay","z":"69336e92.97cdb","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":600,"wires":[["17b82f1c.dc10e1"]]},{"id":"546dfdb9.54b494","type":"change","z":"69336e92.97cdb","name":"","rules":[{"t":"set","p":"to","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":720,"wires":[["30567ef7.d84f32","8eab886c.96a868"]]},{"id":"30567ef7.d84f32","type":"DataIn","z":"69336e92.97cdb","collection":"e1c85b2c.abed18","name":"","update":false,"path":"/email","x":610,"y":760,"wires":[]},{"id":"3af57aa4.fb33f6","type":"template","z":"69336e92.97cdb","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'group', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime', 'FP', 'payload') \nVALUES ('0', '0', '0', '0', 'eMail Changed to {{global.to}}', 'n/a', 'n/a', 'System','{{timestamp}}', 'eMail Address Changed', '{{timestamp}}', 'n/a', 'n/a');\n","output":"str","x":770,"y":720,"wires":[["ffa14edd.0db52"]]},{"id":"ffa14edd.0db52","type":"sqlite","z":"69336e92.97cdb","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":930,"y":720,"wires":[["38eb5a75.961926"]]},{"id":"8eab886c.96a868","type":"change","z":"69336e92.97cdb","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":720,"wires":[["3af57aa4.fb33f6"]]},{"id":"38eb5a75.961926","type":"link out","z":"69336e92.97cdb","name":"","links":["13c2aaaa.74d295","f8b2c7bc.b77368","ed29f70d.9b66f8","f72ff61b.e8d618","9f5ece3e.bbcec","18c85238.12770e","e7fc0665.f65b68","bcfd7457.19e388","4a4f10a5.b3051","b5c92d.f71dc6d","243d97b4.836608","2b072128.63ebce","9f9249fe.868128","e1745f49.c16d5","310fbd39.4aefd2","5c2e41bd.c154c"],"x":1035,"y":720,"wires":[]},{"id":"2f6a8d56.b55d32","type":"http in","z":"3c78672c.9cb1f8","name":"","url":"/engineer/home","method":"post","upload":false,"swaggerDoc":"","x":140,"y":800,"wires":[["f5dc6436.88d388","c8941714.162de8","c015747.3acb388"]]},{"id":"f5dc6436.88d388","type":"debug","z":"3c78672c.9cb1f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":360,"y":800,"wires":[]},{"id":"ecb26282.47ff2","type":"template","z":"3c78672c.9cb1f8","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `settings`\nSET home = '{{{payload.home}}}'\nWHERE ID = 1;","output":"str","x":540,"y":840,"wires":[["1d39beb6.73a071"]]},{"id":"1d39beb6.73a071","type":"sqlite","z":"3c78672c.9cb1f8","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":690,"y":840,"wires":[[]]},{"id":"c8941714.162de8","type":"change","z":"3c78672c.9cb1f8","name":"","rules":[{"t":"set","p":"home","pt":"global","to":"payload.home","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":840,"wires":[["ecb26282.47ff2"]]},{"id":"4b37da86.0f11f4","type":"switch","z":"23c43518.b3ff0a","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":300,"y":140,"wires":[["815b7467.abb828"]]},{"id":"d30585c8.f8e898","type":"http in","z":"b8bd1cc3.4827","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":100,"y":120,"wires":[["4ae44c2c.e8d614"]]},{"id":"4ae44c2c.e8d614","type":"switch","z":"b8bd1cc3.4827","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"First Aid","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":120,"wires":[["e27d3777.8cf898"]]},{"id":"6cdd231c.35fbfc","type":"http in","z":"d0e2bfbf.dfe3f","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":100,"y":120,"wires":[["d34a38e4.3578d8"]]},{"id":"d34a38e4.3578d8","type":"switch","z":"d0e2bfbf.dfe3f","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"},{"t":"eq","v":"First Aid","vt":"str"},{"t":"eq","v":"Table Display","vt":"str"},{"t":"eq","v":"Daily Log","vt":"str"},{"t":"eq","v":"Full Log","vt":"str"},{"t":"eq","v":"Quick Page","vt":"str"},{"t":"eq","v":"Free Page","vt":"str"},{"t":"eq","v":"Split Screen","vt":"str"},{"t":"eq","v":"Export","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":300,"y":120,"wires":[[],[],["1e6521b9.49276e"],[],[],[],[],[],[]]},{"id":"b49b3aab.e2cd28","type":"http in","z":"b209c94d.26d798","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":140,"y":120,"wires":[["c660ec68.bceac"]]},{"id":"c660ec68.bceac","type":"switch","z":"b209c94d.26d798","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"},{"t":"eq","v":"First Aid","vt":"str"},{"t":"eq","v":"Table Display","vt":"str"},{"t":"eq","v":"Daily Log","vt":"str"},{"t":"eq","v":"Full Log","vt":"str"},{"t":"eq","v":"Quick Page","vt":"str"},{"t":"eq","v":"Free Page","vt":"str"},{"t":"eq","v":"Split Screen","vt":"str"},{"t":"eq","v":"Export","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":340,"y":120,"wires":[[],[],[],["5dda820c.bf5e2c"],[],[],[],[],[]]},{"id":"caec078f.69d7b8","type":"http in","z":"1c96dbb1.1bc354","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":100,"y":140,"wires":[["d66e5e06.5420b"]]},{"id":"d66e5e06.5420b","type":"switch","z":"1c96dbb1.1bc354","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"},{"t":"eq","v":"First Aid","vt":"str"},{"t":"eq","v":"Table Display","vt":"str"},{"t":"eq","v":"Daily Log","vt":"str"},{"t":"eq","v":"Full Log","vt":"str"},{"t":"eq","v":"Quick Page","vt":"str"},{"t":"eq","v":"Free Page","vt":"str"},{"t":"eq","v":"Split Screen","vt":"str"},{"t":"eq","v":"Export","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":300,"y":140,"wires":[[],[],[],[],["ecde1301.2ebb3"],[],[],[],[]]},{"id":"ceaf619d.7cb7c","type":"http in","z":"53e35596.381c0c","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":140,"y":100,"wires":[["544234d1.872ffc"]]},{"id":"544234d1.872ffc","type":"switch","z":"53e35596.381c0c","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"},{"t":"eq","v":"First Aid","vt":"str"},{"t":"eq","v":"Table Display","vt":"str"},{"t":"eq","v":"Daily Log","vt":"str"},{"t":"eq","v":"Full Log","vt":"str"},{"t":"eq","v":"Quick Page","vt":"str"},{"t":"eq","v":"Free Page","vt":"str"},{"t":"eq","v":"Split Screen","vt":"str"},{"t":"eq","v":"Export","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":340,"y":100,"wires":[[],[],[],[],[],["7530d890.2f9e38"],[],[],[]]},{"id":"34f7b8de.2173c8","type":"http in","z":"9939c833.99b318","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":100,"y":200,"wires":[["dc76eb19.2c2d08"]]},{"id":"dc76eb19.2c2d08","type":"switch","z":"9939c833.99b318","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Split Screen","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":200,"wires":[["2c5430ff.3123f"]]},{"id":"78ee9ee.b224f6","type":"http in","z":"da0e8c29.a0583","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":140,"y":140,"wires":[["121a0462.ab01fc"]]},{"id":"121a0462.ab01fc","type":"switch","z":"da0e8c29.a0583","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"},{"t":"eq","v":"First Aid","vt":"str"},{"t":"eq","v":"Table Display","vt":"str"},{"t":"eq","v":"Daily Log","vt":"str"},{"t":"eq","v":"Full Log","vt":"str"},{"t":"eq","v":"Quick Page","vt":"str"},{"t":"eq","v":"Free Page","vt":"str"},{"t":"eq","v":"Split Screen","vt":"str"},{"t":"eq","v":"Export","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":340,"y":140,"wires":[[],[],[],[],[],[],["28ed18d2.41fe48"],[],[]]},{"id":"37728c16.c22f04","type":"http in","z":"b00e2d77.a9931","name":"","url":"/home","method":"get","upload":false,"swaggerDoc":"","x":80,"y":100,"wires":[["f99c9b33.f448f8"]]},{"id":"f99c9b33.f448f8","type":"switch","z":"b00e2d77.a9931","name":"Set Home Page","property":"home","propertyType":"global","rules":[{"t":"eq","v":"Dynamic Display","vt":"str"},{"t":"eq","v":"First Aid","vt":"str"},{"t":"eq","v":"Table Display","vt":"str"},{"t":"eq","v":"Daily Log","vt":"str"},{"t":"eq","v":"Full Log","vt":"str"},{"t":"eq","v":"Quick Page","vt":"str"},{"t":"eq","v":"Free Page","vt":"str"},{"t":"eq","v":"Split Screen","vt":"str"},{"t":"eq","v":"Export","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":280,"y":100,"wires":[[],[],[],[],[],[],[],[],["b1874a1b.abe738"]]},{"id":"4106d01a.26cd8","type":"http in","z":"23c43518.b3ff0a","name":"","url":"/","method":"get","upload":false,"swaggerDoc":"","x":100,"y":140,"wires":[["815b7467.abb828"]]},{"id":"e990cea.1b2c23","type":"comment","z":"9939c833.99b318","name":"Left Side HTML","info":"","x":1740,"y":280,"wires":[]},{"id":"b88a294d.c11af8","type":"comment","z":"9939c833.99b318","name":"Right Side HTML","info":"","x":1040,"y":420,"wires":[]},{"id":"3157d2d8.f5f64e","type":"comment","z":"9939c833.99b318","name":"Headder and Body HTML","info":"","x":710,"y":200,"wires":[]}]