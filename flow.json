[{"id":"71697e01.9871a","type":"tab","label":"Pager Dynamic Display","disabled":false,"info":""},{"id":"1c96dbb1.1bc354","type":"tab","label":"Log Display Full","disabled":false,"info":""},{"id":"b209c94d.26d798","type":"tab","label":"Log Display Daily","disabled":false,"info":""},{"id":"b00e2d77.a9931","type":"tab","label":"Export","disabled":false,"info":""},{"id":"ba76d305.cf8ad","type":"tab","label":"DB Utilities","disabled":false,"info":""},{"id":"5461daa4.49fb24","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"50","bin":"false","out":"interbyte","addchar":false,"responsetimeout":""},{"id":"8ad92631.0da208","type":"websocket-listener","z":"","path":"/ws/data","wholemsg":"true"},{"id":"33804e00.060d32","type":"sqlitedb","z":"","db":"/home/Ingenso/CaptureCall.db","mode":"RWC"},{"id":"60d07179.968bc","type":"json-db-collection","z":"","name":"","collection":"settings","save":true},{"id":"5cdd612c.78168","type":"websocket-listener","z":"","path":"/ws/export","wholemsg":"false"},{"id":"e0f20fd0.b6362","type":"websocket-listener","z":"","path":"/ws/sender","wholemsg":"false"},{"id":"d471fcd2.f0968","type":"websocket-listener","z":"","path":"/ws/receive","wholemsg":"true"},{"id":"87b7d713.a17d18","type":"websocket-listener","z":"","path":"/ws/send","wholemsg":"false"},{"id":"48f558f0.c51958","type":"websocket-listener","z":"","path":"/ws/data1","wholemsg":"true"},{"id":"2dab23bf.054b0c","type":"websocket-listener","z":"","path":"/ws/left","wholemsg":"true"},{"id":"c0402614.f01608","type":"websocket-listener","z":"","path":"/ws//middle","wholemsg":"true"},{"id":"5f79ee6c.9abfc","type":"websocket-listener","z":"","path":"/ws/right","wholemsg":"true"},{"id":"cf7ea854.0bbdf8","type":"websocket-listener","z":"","path":"/ws/index","wholemsg":"true"},{"id":"aae6ab09.c69b28","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"50","bin":"false","out":"interbyte","addchar":false,"responsetimeout":""},{"id":"32989c5a.d6ee14","type":"websocket-listener","z":"","path":"/ws/data","wholemsg":"true"},{"id":"fd38eee5.8bd8a","type":"sqlitedb","z":"","db":"/home/Ingenso/CaptureCall.db","mode":"RWC"},{"id":"e1c85b2c.abed18","type":"json-db-collection","z":"","name":"","collection":"settings","save":true},{"id":"7016657f.45b3ec","type":"websocket-listener","z":"","path":"/ws/export","wholemsg":"false"},{"id":"ff68c365.94b25","type":"websocket-listener","z":"","path":"/ws/sender","wholemsg":"false"},{"id":"d9d1357a.d4f118","type":"websocket-listener","z":"","path":"/ws/receive","wholemsg":"true"},{"id":"95962f80.19ef3","type":"websocket-listener","z":"","path":"/ws/send","wholemsg":"false"},{"id":"c7526c07.3fd51","type":"websocket-listener","z":"","path":"/ws/data1","wholemsg":"true"},{"id":"6c8b92a7.84a82c","type":"e-mail","z":"b00e2d77.a9931","server":"smtp.gmail.com","port":"465","secure":true,"name":"","dname":"CaptureCall System","x":1340,"y":380,"wires":[]},{"id":"da56f422.c45fe8","type":"csv","z":"b00e2d77.a9931","name":"","sep":",","hdrin":"","hdrout":true,"multi":"one","ret":"\\n","temp":"Index, Call Point, Message, ReceivedTime, Status, StatusTime, ExportedTime, Recipient, System ID","skip":"0","x":950,"y":400,"wires":[["e981d4fd.f427d8","8551674f.20b3f8"]]},{"id":"3f8aac1f.7c3ae4","type":"template","z":"b00e2d77.a9931","name":"Export All","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT \n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log`\nORDER BY  `rxTime` DESC;","output":"str","x":400,"y":440,"wires":[["f8461b70.bd71c8"]]},{"id":"e981d4fd.f427d8","type":"change","z":"b00e2d77.a9931","name":"Setup mail content","rules":[{"t":"set","p":"attachments","pt":"msg","to":"[{\t    \"filename\": 'log.csv', \t    \"content\": $$.payload\t}]","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"CaptureCall System Log","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"Attached is the requested information from your CaptureCall system.","tot":"str"},{"t":"set","p":"to","pt":"msg","to":"to","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":400,"wires":[["6c8b92a7.84a82c"]]},{"id":"3926df19.02ee4","type":"http response","z":"b00e2d77.a9931","name":"","statusCode":"","headers":{},"x":650,"y":80,"wires":[]},{"id":"a32b6729.85e8e8","type":"http in","z":"b00e2d77.a9931","name":"","url":"/export","method":"get","upload":false,"swaggerDoc":"","x":90,"y":80,"wires":[["67a6a4d6.f3b61c"]]},{"id":"af06c87d.56a788","type":"comment","z":"b00e2d77.a9931","name":"Build Webpage","info":"","x":100,"y":40,"wires":[]},{"id":"4d708685.06c888","type":"link out","z":"b00e2d77.a9931","name":"","links":["4e306403.b3c8ac","e9a02996.2dcce8","2c79b941.11ba86","8ab05f94.8a1b","31885960.18a2a6"],"x":615,"y":40,"wires":[]},{"id":"b0e346b8.b15c08","type":"template","z":"b00e2d77.a9931","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<style>\n{{{global.css}}}\n</style>    \n    <title>CaptureCall Export Menu</title>\n        <script>\n    \n        var connection = new WebSocket('ws://' + location.host + '/ws/export');\n        var sender = new WebSocket('ws://' + location.host + '/ws/sender');\n        \n        var msg = 0; // Make Incoming WS Global\n\n        // When the connection is open, send some data to the server\n        connection.onopen = function() {\n            console.log('WebSocket Open');\n            connection.send('Open');\n        \n        };\n        connection.onclose = function() {\n            console.log('WebSocket Closed');\n        };\n        // Log errors\n        connection.onerror = function(error) {\n            console.log('WebSocket Error ' + error);\n        };\n        // Log messages from the server\n        connection.onmessage = function(d) {\n            var txt = d.data;\n            //msg = JSON.parse(txt);\n            console.log(txt)\n            document.getElementById(\"email\").value = txt;\n        };\n            // Log messages from the server\n        sender.onmessage = function(e) {\n            var txt0 = e.data;\n            //msg = JSON.parse(txt0);\n            console.log(txt0);\n           alert(txt0);\n        };\n        \n\n    </script>\n\n</head>\n<body>\n\n      <div class=\"heading\">\n\n    <div class=\"left\">\n        <a href=\"/display\" class=\"settings\" >Go to Dynamic Display</a>\n        <BR>\n        <a href=\"/log-daily\" class=\"settings\" >Go to Daily Log</a>    \n        <BR>\n        <a href=\"/log-full\" class=\"settings\" >Go to Full Log</a>\n        </div>\n    <div class=\"middle\">\n        <h1 id=\"title\">CaptureCall Export Menu</h1>\n    </div>\n    \n<div class=\"right\">\n<div class=\"settings\">System IP: {{{ip}}}</div>\n<div class=\"settings\">System Serial: 183701Q</div>\n<div class=\"settings\">S/W Version: 1.0.0</div>\n<div class=\"settings\">F/W Version: 1.0.0</div>\n<div class=\"settings\">H/W Version: 1.0.0</div>\n</div>\n    </div>\n\n\n<div class=\"grid-container\">\n<div class=\"grid-item\"><p class=\"notes\">Logs are sent to the email address shown below.<br>To update the email address, enter a new address below and press enter.</p><input type=\"email\" class=\"name\" id=\"email\" onchange=\"sender.send(email.value)\" placeholder=\"Enter eMail Address...\"></div>\n<div class=\"grid-item\"><p class=\"notes\">Click on the buttons below to email the relevant report immediately.</p><button class=\"name\" onclick=\"sender.send('ExportNew')\">Export New (Unexported) Log Records</button></div>\n<div class=\"grid-item\"><button class=\"name\" onclick=\"sender.send('ExportAll')\">Export All Log Records</button></div>\n<div class=\"grid-item\"><p class=\"notes bold\">WARNING: This cannot be undone!</p><button class=\"name red\" onclick=\"sender.send('Clear')\">Delete ALL Exported Records from Log</button></div>\n<div class=\"grid-item\"><p class=\"notes bold\">WARNING: You will need to physically disconnect and then re-connect power to CaptureCall in order to power-up again.</p><button class=\"name red\" onclick=\"sender.send('Shutdown')\">Safely Shutdown CaptureCall</button></div>\n</div>\n\n</body>\n\n</html>","output":"str","x":530,"y":80,"wires":[["3926df19.02ee4","4d708685.06c888","8111948e.2d5c58"]]},{"id":"cc70f131.afde4","type":"template","z":"b00e2d77.a9931","name":"Export New","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT\n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log` WHERE `exported` IS NULL","output":"str","x":410,"y":400,"wires":[["f8461b70.bd71c8"]]},{"id":"90dc4edd.437b9","type":"template","z":"b00e2d77.a9931","name":"Clear","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `log` WHERE `exported` IS NOT NULL;","output":"str","x":450,"y":760,"wires":[["a0fd81a8.70245"]]},{"id":"f8a9f08f.97c9b","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET `exported`= '{{timestamp}}'","output":"str","x":1760,"y":700,"wires":[["1526f69b.ff5f29"]]},{"id":"c6075542.a00c48","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"to","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":500,"wires":[["e2ab5e5e.760e2","c1530843.813c58"]]},{"id":"848d3571.3ab4f8","type":"switch","z":"b00e2d77.a9931","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ExportNew","vt":"str"},{"t":"eq","v":"ExportAll","vt":"str"},{"t":"eq","v":"Clear","vt":"str"},{"t":"eq","v":"Shutdown","vt":"str"},{"t":"cont","v":"@","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":6,"x":270,"y":780,"wires":[["aa303f27.1d1f7"],["56423647.080d38"],["90dc4edd.437b9"],["df6c1ed3.4d502"],["43132da.14324d4"],["9cfc568.cddc1a8"]]},{"id":"f8461b70.bd71c8","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":590,"y":400,"wires":[["2e1d4886.bea1a8"]]},{"id":"a0fd81a8.70245","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":590,"y":760,"wires":[["cddafd4b.b21cb"]]},{"id":"1526f69b.ff5f29","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1910,"y":700,"wires":[[]]},{"id":"211ad050.b3d89","type":"exec","z":"b00e2d77.a9931","command":"shutdown -P now","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"","x":810,"y":800,"wires":[[],[],[]]},{"id":"e2ab5e5e.760e2","type":"DataIn","z":"b00e2d77.a9931","collection":"e1c85b2c.abed18","name":"","update":false,"path":"/email","x":590,"y":500,"wires":[]},{"id":"7dae4782.2c7f28","type":"DataOut","z":"b00e2d77.a9931","collection":"e1c85b2c.abed18","name":"","path":"/email","error":false,"x":390,"y":220,"wires":[["55fea2a6.62229c"]]},{"id":"a181e1eb.42874","type":"delay","z":"b00e2d77.a9931","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":800,"wires":[["211ad050.b3d89"]]},{"id":"6bd06e94.47f96","type":"websocket out","z":"b00e2d77.a9931","name":"","server":"7016657f.45b3ec","client":"","x":700,"y":220,"wires":[]},{"id":"ee103375.32941","type":"websocket in","z":"b00e2d77.a9931","name":"","server":"ff68c365.94b25","client":"","x":100,"y":780,"wires":[["848d3571.3ab4f8","3ccf6234.c6ccfe"]]},{"id":"d77daf53.a554","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"export","pt":"global","to":"Export Log Data Via eMail","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":180,"wires":[[]]},{"id":"a4c8442.5a53eb8","type":"switch","z":"b00e2d77.a9931","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":".","vt":"str"},{"t":"cont","v":",","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":540,"wires":[["5845d54b.1b33dc"],["3e0d960c.df324a"],["3e0d960c.df324a"]]},{"id":"5845d54b.1b33dc","type":"switch","z":"b00e2d77.a9931","name":"","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"$length(payload) >= 5","vt":"jsonata"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":520,"wires":[["c6075542.a00c48"],["3e0d960c.df324a"]]},{"id":"c4630aee.29afb8","type":"websocket out","z":"b00e2d77.a9931","name":"Show Alert on Bad Email","server":"ff68c365.94b25","client":"","x":670,"y":560,"wires":[]},{"id":"c36d98b4.40cb78","type":"websocket in","z":"b00e2d77.a9931","name":"","server":"7016657f.45b3ec","client":"","x":100,"y":220,"wires":[["6e9ad6e3.7fc558"]]},{"id":"6e9ad6e3.7fc558","type":"switch","z":"b00e2d77.a9931","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":220,"wires":[["7dae4782.2c7f28","d77daf53.a554"]]},{"id":"c57eafc1.e0eea","type":"comment","z":"b00e2d77.a9931","name":"Show Existing Email Address","info":"","x":140,"y":140,"wires":[]},{"id":"3e0d960c.df324a","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Please Enter a Valid eMail Address","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":560,"wires":[["c4630aee.29afb8"]]},{"id":"7933dbf8.4523b4","type":"websocket out","z":"b00e2d77.a9931","name":"Show Alert for Shutdown","server":"ff68c365.94b25","client":"","x":690,"y":880,"wires":[]},{"id":"df6c1ed3.4d502","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"CaptureCall is Shutting Down... Please Close your Browser (If Necessary)","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":800,"wires":[["7933dbf8.4523b4","a181e1eb.42874","41bb72f2.b86efc"]]},{"id":"c3f8d5d0.283858","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Your eMail has been Sent","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":580,"wires":[["ea92ebe2.658898","75f1d35f.d07dac"]]},{"id":"ea92ebe2.658898","type":"websocket out","z":"b00e2d77.a9931","name":"Send Successful","server":"ff68c365.94b25","client":"","x":1650,"y":580,"wires":[]},{"id":"cddafd4b.b21cb","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Records Deleted","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":760,"wires":[["719e3bc.07daac4","4cd261ec.08d98"]]},{"id":"719e3bc.07daac4","type":"websocket out","z":"b00e2d77.a9931","name":"Show Alert for Clear Database","server":"ff68c365.94b25","client":"","x":1010,"y":760,"wires":[]},{"id":"77853578.d4e90c","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Power On','Power On ({{ip}})', '{{timestamp}}', '{{timestamp}}');","output":"str","x":820,"y":1020,"wires":[["8b510e27.fd3f1"]]},{"id":"8b510e27.fd3f1","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":970,"y":1020,"wires":[[]]},{"id":"2ab4a1e4.90679e","type":"inject","z":"b00e2d77.a9931","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":90,"y":1020,"wires":[["1de7fb21.93d795"]]},{"id":"7540e7ef.bb9058","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Power Off','Power Off', '{{timestamp}}', '{{timestamp}}');","output":"str","x":780,"y":840,"wires":[["28c87aba.55e616"]]},{"id":"28c87aba.55e616","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":930,"y":840,"wires":[[]]},{"id":"4b0a536e.0f970c","type":"inject","z":"b00e2d77.a9931","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":250,"y":180,"wires":[["7dae4782.2c7f28"]]},{"id":"55fea2a6.62229c","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"to","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":220,"wires":[["6bd06e94.47f96"]]},{"id":"463f8c6f.4fd364","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Send Failed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":540,"wires":[["f2a91bf9.b1d3b8","68d64bf.54ca2b4"]]},{"id":"f2a91bf9.b1d3b8","type":"websocket out","z":"b00e2d77.a9931","name":"Send Failed","server":"ff68c365.94b25","client":"","x":1630,"y":540,"wires":[]},{"id":"9f4bb9c9.b550f8","type":"status","z":"b00e2d77.a9931","name":"","scope":["6c8b92a7.84a82c"],"x":1160,"y":560,"wires":[["ba578bde.7214f8"]]},{"id":"ba578bde.7214f8","type":"switch","z":"b00e2d77.a9931","name":"","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"email.status.sendfail","vt":"str"},{"t":"eq","v":"email.status.sending","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1310,"y":560,"wires":[["463f8c6f.4fd364"],[],["c3f8d5d0.283858"]]},{"id":"3013dfe1.3ed01","type":"comment","z":"b00e2d77.a9931","name":"Catch Email Send Errors","info":"","x":1170,"y":620,"wires":[]},{"id":"86082327.d62aa","type":"link in","z":"b00e2d77.a9931","name":"","links":["721569cb.074f58"],"x":295,"y":400,"wires":[["cc70f131.afde4"]]},{"id":"721569cb.074f58","type":"link out","z":"b00e2d77.a9931","name":"","links":["86082327.d62aa"],"x":875,"y":680,"wires":[]},{"id":"223b37e8.4b69d8","type":"link in","z":"b00e2d77.a9931","name":"","links":["2c82e51a.004a9a"],"x":295,"y":440,"wires":[["3f8aac1f.7c3ae4"]]},{"id":"2c82e51a.004a9a","type":"link out","z":"b00e2d77.a9931","name":"","links":["223b37e8.4b69d8"],"x":875,"y":720,"wires":[]},{"id":"fed99ff9.b9bb1","type":"comment","z":"b00e2d77.a9931","name":"Send Email","info":"","x":150,"y":320,"wires":[]},{"id":"41553d32.73a6d4","type":"inject","z":"b00e2d77.a9931","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":90,"y":1060,"wires":[["dad9751e.369368"]]},{"id":"8d45c274.d3629","type":"comment","z":"b00e2d77.a9931","name":"Log Power On & Set Last Email Address","info":"","x":180,"y":980,"wires":[]},{"id":"a20fe9c4.7efc28","type":"link in","z":"b00e2d77.a9931","name":"","links":["43132da.14324d4"],"x":75,"y":540,"wires":[["a4c8442.5a53eb8"]]},{"id":"43132da.14324d4","type":"link out","z":"b00e2d77.a9931","name":"","links":["a20fe9c4.7efc28"],"x":415,"y":840,"wires":[]},{"id":"c31b6340.5e646","type":"link in","z":"b00e2d77.a9931","name":"","links":["9cfc568.cddc1a8"],"x":335,"y":580,"wires":[["3e0d960c.df324a"]]},{"id":"9cfc568.cddc1a8","type":"link out","z":"b00e2d77.a9931","name":"","links":["c31b6340.5e646"],"x":415,"y":880,"wires":[]},{"id":"dad9751e.369368","type":"DataOut","z":"b00e2d77.a9931","collection":"e1c85b2c.abed18","name":"","path":"/email","error":false,"x":210,"y":1060,"wires":[["6110a668.d26bf8"]]},{"id":"6110a668.d26bf8","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"to","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":1060,"wires":[[]]},{"id":"264f903e.c9e7a","type":"comment","z":"b00e2d77.a9931","name":"Set Email Address","info":"","x":150,"y":480,"wires":[]},{"id":"2b7cbabb.a888d6","type":"comment","z":"b00e2d77.a9931","name":"Clear DB & Shutdown","info":"","x":120,"y":660,"wires":[]},{"id":"67a6a4d6.f3b61c","type":"hostip","z":"b00e2d77.a9931","name":"Host IP","x":240,"y":80,"wires":[["cde55ee3.ccd0f"]]},{"id":"cde55ee3.ccd0f","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"ip","pt":"msg","to":"payload[0].address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":80,"wires":[["b0e346b8.b15c08"]]},{"id":"8111948e.2d5c58","type":"debug","z":"b00e2d77.a9931","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":650,"y":120,"wires":[]},{"id":"666f148c.df226c","type":"csv","z":"b00e2d77.a9931","name":"","sep":",","hdrin":"","hdrout":true,"multi":"one","ret":"\\n","temp":"Index, Call Point, Message, ReceivedTime, Status, StatusTime, ExportedTime, Recipient, System ID","skip":"0","x":950,"y":360,"wires":[["4ea4678b.48f808","8551674f.20b3f8"]]},{"id":"4ea4678b.48f808","type":"change","z":"b00e2d77.a9931","name":"Setup mail content","rules":[{"t":"set","p":"attachments","pt":"msg","to":"[{\t    \"filename\": 'log.csv', \t    \"content\": $$.payload\t}]","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"CaptureCall Daily Digest","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"Attached is the requested information from your CaptureCall system.","tot":"str"},{"t":"set","p":"to","pt":"msg","to":"to","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":360,"wires":[["6c8b92a7.84a82c"]]},{"id":"94f5535a.df3bc","type":"template","z":"b00e2d77.a9931","name":"Export New","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT\n`index` AS 'Index',\n`sender` AS 'Call Point',\n`content` AS 'Message',\n`rxTime`,\n`status` AS 'Status',\n`statusTime`,\n`exported`,\n`pagerNumber` AS 'Recipient',\n`sysID` AS 'System ID'\nFROM `log` WHERE `exported` IS NULL","output":"str","x":410,"y":360,"wires":[["445e65fd.5881dc"]]},{"id":"445e65fd.5881dc","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":590,"y":360,"wires":[["4df235b.7c5c0cc"]]},{"id":"f3405690.0119c8","type":"inject","z":"b00e2d77.a9931","name":"Export New Every Day","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"x":210,"y":360,"wires":[["94f5535a.df3bc","ebaeeace.a4f718","430823b4.54fdcc"]]},{"id":"1de7fb21.93d795","type":"delay","z":"b00e2d77.a9931","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":230,"y":1020,"wires":[["78e2f32f.ba034c"]]},{"id":"a61b2d01.623e8","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":120,"wires":[]},{"id":"c7008ce.9220c7","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":80,"wires":[["6f129008.96182"]]},{"id":"7e6e6b94.b4a724","type":"inject","z":"ba76d305.cf8ad","name":"Make Table","topic":"CREATE TABLE `log` ( \t`index`\tINTEGER PRIMARY KEY AUTOINCREMENT, \t`capcode`\tINTEGER, \t`pagerNumber`\tINTEGER, \t`sysID`\tINTEGER, \t`content`\tTEXT, \t`msgPart1`\tTEXT, \t`msgPart2`\tTEXT, \t`sender`\tTEXT, \t`rxTime`\tINTEGER, \t`status`\tTEXT, \t`statusTime`\tINTEGER, \t`exported`\tINTEGER );","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":80,"wires":[["c7008ce.9220c7"]]},{"id":"6f129008.96182","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":80,"wires":[]},{"id":"ec443c0d.8626c","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":240,"wires":[["24bd4830.57f6e8"]]},{"id":"9d1e6dbe.d89e2","type":"inject","z":"ba76d305.cf8ad","name":"Clear Table","topic":"DELETE FROM 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":240,"wires":[["ec443c0d.8626c"]]},{"id":"aed60ae.6b45df8","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":120,"wires":[["a61b2d01.623e8"]]},{"id":"c8181b2e.7db228","type":"inject","z":"ba76d305.cf8ad","name":"Select All","topic":"Select * FROM 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":120,"wires":[["aed60ae.6b45df8"]]},{"id":"b0a6ba65.a7d928","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":160,"wires":[]},{"id":"8b6bd144.83a25","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":160,"wires":[["b0a6ba65.a7d928"]]},{"id":"df2babd6.b81898","type":"inject","z":"ba76d305.cf8ad","name":"Drop Table","topic":"DROP TABLE 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":160,"wires":[["8b6bd144.83a25"]]},{"id":"12ffb182.46101e","type":"switch","z":"71697e01.9871a","name":"Filter Address","property":"sysID","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":920,"y":360,"wires":[["ddd9121a.9eb65"]]},{"id":"1beb32c9.7474fd","type":"comment","z":"71697e01.9871a","name":"Receive Page and Add to DB","info":"","x":160,"y":260,"wires":[]},{"id":"4710f982.70cf68","type":"comment","z":"71697e01.9871a","name":"Put Unprocessed On the Webpage","info":"","x":180,"y":140,"wires":[]},{"id":"b2fa9ad3.1aa778","type":"http response","z":"71697e01.9871a","name":"","statusCode":"","headers":{},"x":610,"y":100,"wires":[]},{"id":"e0f58654.122608","type":"http in","z":"71697e01.9871a","name":"","url":"/display","method":"get","upload":false,"swaggerDoc":"","x":110,"y":100,"wires":[["88437299.226bc"]]},{"id":"89d5fad5.1b2d28","type":"template","z":"71697e01.9871a","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT `index`, `pagerNumber`, `sysID`, `content`, `msgPart1`, `msgPart2`, `sender`, `rxTime`, `status`\nFROM `log`\nWHERE  `status` = 'Active' OR `status` = 'Late'\nORDER BY  `rxTime` DESC ","output":"str","x":290,"y":200,"wires":[["a45c314.83bc1d"]]},{"id":"f7505d48.4c652","type":"websocket out","z":"71697e01.9871a","name":"","server":"d9d1357a.d4f118","client":"","x":1320,"y":200,"wires":[]},{"id":"ec0a00fc.9e591","type":"comment","z":"71697e01.9871a","name":"Build Webpage","info":"","x":120,"y":20,"wires":[]},{"id":"437f678f.839508","type":"template","z":"71697e01.9871a","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <title>CaptureCall Dynamic Display</title>\n\n    <script>\n        {{{script}}}\n    </script>\n    \n    <style>\n        {{{global.css}}}\n    </style>\n\n</head>\n\n<body onload=\"startTime()\">\n\n      <div class=\"heading\">\n          \n    <div class=\"left\">\n        \n        <a href=\"/export\" class=\"settings\">Go to Export Menu</a>\n        <BR>\n        <a href=\"/log-daily\" class=\"settings\" >Go to Daily Log</a>    \n        <BR>\n        <a href=\"/log-full\" class=\"settings\" >Go to Full Log</a>\n        </div>\n    <div class=\"middle\">\n        <h1 id=\"title\">CaptureCall Dynamic Display</h1>\n    </div>\n    \n    <div class=\"right\">\n        \n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n    </div>\n\n    <div class=\"wrapper\" id=\"data\">\n\n    \n      \n     \n     \n   \n</div>\n\n</body>\n\n</html>","output":"str","x":490,"y":100,"wires":[["b2fa9ad3.1aa778"]]},{"id":"88437299.226bc","type":"template","z":"71697e01.9871a","name":"CSS","field":"css","fieldType":"global","format":"css","syntax":"mustache","template":"    * {\n      padding: 0px;\n      margin: 0;\n      box-sizing: border-box;\n      background: #456FA0;\n    }\n\n    h1 {\n      padding: 10px;\n      text-align: center;\n    }\n\n    html,\n    body,\n    p {\n      font-family: Arial, Helvetica, sans-serif;\n      font-size: 1vw;\n      margin: 0px;\n      padding-left: 0px;\n      color: white;\n    }\n\n    .wrapper {\n      display: grid;\n    }\n\n    .heading {\n      width: 100%;\n      display: grid;\n      grid-template-columns: 25% 50% 25%;\n      grid-gap: 0em;\n      height: auto;\n      padding: 10px;\n    }\n\n    .left {\n      text-align: left;\n    }\n\n    .middle {\n      text-align: center;\n    }\n\n    .right {\n      text-align: right;\n    }\n    \n    .clock {\n        font-size: 2vw;\n        padding-top:10px;\n        font-weight: bold;\n    }\n\n    .nested {\n      display: grid;\n      justify-content: space-evenly;\n      align-content: center;\n      grid-template-columns: repeat(6, 1.5fr);\n      font-size: 1.5vw;\n      text-align: center;\n      color: black;\n    }\n    \n    .nestedLog {\n      display: grid;\n      justify-content: space-evenly;\n      align-content: center;\n      grid-template-columns: repeat(12, 1fr);\n      font-size: 1vw;\n      text-align: center;\n      color: black;\n    }\n.nested10 {\n      display: grid;\n      justify-content: space-evenly;\n      align-content: center;\n      grid-template-columns: repeat(10, 1fr);\n      font-size: 1vw;\n      text-align: center;\n      color: black;\n    }\n    .wrapper>div {\n      background: #eee;\n      padding: 0.5em;\n    }\n\n    .wrapper>div:nth-child(odd) {\n      background: #ddd;\n    }\n\n    .nested>div {\n      padding: 0.5em;\n      background-color: inherit;\n    }\n    \n    .nestedLog>div {\n      padding: 0.5em;\n      background-color: inherit;\n    }\n    .nested10>div {\n      padding: 0.5em;\n      background-color: inherit;\n    }\n    .bold {\n    font-weight: bold;    \n    }\n\n    .flash {\n        color: red;\n    }\n    \n    .red {\n    color: red;\n    }\n\n    a:link {\n      text-decoration: none;\n      color: white;\n    }\n\n    a:visited {\n      text-decoration: none;\n      color: white;\n    }\n\n    a:hover {\n      color: red;\n    }\n    \n#notes {\n    font-size: 1.5vw;\n}\n       .grid-container {\n            display: grid;\n            grid-template-columns: auto;\n            padding: 0px;\n        }\n\n        .grid-item {\n            padding: 20px;\n            font-size: 48px;\n            text-align: center;\n        }\n        \n.name {\n            box-sizing: border-box;\n            width: 50%;\n            border-radius: 10px;\n            font-weight: normal;\n            font-size: 1vw;\n            font-family: Arial, Helvetica, sans-serif;\n            text-align: center;\n            padding: 10px;\n            margin: 0px;\n            text-overflow: ellipsis;\n            box-shadow: 10px 10px 20px black;\n            background-color: lightgrey;\n }\n","output":"str","x":250,"y":100,"wires":[["4bdb822e.921abc"]]},{"id":"68bb080.5c2f3f8","type":"template","z":"71697e01.9871a","name":"Add Msg to DB as Active","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime') VALUES ('{{capcode}}', '{{pagerNumber}}', '{{sysID}}', '{{content}}', '{{msgPart1}}', '{{msgPart2}}', '{{sender}}','{{timestamp}}', 'Active', '{{timestamp}}');","output":"str","x":1490,"y":400,"wires":[["2a452dd0.60dda2"]]},{"id":"a45c314.83bc1d","type":"sqlite","z":"71697e01.9871a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":470,"y":200,"wires":[["72452c.01ccdad4"]]},{"id":"2a452dd0.60dda2","type":"sqlite","z":"71697e01.9871a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1710,"y":360,"wires":[["363f5c70.e7e144"]]},{"id":"6e1dc865.77cf88","type":"serial in","z":"71697e01.9871a","name":"","serial":"aae6ab09.c69b28","x":90,"y":360,"wires":[["d4e5e42c.359ec8"]]},{"id":"ddd9121a.9eb65","type":"change","z":"71697e01.9871a","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":360,"wires":[["d36a14ca.510eb8"]]},{"id":"d36a14ca.510eb8","type":"switch","z":"71697e01.9871a","name":"Check Msg Type","property":"content","propertyType":"msg","rules":[{"t":"cont","v":"Handled","vt":"str"},{"t":"cont","v":"Late","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1250,"y":360,"wires":[["e2e43137.8cfa3"],["3be67bb7.60f2c4"],["68bb080.5c2f3f8"]]},{"id":"3be67bb7.60f2c4","type":"template","z":"71697e01.9871a","name":"Add Msg to DB as Late","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime') VALUES ('{{capcode}}', '{{pagerNumber}}', '{{sysID}}', '{{content}}', '{{msgPart1}}', '{{msgPart2}}', '{{sender}}','{{timestamp}}', 'Late', '{{timestamp}}');","output":"str","x":1490,"y":360,"wires":[["2a452dd0.60dda2"]]},{"id":"e2e43137.8cfa3","type":"template","z":"71697e01.9871a","name":"Add Msg to DB as Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` ('capcode', 'pagerNumber', 'sysID', 'content', 'msgPart1', 'msgPart2', 'sender', 'rxTime', 'status', 'statusTime') VALUES ('{{capcode}}', '{{pagerNumber}}', '{{sysID}}', '{{content}}', '{{msgPart1}}', '{{msgPart2}}', '{{sender}}','{{timestamp}}', 'Attended', '{{timestamp}}');","output":"str","x":1500,"y":320,"wires":[["191d3e07.412292"]]},{"id":"c678e846.e8a928","type":"template","z":"71697e01.9871a","name":"Update Active to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Handled', statusTime = '{{timestamp}}' WHERE `sender` = {{sender}} AND `status` = 'Active';","output":"str","x":1910,"y":320,"wires":[["d65a4b1a.e88638"]]},{"id":"d65a4b1a.e88638","type":"sqlite","z":"71697e01.9871a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":2110,"y":320,"wires":[["a48cea37.72fc88"]]},{"id":"191d3e07.412292","type":"sqlite","z":"71697e01.9871a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1710,"y":320,"wires":[["c678e846.e8a928"]]},{"id":"363f5c70.e7e144","type":"link out","z":"71697e01.9871a","name":"to Log","links":["13c2aaaa.74d295"],"x":2615,"y":320,"wires":[]},{"id":"7392b6bc.a14758","type":"template","z":"71697e01.9871a","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"  <div class=\"nested\">\n        <div class=\"bold\">Index</div>\n        <div class=\"bold\">Location</div>\n        <div class=\"bold\">Message</div>\n        <div class=\"bold\">Time</div>\n        <div class=\"bold\">Date</div>\n        <div class=\"bold\">Elapsed</div>\n      </div>\n{{#payload}}\n  <div class=\"nested {{style}}\" onclick= send.send('{{index}}')>\n        <div>{{{index}}}</div>\n        <div>{{{msgPart1}}}</div>\n        <div>{{{msgPart2}}}</div>\n        <div>{{{displayTime}}}</div>\n        <div>{{{displayDate}}}</div>\n        <div>{{{elapsed}}}</div>\n      </div>\n{{/payload}}","output":"str","x":1150,"y":200,"wires":[["f7505d48.4c652"]]},{"id":"4bdb822e.921abc","type":"template","z":"71697e01.9871a","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"    var receive = new WebSocket('ws://' + location.host + '/ws/receive');\n    var send = new WebSocket('ws://' + location.host + '/ws/send');\n        var msg = 0; // Make Incoming WS Global\n\n        // Log messages from the server\n        receive.onmessage = function(d) {\n            var txt = d.data;\n            msg = JSON.parse(txt);\n            console.log(msg);\n            document.getElementById(\"data\").innerHTML = msg.payload;\n    \n        };\n        \n\nfunction startTime() {\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML =\n    h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} //Clock\n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n     ","output":"str","x":370,"y":100,"wires":[["437f678f.839508"]]},{"id":"bb825032.7b416","type":"function","z":"71697e01.9871a","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":200,"wires":[["f2e91aec.429a48"]]},{"id":"f2e91aec.429a48","type":"function","z":"71697e01.9871a","name":"Time elapsed","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = msg.payload[i].rxTime;\n   var now = Date.now();\n   \nvar elapsedTS = now -rxtime;\nvar elapsedS = parseInt(elapsedTS / 1000);\n\nvar date = new Date(null);  \ndate.setSeconds(elapsedS); // specify value for SECONDS here\nvar elapsed = date.toISOString().substr(11, 8);        \n\nmsg.payload[i].elapsed = elapsed\n\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":200,"wires":[["7392b6bc.a14758"]]},{"id":"59111fba.a2419","type":"inject","z":"71697e01.9871a","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":200,"wires":[["89d5fad5.1b2d28"]]},{"id":"1833996c.e996c7","type":"http in","z":"71697e01.9871a","name":"","url":"/","method":"get","upload":false,"swaggerDoc":"","x":90,"y":60,"wires":[["88437299.226bc"]]},{"id":"d4e5e42c.359ec8","type":"switch","z":"71697e01.9871a","name":"MSG Type","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"[","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":360,"wires":[["4784ff08.0e985"],["5a97514f.385fc"]]},{"id":"4784ff08.0e985","type":"function","z":"71697e01.9871a","name":"LRS Process Group Message","func":"var payload = msg.payload;\nvar Totallength = payload.length;\n\nvar page = payload.substring(9, Totallength -2);\n\n\nvar str = \"\" + page;\nvar split = str.split(\",\");\nvar contentlength = split[1].length\n\n\n\nvar capcode = split[0];\nvar str = capcode.toString();\nvar strLength = str.length;\nvar pagerStr = str.substring(strLength - 5, strLength);\nvar pagercalc1 = parseInt(pagerStr);\nvar pager = pagercalc1/8;\n\nvar syscode = ((capcode - pagercalc1)-700000)/100000;\n\nif (page.endsWith(\" \")) {\n    var message= split[1].substring(4,contentlength-1)\nvar tidyMessage = message.trim();\n    msg.sender = \"0\"\n} else {\n    var message= split[1].substring(4,contentlength-2)\nvar tidyMessage = message.trim();\n    var sender = split[1].substring(contentlength-2,contentlength)\n    var tidySender = sender.trim();\n    msg.sender = tidySender;\n}\n\nvar group= split[1].substring(0,4)\n\nmsg.capcode = split[0];\nmsg.pagerNumber = group;\nmsg.sysID = syscode\nmsg.content = tidyMessage;\nmsg.payload = page\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":340,"wires":[["3d9488fd.d68bd8"]]},{"id":"5a97514f.385fc","type":"function","z":"71697e01.9871a","name":"LRS Process Normal Message","func":"var payload = msg.payload;\nvar Totallength = payload.length;\n\nvar page = payload.substring(9, Totallength -2);\n\n\nvar str = \"\" + page;\nvar split = str.split(\",\");\nvar contentlength = split[1].length\n\n\n\nvar capcode = split[0];\nvar str = capcode.toString();\nvar strLength = str.length;\nvar pagerStr = str.substring(strLength - 5, strLength);\nvar pagercalc1 = parseInt(pagerStr);\nvar pager = pagercalc1/8;\n\nvar syscode = ((capcode - pagercalc1)-700000)/100000;\n\nif (page.endsWith(\" \")) {\n    var message= split[1].substring(0,contentlength-1)\nvar tidyMessage = message.trim();\n    msg.sender = \"0\"\n} else {\n    var message= split[1].substring(0,contentlength-2)\nvar tidyMessage = message.trim();\n    var sender = split[1].substring(contentlength-2,contentlength)\n    var tidySender = sender.trim();\n    msg.sender = tidySender;\n}\n\n\nmsg.capcode = split[0];\nmsg.pagerNumber = pager\nmsg.sysID = syscode\nmsg.content = tidyMessage;\nmsg.payload = page\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":380,"wires":[["3d9488fd.d68bd8"]]},{"id":"fda68550.35cc08","type":"websocket in","z":"71697e01.9871a","name":"","server":"95962f80.19ef3","client":"","x":90,"y":500,"wires":[["d0672168.f9cc3"]]},{"id":"f9e6a6b0.64ce98","type":"comment","z":"71697e01.9871a","name":"Hide Message on Click","info":"","x":120,"y":460,"wires":[]},{"id":"2f89d261.991ebe","type":"template","z":"71697e01.9871a","name":"Update Active to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Manually Removed', statusTime = '{{timestamp}}' WHERE `index` = {{payload}};","output":"str","x":430,"y":500,"wires":[["3751227c.3c408e"]]},{"id":"3751227c.3c408e","type":"sqlite","z":"71697e01.9871a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":630,"y":500,"wires":[["320906f1.fd1fba"]]},{"id":"320906f1.fd1fba","type":"link out","z":"71697e01.9871a","name":"","links":["13c2aaaa.74d295","f8b2c7bc.b77368"],"x":735,"y":500,"wires":[]},{"id":"d0672168.f9cc3","type":"change","z":"71697e01.9871a","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":500,"wires":[["2f89d261.991ebe"]]},{"id":"a48cea37.72fc88","type":"template","z":"71697e01.9871a","name":"Update Late to Handled","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE `log` SET status = 'Handled', statusTime = '{{timestamp}}' WHERE `sender` = {{sender}} AND `status` = 'Late';","output":"str","x":2310,"y":320,"wires":[["cba9c20f.a5c9a"]]},{"id":"cba9c20f.a5c9a","type":"sqlite","z":"71697e01.9871a","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":2510,"y":320,"wires":[["363f5c70.e7e144"]]},{"id":"49b647b4.b47d48","type":"comment","z":"1c96dbb1.1bc354","name":"Put All On the Webpage","info":"","x":160,"y":140,"wires":[]},{"id":"46418585.24918c","type":"http response","z":"1c96dbb1.1bc354","name":"","statusCode":"","headers":{},"x":550,"y":80,"wires":[]},{"id":"672cd54b.015afc","type":"http in","z":"1c96dbb1.1bc354","name":"","url":"/log-full","method":"get","upload":false,"swaggerDoc":"","x":130,"y":80,"wires":[["bb558069.89be9"]]},{"id":"789799aa.6b3ca8","type":"template","z":"1c96dbb1.1bc354","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM `log`\nORDER BY  `rxTime` DESC ","output":"str","x":230,"y":280,"wires":[["d92c7a20.a63ce8"]]},{"id":"8cf086f7.eafc98","type":"websocket out","z":"1c96dbb1.1bc354","name":"","server":"32989c5a.d6ee14","client":"","x":1090,"y":280,"wires":[]},{"id":"563aad78.25d9d4","type":"comment","z":"1c96dbb1.1bc354","name":"Build Webpage","info":"","x":140,"y":40,"wires":[]},{"id":"d92c7a20.a63ce8","type":"sqlite","z":"1c96dbb1.1bc354","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":410,"y":280,"wires":[["bc30fbab.77e168"]]},{"id":"45deb19d.022ce","type":"template","z":"1c96dbb1.1bc354","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"  <div class=\"nestedLog\">\n    <div class=\"bold\">Index</div>\n    <div class=\"bold\">Call Point</div>\n    <div class=\"bold\">Message</div>\n    <div class=\"bold\">Receive Time</div>\n    <div class=\"bold\">Receive Date</div>\n    <div class=\"bold\">Status</div>\n    <div class=\"bold\">Status Time</div>\n    <div class=\"bold\">Status Date</div>\n    <div class=\"bold\">Export Time</div>\n    <div class=\"bold\">Export Date</div>\n    <div class=\"bold\">Recipient</div>\n    <div class=\"bold\">System ID</div>\n  </div>\n{{#payload}}\n  <div class=\"nestedLog {{style}}\">\n    <div>{{index}}</div>\n    <div>{{sender}}</div>\n    <div>{{{content}}}</div>\n    <div>{{displayTime}}</div>\n    <div>{{displayDate}}</div>\n    <div>{{status}}</div>\n    <div>{{displayStatusTime}}</div>\n    <div>{{displayStatusDate}}</div>\n    <div>{{{displayExportedTime}}}</div>\n    <div>{{{displayExportedDate}}}</div>\n    <div>{{pagerNumber}}</div>\n    <div>{{sysID}}</div>\n   </div>\n{{/payload}}","output":"str","x":930,"y":280,"wires":[["8cf086f7.eafc98"]]},{"id":"bb558069.89be9","type":"template","z":"1c96dbb1.1bc354","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"    var receive = new WebSocket('ws://' + location.host + '/ws/data');\n\n        var msg = 0; // Make Incoming WS Global\n\n        // Log messages from the server\n        receive.onmessage = function(d) {\n            var txt = d.data;\n            msg = JSON.parse(txt);\n            console.log(msg);\n            document.getElementById(\"data\").innerHTML = msg.payload;\n        };\n        \n            // When the connection is open, send some data to the server\n        receive.onopen = function() {\n            console.log('WebSocket Open');\n            receive.send('Open');\n        \n        };\n\nfunction startTime() {\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML =\n    h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} //Clock\n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n     ","output":"str","x":290,"y":80,"wires":[["22c6aed.a374c52"]]},{"id":"575acb3d.97bd64","type":"function","z":"1c96dbb1.1bc354","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n    var statusTime = new Date(msg.payload[i].statusTime);\n                var displayStatusDate = statusTime.toLocaleDateString();\n                var displayStatusTime = statusTime.toLocaleTimeString();\n                \n  \n              \n     if (msg.payload[i].exported === null) {\n    msg.payload[i].displayExportedTime = \"n/a\"\n    msg.payload[i].displayExportedDate = \"n/a\"\n} else {\nvar exportedTime = new Date(msg.payload[i].exported);\n    var displayExportedDate = exportedTime.toLocaleDateString();\n    var displayExportedTime = exportedTime.toLocaleTimeString();\n              \n    msg.payload[i].displayExportedTime = displayExportedTime\n    msg.payload[i].displayExportedDate = displayExportedDate\n}         \n               \n                \n                msg.payload[i].displayStatusTime = displayStatusTime\n                msg.payload[i].displayStatusDate = displayStatusDate\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":280,"wires":[["45deb19d.022ce","ce9a13ca.daf9b"]]},{"id":"13c2aaaa.74d295","type":"link in","z":"1c96dbb1.1bc354","name":"log","links":["363f5c70.e7e144","320906f1.fd1fba","ecbc4376.b117e","d2d8b8d2.67e9a8","8469e8af.2a6df8"],"x":95,"y":280,"wires":[["789799aa.6b3ca8"]]},{"id":"ce9a13ca.daf9b","type":"debug","z":"1c96dbb1.1bc354","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":910,"y":220,"wires":[]},{"id":"a6f41372.e1e95","type":"websocket in","z":"1c96dbb1.1bc354","name":"","server":"32989c5a.d6ee14","client":"","x":150,"y":220,"wires":[["dd5d2e16.22ed7"]]},{"id":"dd5d2e16.22ed7","type":"switch","z":"1c96dbb1.1bc354","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":220,"wires":[["789799aa.6b3ca8"]]},{"id":"4df235b.7c5c0cc","type":"function","z":"b00e2d77.a9931","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \nvar rxtime = new Date(msg.payload[i].rxTime);\nvar statusTime = new Date(msg.payload[i].statusTime);\nvar exportedTime = new Date(msg.payload[i].exported);\n\nif (msg.payload[i].exported === null) {\n    msg.payload[i].ExportedTime = \"n/a\"\n} else {\nmsg.payload[i].ExportedTime = exportedTime\n}\n\nmsg.payload[i].StatusTime = statusTime\nmsg.payload[i].ReceivedTime = rxtime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":360,"wires":[["666f148c.df226c"]]},{"id":"75f1d35f.d07dac","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":660,"wires":[["582b503f.5fb22","f8a9f08f.97c9b"]]},{"id":"2e1d4886.bea1a8","type":"function","z":"b00e2d77.a9931","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \nvar rxtime = new Date(msg.payload[i].rxTime);\nvar statusTime = new Date(msg.payload[i].statusTime);\nvar exportedTime = new Date(msg.payload[i].exported);\n\nif (msg.payload[i].exported === null) {\n    msg.payload[i].ExportedTime = \"n/a\"\n} else {\nmsg.payload[i].ExportedTime = exportedTime\n}\n\nmsg.payload[i].StatusTime = statusTime\nmsg.payload[i].ReceivedTime = rxtime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":400,"wires":[["da56f422.c45fe8"]]},{"id":"41bb72f2.b86efc","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":840,"wires":[["7540e7ef.bb9058"]]},{"id":"78e2f32f.ba034c","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":1020,"wires":[["6cf16749.deb658"]]},{"id":"2eda23e9.52792c","type":"change","z":"b00e2d77.a9931","name":"","rules":[{"t":"set","p":"ip","pt":"msg","to":"payload[0].address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":1020,"wires":[["77853578.d4e90c"]]},{"id":"6cf16749.deb658","type":"hostip","z":"b00e2d77.a9931","name":"Host IP","x":520,"y":1020,"wires":[["2eda23e9.52792c"]]},{"id":"24bd4830.57f6e8","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":240,"wires":[]},{"id":"2fd5e4ed.597f5c","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":200,"wires":[]},{"id":"37e42e66.009442","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":200,"wires":[["2fd5e4ed.597f5c"]]},{"id":"d201839b.347","type":"inject","z":"ba76d305.cf8ad","name":"Reset Auto Increment (Clear Table First)","topic":"DELETE FROM sqlite_sequence WHERE name = 'log';","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":200,"wires":[["37e42e66.009442"]]},{"id":"22c6aed.a374c52","type":"template","z":"1c96dbb1.1bc354","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n   <title>CaptureCall Full Log</title>\n   <style>\n        {{{global.css}}}\n    </style>\n    \n    <script>\n        {{{script}}}\n    </script>\n    \n \n\n</head>\n\n<body onload=\"startTime()\">\n\n      <div class=\"heading\">\n\n    <div class=\"left\">\n        <a href=\"/export\" class=\"settings\">Go to Export Menu</a>\n        <BR>\n        <a href=\"/display\" class=\"settings\" >Go to Dynamic Display</a>\n        <BR>\n        <a href=\"/log-daily\" class=\"settings\" >Go to Daily Log</a>    \n    </div>\n    <div class=\"middle\">\n        <h1 id=\"title\">CaptureCall Full Log</h1>\n    </div>\n    \n    <div class=\"right\">\n    <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n    </div>\n\n      <div class=\"wrapper\" id=\"data\"></div>\n\n</body>\n\n</html>","output":"str","x":430,"y":80,"wires":[["46418585.24918c"]]},{"id":"8551674f.20b3f8","type":"debug","z":"b00e2d77.a9931","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1090,"y":320,"wires":[]},{"id":"109cf513.333d8b","type":"comment","z":"b209c94d.26d798","name":"Put All On the Webpage","info":"","x":160,"y":140,"wires":[]},{"id":"ac9461bb.6b7b2","type":"http response","z":"b209c94d.26d798","name":"","statusCode":"","headers":{},"x":510,"y":80,"wires":[]},{"id":"9aac45fc.813958","type":"http in","z":"b209c94d.26d798","name":"","url":"/log-daily","method":"get","upload":false,"swaggerDoc":"","x":130,"y":80,"wires":[["62e1a43b.0d903c"]]},{"id":"8f45f53e.71ff08","type":"template","z":"b209c94d.26d798","name":"Select Active Data","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM log WHERE date(datetime(rxtime / 1000 , 'unixepoch')) = date('now') AND `sender` != \"System\"\nORDER BY  `rxTime` DESC; ","output":"str","x":230,"y":280,"wires":[["9c7288fe.0f9a98"]]},{"id":"de3ce5b7.367e28","type":"websocket out","z":"b209c94d.26d798","name":"","server":"c7526c07.3fd51","client":"","x":1100,"y":280,"wires":[]},{"id":"fb47baaa.cecc08","type":"comment","z":"b209c94d.26d798","name":"Build Webpage","info":"","x":140,"y":40,"wires":[]},{"id":"9c7288fe.0f9a98","type":"sqlite","z":"b209c94d.26d798","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":410,"y":280,"wires":[["2fd00906.8c8cb6"]]},{"id":"e6ae4362.9fe56","type":"template","z":"b209c94d.26d798","name":"Build Data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"  <div class=\"nested10\">\n    <div class=\"bold\">Index</div>\n    <div class=\"bold\">Call Point</div>\n    <div class=\"bold\">Message</div>\n    <div class=\"bold\">Receive Time</div>\n    <div class=\"bold\">Receive Date</div>\n    <div class=\"bold\">Status</div>\n    <div class=\"bold\">Status Time</div>\n    <div class=\"bold\">Status Date</div>\n    \n    <div class=\"bold\">Recipient</div>\n    <div class=\"bold\">System ID</div>\n  </div>\n{{#payload}}\n  <div class=\"nested10 {{style}}\">\n    <div>{{index}}</div>\n    <div>{{sender}}</div>\n    <div>{{{content}}}</div>\n    <div>{{displayTime}}</div>\n    <div>{{displayDate}}</div>\n    <div>{{status}}</div>\n    <div>{{displayStatusTime}}</div>\n    <div>{{displayStatusDate}}</div>\n   \n    <div>{{pagerNumber}}</div>\n    <div>{{sysID}}</div>\n   </div>\n{{/payload}}","output":"str","x":930,"y":280,"wires":[["de3ce5b7.367e28"]]},{"id":"62e1a43b.0d903c","type":"template","z":"b209c94d.26d798","name":"Script","field":"script","fieldType":"msg","format":"javascript","syntax":"plain","template":"    var receive = new WebSocket('ws://' + location.host + '/ws/data1');\n\n        var msg = 0; // Make Incoming WS Global\n\n        // Log messages from the server\n        receive.onmessage = function(d) {\n            var txt = d.data;\n            msg = JSON.parse(txt);\n            console.log(msg);\n            document.getElementById(\"data\").innerHTML = msg.payload;\n        };\n        \n            // When the connection is open, send some data to the server\n        receive.onopen = function() {\n            console.log('WebSocket Open');\n            receive.send('Open');\n        \n        };\n\nfunction startTime() {\n    var today = new Date();\n    var h = today.getHours();\n    var m = today.getMinutes();\n    var s = today.getSeconds();\n    m = checkTime(m);\n    s = checkTime(s);\n    document.getElementById('time').innerHTML =\n    h + \":\" + m + \":\" + s;\n    var t = setTimeout(startTime, 500);\n} //Clock\n\nfunction checkTime(i) {\n    if (i < 10) {i = \"0\" + i}  // add zero in front of numbers < 10\n    return i;\n}\n     ","output":"str","x":270,"y":80,"wires":[["ad3acb03.15cf38"]]},{"id":"3945937b.26034c","type":"function","z":"b209c94d.26d798","name":"Convert Time to local","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n   var rxtime = new Date(msg.payload[i].rxTime);\n                var displayDate = rxtime.toLocaleDateString();\n                var displayTime = rxtime.toLocaleTimeString();\n                \n    var statusTime = new Date(msg.payload[i].statusTime);\n                var displayStatusDate = statusTime.toLocaleDateString();\n                var displayStatusTime = statusTime.toLocaleTimeString();\n                \n  \n              \n     if (msg.payload[i].exported === null) {\n    msg.payload[i].displayExportedTime = \"n/a\"\n    msg.payload[i].displayExportedDate = \"n/a\"\n} else {\nvar exportedTime = new Date(msg.payload[i].exported);\n    var displayExportedDate = exportedTime.toLocaleDateString();\n    var displayExportedTime = exportedTime.toLocaleTimeString();\n              \n    msg.payload[i].displayExportedTime = displayExportedTime\n    msg.payload[i].displayExportedDate = displayExportedDate\n}         \n               \n                \n                msg.payload[i].displayStatusTime = displayStatusTime\n                msg.payload[i].displayStatusDate = displayStatusDate\n                \n                msg.payload[i].displayDate = displayDate\n                msg.payload[i].displayTime = displayTime\n}\n    \n \n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":280,"wires":[["e6ae4362.9fe56","6478799.cbd3788"]]},{"id":"f8b2c7bc.b77368","type":"link in","z":"b209c94d.26d798","name":"log","links":["363f5c70.e7e144","320906f1.fd1fba","ecbc4376.b117e","d2d8b8d2.67e9a8","8469e8af.2a6df8"],"x":95,"y":280,"wires":[["8f45f53e.71ff08"]]},{"id":"6478799.cbd3788","type":"debug","z":"b209c94d.26d798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":910,"y":220,"wires":[]},{"id":"624fab58.d41fb4","type":"websocket in","z":"b209c94d.26d798","name":"","server":"c7526c07.3fd51","client":"","x":150,"y":220,"wires":[["8d113a2c.07c438"]]},{"id":"8d113a2c.07c438","type":"switch","z":"b209c94d.26d798","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Open","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":220,"wires":[["8f45f53e.71ff08"]]},{"id":"ad3acb03.15cf38","type":"template","z":"b209c94d.26d798","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n   <title>CaptureCall Daily Log</title>\n   <style>\n        {{{global.css}}}\n    </style>\n    \n    <script>\n        {{{script}}}\n    </script>\n    \n \n\n</head>\n\n<body onload=\"startTime()\">\n\n      <div class=\"heading\">\n\n    <div class=\"left\">\n        \n       <a href=\"/export\" class=\"settings\">Go to Export Menu</a>\n        <BR>\n        <a href=\"/display\" class=\"settings\" >Go to Dynamic Display</a>\n        <BR>\n        <a href=\"/log-full\" class=\"settings\" >Go to Full Log</a>\n        </div>\n    <div class=\"middle\">\n        <h1 id=\"title\">CaptureCall Daily Log</h1>\n    </div>\n    \n    <div class=\"right\">\n        \n        <div class=\"clock\" id=\"time\"></div>\n    </div>\n    \n    </div>\n\n      <div class=\"wrapper\" id=\"data\"></div>\n\n</body>\n\n</html>","output":"str","x":390,"y":80,"wires":[["ac9461bb.6b7b2"]]},{"id":"1d4b9b6.2e75565","type":"sqlite","z":"ba76d305.cf8ad","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":490,"y":280,"wires":[["8b82ced7.840b7"]]},{"id":"f3efd6bc.d319a8","type":"inject","z":"ba76d305.cf8ad","name":"Clear Old Records","topic":"DELETE FROM `log` WHERE `index` IN (SELECT `index` FROM `log` ORDER BY `index` DESC LIMIT -1 OFFSET 2000) AND `exported` IS NOT NULL;","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":280,"wires":[["1d4b9b6.2e75565"]]},{"id":"8b82ced7.840b7","type":"debug","z":"ba76d305.cf8ad","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":280,"wires":[]},{"id":"a352da15.0d4288","type":"template","z":"b00e2d77.a9931","name":"Clear Old Records","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"DELETE FROM `log` WHERE `index` IN (SELECT `index` FROM `log` ORDER BY `index` DESC LIMIT -1 OFFSET 2000) AND `exported` IS NOT NULL;","output":"str","x":570,"y":320,"wires":[["b59b1f4c.0ec78"]]},{"id":"b59b1f4c.0ec78","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":750,"y":320,"wires":[[]]},{"id":"ebaeeace.a4f718","type":"delay","z":"b00e2d77.a9931","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":320,"wires":[["a352da15.0d4288"]]},{"id":"582b503f.5fb22","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export Successful','Export Successful', '{{timestamp}}', '{{timestamp}}');","output":"str","x":1760,"y":660,"wires":[["5c50a3a4.23c89c"]]},{"id":"5c50a3a4.23c89c","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1910,"y":660,"wires":[[]]},{"id":"ecca07b5.9ea578","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export Failed','Export Failed', '{{timestamp}}', '{{timestamp}}');","output":"str","x":1760,"y":500,"wires":[["b09e3e3f.0fe09"]]},{"id":"b09e3e3f.0fe09","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1910,"y":500,"wires":[[]]},{"id":"2273988.c724968","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export All','Export All to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":610,"y":720,"wires":[["beb76124.5a2af"]]},{"id":"beb76124.5a2af","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":770,"y":720,"wires":[["2c82e51a.004a9a"]]},{"id":"5638becd.56066","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Export New','Export New to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":610,"y":680,"wires":[["760a1043.819c"]]},{"id":"760a1043.819c","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":770,"y":680,"wires":[["721569cb.074f58"]]},{"id":"33c3ae31.e41c62","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Daily Export Triggered','Daily Export Triggered to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":550,"y":280,"wires":[["e7b2f01e.3fbbf"]]},{"id":"e7b2f01e.3fbbf","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":710,"y":280,"wires":[[]]},{"id":"68d64bf.54ca2b4","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":500,"wires":[["ecca07b5.9ea578"]]},{"id":"430823b4.54fdcc","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":280,"wires":[["33c3ae31.e41c62"]]},{"id":"aa303f27.1d1f7","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":680,"wires":[["5638becd.56066"]]},{"id":"56423647.080d38","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":720,"wires":[["2273988.c724968"]]},{"id":"ecbc4376.b117e","type":"link out","z":"b00e2d77.a9931","name":"","links":["13c2aaaa.74d295","f8b2c7bc.b77368"],"x":415,"y":920,"wires":[]},{"id":"3ccf6234.c6ccfe","type":"delay","z":"b00e2d77.a9931","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":920,"wires":[["ecbc4376.b117e"]]},{"id":"4cd261ec.08d98","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":720,"wires":[["3660ecca.ffca94"]]},{"id":"3660ecca.ffca94","type":"template","z":"b00e2d77.a9931","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'Records Deleted','Records Deleted', '{{timestamp}}', '{{timestamp}}');","output":"str","x":1140,"y":720,"wires":[["d1c59e4b.7281"]]},{"id":"d1c59e4b.7281","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":1290,"y":720,"wires":[[]]},{"id":"2ba16b1b.ca41c4","type":"template","z":"b00e2d77.a9931","name":"Log Export","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO `log` (`sender`, `status`, `content`, `statusTime`, `rxTime`) VALUES ('System', 'eMail Address Changed','eMail Changed to {{global.to}}', '{{timestamp}}', '{{timestamp}}');","output":"str","x":750,"y":460,"wires":[["d360a4fe.9ebda8"]]},{"id":"d360a4fe.9ebda8","type":"sqlite","z":"b00e2d77.a9931","mydb":"fd38eee5.8bd8a","sqlquery":"msg.topic","sql":"","name":"CaptureCall","x":910,"y":460,"wires":[["8469e8af.2a6df8"]]},{"id":"c1530843.813c58","type":"change","z":"b00e2d77.a9931","name":"Time Now","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":460,"wires":[["2ba16b1b.ca41c4"]]},{"id":"8469e8af.2a6df8","type":"link out","z":"b00e2d77.a9931","name":"","links":["13c2aaaa.74d295","f8b2c7bc.b77368"],"x":1015,"y":460,"wires":[]},{"id":"3d9488fd.d68bd8","type":"function","z":"71697e01.9871a","name":"Split Content into 2","func":"var payload = msg.content;\n\nvar str = \"\" + payload;\nvar split = str.split(\"-\");\n\nmsg.msgPart1 = split[0];\nmsg.msgPart2 = split[1];\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":360,"wires":[["12ffb182.46101e"]]},{"id":"2fd00906.8c8cb6","type":"function","z":"b209c94d.26d798","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].status == \"Late\") {\n    msg.payload[i].style = \"flash bold\"\n} else {\n    msg.payload[i].style = \"\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":280,"wires":[["3945937b.26034c"]]},{"id":"bc30fbab.77e168","type":"function","z":"1c96dbb1.1bc354","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].status == \"Late\") {\n    msg.payload[i].style = \"flash bold\"\n} else {\n    msg.payload[i].style = \"\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":280,"wires":[["575acb3d.97bd64"]]},{"id":"72452c.01ccdad4","type":"function","z":"71697e01.9871a","name":"Set Style","func":"var array = msg.payload\nvar i;\nfor (i = 0; i < array.length; i++) { \n    \n  if (msg.payload[i].status == \"Late\") {\n    msg.payload[i].style = \"flash bold\"\n} else {\n    msg.payload[i].style = \"\"\n}\n}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":200,"wires":[["bb825032.7b416"]]}]